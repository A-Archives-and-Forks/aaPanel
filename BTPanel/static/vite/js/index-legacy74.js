System.register(["./index-legacy123.js?v=1742891699271","./index-legacy.js?v=1742891699271","./index-legacy95.js?v=1742891699271","./index.vue_vue_type_script_setup_true_lang-legacy4.js?v=1742891699271","./index.vue_vue_type_script_setup_true_lang-legacy6.js?v=1742891699271","./vue-legacy.js?v=1742891699271","./page_layout-legacy.js?v=1742891699271","./public-legacy.js?v=1742891699271","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1742891699271","./naive-legacy.js?v=1742891699271","./common-legacy.js?v=1742891699271","./__commonjsHelpers__-legacy.js?v=1742891699271","./index.vue_vue_type_script_setup_true_lang-legacy8.js?v=1742891699271"],(function(e,a){"use strict";var l,t,n,o,i,u,r,s,d,c,_,p,v,f,m,w,x,F,g,W,b,h,y,q,R,k,j,$,U,E,N,T,C,P,O,I,M,A,S,z,B,L,J,V,D,H,Y,Z,G,K;return{setters:[e=>{l=e._},e=>{t=e._},e=>{n=e._},e=>{o=e._},e=>{i=e._},e=>{u=e.d,r=e.O,s=e.as,d=e.r,c=e.R,_=e.S,p=e.U,v=e.P,f=e.V,m=e.e,w=e.a0,x=e.aq,F=e.j,g=e.a1,W=e.a2,b=e.c,h=e.ap,y=e._},e=>{q=e.bh,R=e.d,k=e.cZ,j=e.k,$=e.m,U=e.cT,E=e.c_,N=e.I},e=>{T=e.c,C=e.d,P=e.b,O=e.f,I=e.a,M=e.k},e=>{A=e._},e=>{S=e.cn,z=e._,B=e.cp,L=e.bM,J=e.ch,V=e.cm,D=e.cl,H=e.a2,Y=e.bY,Z=e.b$,G=e.T,K=e.ck},null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".n-select[data-v-aba322fe] .n-base-selection-tag-wrapper{padding:0 0 3px}.form-title[data-v-8a3017c5]{margin-bottom:20px;font-size:16px}\n",document.head.appendChild(a);const Q={class:"flex w-380px"},X={class:"w-140px mr-12px"},ee={class:"flex-1"},ae=u({__name:"path",props:{url:{},urlModifiers:{},type:{},typeModifiers:{}},emits:["update:url","update:type"],setup(e){const{t:a}=r(),l=s(e,"url"),t=s(e,"type"),n=d([{label:a("Waf.Flow.Form.index_36"),value:"url"},{label:a("Waf.Flow.Form.index_37"),value:"all"}]),o=e=>{"all"===e&&(l.value="/")};return(e,a)=>{const i=S,u=z;return c(),_("div",Q,[p("div",X,[v(i,{value:t.value,"onUpdate:value":[a[0]||(a[0]=e=>t.value=e),o],options:f(n)},null,8,["value","options"])]),p("div",ee,[v(u,{value:l.value,"onUpdate:value":a[1]||(a[1]=e=>l.value=e),disabled:"all"===t.value,placeholder:e.$t("Waf.Flow.Form.index_35")},null,8,["value","disabled","placeholder"])])])}}}),le="allsite",te=j(u({__name:"site",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const a=s(e,"value"),l=k(),{t:t}=r(),{loading:n,setLoading:o}=T(),i=d([]),u=d([{label:t("Waf.Flow.Form.index_39"),value:le}]),_=m((()=>a.value===le)),p=({option:e,handleClose:a})=>{if(e.value!==le)return v(B,{class:"mr-6px",closable:!0,onClose:e=>{e.stopPropagation(),a()}},{default:()=>[e.label]})},x=e=>{_.value||(e.includes(le)?(a.value=le,i.value=u.value.map((e=>e.value))):e.length!==u.value.length-1?(a.value=e.filter((e=>e!==le)),i.value=e.filter((e=>e!==le))):e.length===u.value.length-1&&(a.value=le,i.value=u.value.map((e=>e.value)))),_.value&&(e.includes(le)?e.length!==u.value.length&&(a.value=e.filter((e=>e!==le)),i.value=e.filter((e=>e!==le))):(a.value=[],i.value=[]))};return(async()=>{try{o(!0),await l.getConfig(),u.value=Object.entries(l.config.sitemap).map((([e,a])=>({label:e,value:a}))),u.value.unshift({label:t("Waf.Flow.Form.index_39"),value:le}),a.value===le?i.value=u.value.map((e=>e.value)):L(a.value)&&(i.value=a.value)}finally{o(!1)}})(),(e,a)=>{const l=S;return c(),w(l,{loading:f(n),value:f(i),multiple:"",filterable:"",options:f(u),"max-tag-count":"responsive","consistent-menu-width":!1,"render-tag":p,placeholder:e.$t("Waf.Flow.Form.index_38"),"onUpdate:value":x},null,8,["loading","value","options","placeholder"])}}}),[["__scopeId","data-v-aba322fe"]]),ne={class:"p-24px"},oe={class:"form-title"},ie={class:"w-380px"},ue={class:"w-380px"},re={class:"form-title mt-8px"},se={class:"w-60px mx-8px"},de={class:"text-desc"},ce={class:"w-60px mx-8px"},_e={class:"text-desc"},pe={class:"w-60px mx-8px"},ve={class:"text-desc"},fe={class:"form-title mt-8px"},me={class:"w-380px"},we={class:"w-380px"},xe=u({__name:"index",props:{isEdit:{type:Boolean},row:{},refresh:{}},setup(e,{expose:a}){const l=e,{t:t}=r(),n=x("formRef"),o=F({name:"",server:[],types:"url",url:"",condition:1,secondReq:!0,secondReqNum:void 0,countReq:!1,countReqTime:void 0,countReqNum:void 0,action:"status_503",return:"html"}),i=d([{label:t("Waf.Flow.Form.index_16"),value:"status_403"},{label:t("Waf.Flow.Form.index_17"),value:"status_404"},{label:t("Waf.Flow.Form.index_18"),value:"status_502"},{label:t("Waf.Flow.Form.index_19"),value:"status_503"},{label:t("Waf.Flow.Form.index_20"),value:"content"},{label:t("Waf.Flow.Form.index_21"),value:"drop"}]),u=d([{label:t("Waf.Flow.Form.index_22"),value:"html"},{label:t("Waf.Flow.Form.index_23"),value:"json"},{label:t("Waf.Flow.Form.index_24"),value:"444"}]),s={name:{required:!0,trigger:["blur","input"],message:t("Waf.Flow.Form.index_3")},server:{trigger:["change"],validator:()=>!(o.server.length<=0)||new Error(t("Waf.Flow.Form.index_25"))},path:{trigger:["blur","input","change"],validator:()=>{if("url"===o.types){if(!o.url)return new Error(t("Waf.Flow.Form.index_26"));if("/"===o.url)return new Error(t("Waf.Flow.Form.index_27"));if(!o.url.startsWith("/"))return new Error(t("Waf.Flow.Form.index_28"))}return!0}},second:{trigger:["blur","input"],validator:()=>!(o.secondReq&&!o.secondReqNum)||new Error(t("Waf.Flow.Form.index_29"))},count:{trigger:["blur","input"],validator:()=>{if(o.countReq){if(!o.countReqTime)return new Error(t("Waf.Flow.Form.index_30"));if(o.countReqTime<30)return new Error(t("Waf.Flow.Form.index_31"));if(!o.countReqNum)return new Error(t("Waf.Flow.Form.index_32"));if(o.countReqNum<20)return new Error(t("Waf.Flow.Form.index_33"))}return!0}}};return(()=>{const{isEdit:e,row:a}=l;e&&a&&(o.name=a.name,o.server=Object.keys(a.site),o.types=a.types,o.url=a.url,o.condition=a.condition,o.secondReq=!!a.region.req,a.region.req&&(o.secondReqNum=a.region.req),o.countReq=!!a.region.count,a.region.count&&(o.countReqTime=a.region.count.time,o.countReqNum=a.region.count.count),o.action=a.action,"content"===a.action&&(o.return=a.return))})(),a({onConfirm:async()=>{if(await(n.value?.validate()),!1===o.secondReq&&!1===o.countReq)return $.error(t("Waf.Flow.Form.index_34"),{close:!0}),!1;const e={name:o.name,site:o.server.join(","),types:o.types,url:o.url,condition:o.condition,action:o.action,region:{...o.secondReq?{req:o.secondReqNum}:{},...o.countReq?{count:{time:o.countReqTime,count:o.countReqNum}}:{}},..."content"===o.action?{return:o.return}:{}},{row:a,isEdit:i}=l;var u;i&&a?await(u={...e,id:a.id},q.post("/btwaf/edit_user_limit.json",{data:JSON.stringify(u)},{requestOptions:{loading:R.global.t("Waf.Flow.API.index_2"),successMessage:!0}})):await(e=>q.post("/btwaf/add_user_limit.json",{data:JSON.stringify(e)},{requestOptions:{loading:R.global.t("Waf.Flow.API.index_1"),successMessage:!0}}))(e),l.refresh?.()}}),(e,a)=>{const l=z,t=J,r=V,d=D,m=H,x=Y,F=S,y=A;return c(),_("div",ne,[v(y,{ref_key:"formRef",ref:n,model:f(o),rules:s},{default:g((()=>[p("div",oe,W(e.$t("Waf.Flow.Form.index_1")),1),v(t,{label:e.$t("Waf.Flow.Form.index_2"),path:"name"},{default:g((()=>[p("div",ie,[v(l,{value:f(o).name,"onUpdate:value":a[0]||(a[0]=e=>f(o).name=e),placeholder:e.$t("Waf.Flow.Form.index_3")},null,8,["value","placeholder"])])])),_:1},8,["label"]),v(t,{label:e.$t("Waf.Flow.Form.index_4"),path:"server"},{default:g((()=>[p("div",ue,[v(te,{value:f(o).server,"onUpdate:value":a[1]||(a[1]=e=>f(o).server=e)},null,8,["value"])])])),_:1},8,["label"]),p("div",re,W(e.$t("Waf.Flow.Form.index_5")),1),v(t,{label:e.$t("Waf.Flow.Form.index_6"),path:"path"},{default:g((()=>[v(ae,{type:f(o).types,"onUpdate:type":a[2]||(a[2]=e=>f(o).types=e),url:f(o).url,"onUpdate:url":a[3]||(a[3]=e=>f(o).url=e)},null,8,["type","url"])])),_:1},8,["label"]),v(t,{label:e.$t("Waf.Flow.Form.index_7")},{default:g((()=>[v(d,{value:f(o).condition,"onUpdate:value":a[4]||(a[4]=e=>f(o).condition=e)},{default:g((()=>[v(r,{value:1},{default:g((()=>[b(W(e.$t("Waf.Flow.Form.index_8")),1)])),_:1}),v(r,{value:2},{default:g((()=>a[12]||(a[12]=[b("IP+UA")]))),_:1}),v(r,{value:3},{default:g((()=>[b(W(e.$t("Waf.Flow.Form.index_9")),1)])),_:1})])),_:1},8,["value"])])),_:1},8,["label"]),v(t,{label:" ",path:"second"},{default:g((()=>[v(m,{checked:f(o).secondReq,"onUpdate:checked":a[5]||(a[5]=e=>f(o).secondReq=e)},{default:g((()=>[b(W(e.$t("Waf.Flow.Form.index_10")),1)])),_:1},8,["checked"]),p("div",se,[v(x,{value:f(o).secondReqNum,"onUpdate:value":a[6]||(a[6]=e=>f(o).secondReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),p("div",de,W(e.$t("Public.Unit.Times")),1)])),_:1}),v(t,{label:" ",path:"count"},{default:g((()=>[v(m,{checked:f(o).countReq,"onUpdate:checked":a[7]||(a[7]=e=>f(o).countReq=e)},{default:g((()=>[b(W(e.$t("Waf.Flow.Form.index_11")),1)])),_:1},8,["checked"]),p("div",ce,[v(x,{value:f(o).countReqTime,"onUpdate:value":a[8]||(a[8]=e=>f(o).countReqTime=e),"show-button":!1,placeholder:""},null,8,["value"])]),p("div",_e,W(e.$t("Waf.Flow.Form.index_12")),1),p("div",pe,[v(x,{value:f(o).countReqNum,"onUpdate:value":a[9]||(a[9]=e=>f(o).countReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),p("div",ve,W(e.$t("Public.Unit.Times")),1)])),_:1}),p("div",fe,W(e.$t("Waf.Flow.Form.index_13")),1),v(t,{label:e.$t("Waf.Flow.Form.index_14")},{default:g((()=>[p("div",me,[v(F,{value:f(o).action,"onUpdate:value":a[10]||(a[10]=e=>f(o).action=e),options:f(i)},null,8,["value","options"])])])),_:1},8,["label"]),"content"===f(o).action?(c(),w(t,{key:0,label:e.$t("Waf.Flow.Form.index_15")},{default:g((()=>[p("div",we,[v(F,{value:f(o).return,"onUpdate:value":a[11]||(a[11]=e=>f(o).return=e),options:f(u)},null,8,["value","options"])])])),_:1},8,["label"])):h("",!0)])),_:1},8,["model"])])}}}),Fe=j(xe,[["__scopeId","data-v-8a3017c5"]]),ge={class:"mr-8px"};e("default",u({__name:"index",setup(e){const{t:a}=r(),u=U(),{version:s}=y(u),_=d("9.6.0"),x=m((()=>E(s.value,_.value))),F=()=>{M("btwaf")},h=C(a("Waf.Flow.index_6"),{isEdit:!1,refresh:()=>A()}),k=()=>{h.data.row=null,h.data.isEdit=!1,h.title=a("Waf.Flow.index_6"),h.show=!0},{table:j,columns:$,setLoading:T}=P([{key:"name",title:a("Waf.Flow.index_8"),width:"12%",minWidth:160},{key:"site",title:a("Waf.Flow.index_9"),width:"16%",minWidth:200,render:e=>Object.keys(e.site).join(", ")},{key:"region",title:a("Waf.Flow.index_10"),minWidth:300,render:e=>{let l="";switch(e.condition){case 1:l=a("Waf.Flow.index_11");break;case 2:l=a("Waf.Flow.index_12");break;case 3:l=a("Waf.Flow.index_13")}const{region:t}=e;return t.req&&(l+=a("Waf.Flow.index_14",[t.req])),t.count&&t.count.count&&(t.req&&(l+=a("Waf.Flow.index_15")),l+=a("Waf.Flow.index_16",[t.count.time,t.count.count])),a("Waf.Flow.index_17",[l])}},{key:"action",title:a("Waf.Flow.index_18"),width:"16%",minWidth:260,render:e=>{let l="";switch(e.action){case"status_403":l=a("Waf.Flow.index_19");break;case"status_404":l=a("Waf.Flow.index_20");break;case"status_502":l=a("Waf.Flow.index_21");break;case"status_503":l=a("Waf.Flow.index_22");break;case"content":l=a("Waf.Flow.index_23");break;case"drop":l=a("Waf.Flow.index_24")}return l}},{key:"open",title:a("Waf.Flow.index_25"),width:"6%",minWidth:80,render:e=>v(Z,{size:"small",value:e.open,onUpdateValue:async a=>{var l;await(l={id:e.id},q.post("/btwaf/set_user_limit.json",l,{requestOptions:{loading:R.global.t("Waf.Flow.API.index_3"),successMessage:!0}})),e.open=a}},null)},O({width:100,options:e=>[{label:a("Public.Btn.Edit"),onClick:()=>{(e=>{h.data.row=e,h.data.isEdit=!0,h.title=a("Waf.Flow.index_7"),h.show=!0})(e)}},{label:a("Public.Btn.Del"),onClick:()=>{I({title:a("Waf.Flow.index_26"),content:a("Waf.Flow.index_27",[e.name]),onConfirm:async()=>{var a;await(a={id:e.id},q.post("/btwaf/del_user_limit.json",a,{requestOptions:{loading:R.global.t("Waf.Flow.API.index_4"),successMessage:!0}})),A()}})}}]})]),A=async()=>{try{T(!0);const{message:e}=await q.post("/btwaf/get_user_limit.json");j.data=N(e)?e:[]}finally{T(!1)}};return x.value&&A(),(e,a)=>{const u=G,r=i,d=o,m=n,y=t,q=K,R=l;return c(),w(R,{install:f(x)},{desc:g((()=>[p("span",ge," The WAF is v"+W(f(s))+", please upgrade to the version above v"+W(f(_))+" to use ",1),v(u,{class:"px-8px h-24px",type:"primary",size:"small",onClick:F},{default:g((()=>a[1]||(a[1]=[b(" Upgrade ")]))),_:1})])),default:g((()=>[v(q,{class:"p-16px"},{default:g((()=>[v(d,null,{toolsLeft:g((()=>[v(u,{type:"primary",onClick:k},{default:g((()=>[b(W(e.$t("Waf.Flow.index_1")),1)])),_:1})])),table:g((()=>[v(r,{loading:f(j).loading,data:f(j).data,columns:f($)},null,8,["loading","data","columns"])])),_:1}),v(m,{class:"mt-16px"},{default:g((()=>[p("li",null,W(e.$t("Waf.Flow.index_2")),1),p("li",null,W(e.$t("Waf.Flow.index_3")),1),p("li",null,W(e.$t("Waf.Flow.index_4")),1),p("li",null,W(e.$t("Waf.Flow.index_5")),1)])),_:1}),v(y,{show:f(h).show,"onUpdate:show":a[0]||(a[0]=e=>f(h).show=e),title:f(h).title,width:640,footer:!0,data:f(h).data,component:Fe},null,8,["show","title","data"])])),_:1})])),_:1},8,["install"])}}}))}}}));
