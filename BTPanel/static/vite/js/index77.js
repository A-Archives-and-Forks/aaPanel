const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/details2.js?v=1749179669910","js/public.js?v=1749179669910","js/page_layout.js?v=1749179669910","js/vue.js?v=1749179669910","js/__commonjsHelpers__.js?v=1749179669910","js/naive.js?v=1749179669910","js/common.js?v=1749179669910","css/page_layout.css?v=1749179669910","css/public.css?v=1749179669910","js/tools2.js?v=1749179669910","js/rules.js?v=1749179669910","js/index.vue_vue_type_script_setup_true_lang16.js?v=1749179669910","js/index.vue_vue_type_script_setup_true_lang5.js?v=1749179669910","js/index.vue_vue_type_script_setup_true_lang6.js?v=1749179669910","css/index14.css?v=1749179669910","js/index.vue_vue_type_script_setup_true_lang8.js?v=1749179669910","js/index.vue_vue_type_script_setup_true_lang.js?v=1749179669910","js/index97.js?v=1749179669910","css/index13.css?v=1749179669910","js/details3.js?v=1749179669910","js/http.js?v=1749179669910","js/index166.js?v=1749179669910","css/index25.css?v=1749179669910"])))=>i.map(i=>d[i]);
import{t as e,i as a,aj as t,l,a as i,db as n,N as s,c as o,b4 as r,a1 as d,a4 as u,p,ck as c,h as _,cY as m}from"./page_layout.js?v=1749179669910";import{c as f,f as v,u as y,h as g,a as x,d as b}from"./public.js?v=1749179669910";import{a as h,s as w}from"./tools2.js?v=1749179669910";import{d as R,O as W,P as k,Y as j,R as C,a0 as D,V as M,ab as U,r as S,j as z,S as P,a1 as $,U as I,a2 as E,k as L,v as O,c as T,F as B,t as F,aC as H,y as A,ae as V,N as Y,aj as N,x as q,e as G}from"./vue.js?v=1749179669910";import{bz as J,cp as K,cj as Q,T as X,ae as Z,ct as ee,cn as ae,cm as te,cz as le,ck as ie,cl as ne}from"./naive.js?v=1749179669910";import{l as se}from"./rules.js?v=1749179669910";import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1749179669910";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1749179669910";import{_ as de}from"./index.vue_vue_type_script_setup_true_lang.js?v=1749179669910";import{_ as ue}from"./index97.js?v=1749179669910";import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang16.js?v=1749179669910";import{j as ce}from"./common.js?v=1749179669910";const _e=t=>e.post("/plugin?action=a&name=btwaf&s=get_id_log",t,{requestOptions:{loading:a.global.t("Waf.Api.report_1")}}),me=R({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,{t:n}=W(),s=t(),{columns:o}=f([{key:"ip",title:n("Waf.Report.index_7"),ellipsis:{tooltip:!0}},{key:"address",title:n("Waf.Report.index_8"),ellipsis:{tooltip:!0}},{key:"num",title:n("Waf.Report.index_9"),width:"14%",minWidth:120},{key:"num",title:n("Waf.Report.index_10"),width:"32%",minWidth:160,render:e=>{const{total:t}=a,i=l((100*(t?e.num/t:0)).toFixed(1));return k("div",{class:"w-90%"},[k(J,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:i,color:s.value.successColor},null)])}},v({width:120,options:e=>[{label:n("Waf.Report.index_11"),onClick:()=>{h(e)}},{label:n("Public.Btn.Details"),onClick:()=>{y({title:n("Waf.Report.index_12",[e.ip]),width:950,minHeight:672,data:{row:e},component:j((()=>i((()=>import("./details2.js?v=1749179669910")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))))})}}]})]);return(e,a)=>{const t=g;return C(),D(t,{loading:e.loading,data:e.data,columns:M(o)},null,8,["loading","data","columns"])}}}),fe=R({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,n=t(),{t:s}=W(),{columns:o}=f([{key:"uri",title:"URI",ellipsis:{tooltip:!0}},{key:"num",title:s("Waf.Report.index_9"),width:"20%"},{key:"num",title:s("Waf.Report.index_10"),render:e=>{const{total:t}=a,i=l((100*(t?e.num/t:0)).toFixed(1));return k("div",{class:"w-90%"},[k(J,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:i,color:n.value.successColor},null)])}},v({width:120,options:e=>[{label:s("Waf.Report.index_11"),onClick:()=>{r(e)}},{label:s("Public.Btn.Details"),onClick:()=>{d(e)}}]})]),r=e=>{x({title:s("Waf.Report.index_19"),content:()=>k(U,{tag:"div",keypath:"Waf.Report.index_33",scope:"global"},{index_1:()=>k("span",{class:"text-error"},[e.uri])}),onConfirm:async()=>{await se({url_rule:e.uri})}})},d=e=>{y({title:s("Waf.Report.index_20",[e.uri]),width:950,minHeight:600,data:{uri:e.uri,list:e.list},component:j((()=>i((()=>import("./details3.js?v=1749179669910")),__vite__mapDeps([19,1,2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,11]))))})};return(e,a)=>{const t=g;return C(),D(t,{loading:e.loading,data:e.data,columns:M(o)},null,8,["loading","data","columns"])}}}),ve={class:"p-8px"},ye={class:"w-160px"},ge={class:"min-w-160px mr-20px"},xe={class:"text-desc"},be={class:"w-450px"},he=R({__name:"index",setup(a){const{t:t}=W(),l=S(null),p=z({p:1,limit:10,site:"all",type:"1",search:"",time:null}),c={search:{trigger:["input","blur"],validator:()=>"4"===p.type||""!==p.search.trim()||new Error(t("Waf.Report.index_28"))},time:{trigger:["change"],validator:()=>"4"!==p.type||null!==p.time||new Error(t("Waf.Report.index_29"))}},_=S([{label:t("Waf.Report.index_30"),value:"all"}]),m=[{label:"IP",value:"1"},{label:"URI",value:"2"},{label:"URL",value:"3"},{label:t("Waf.Report.index_31"),value:"4"}],{table:x,columns:b,setLoading:h}=f([{key:"time_localtime",title:t("Waf.Report.index_13"),width:"18%",minWidth:150},{key:"ip",title:t("Waf.Report.index_7"),width:"14%",minWidth:120},{key:"server_name",title:t("Waf.Report.index_14"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},{key:"uri",title:"URI",ellipsis:{tooltip:!0},minWidth:160,render:e=>n(e.uri)},{key:"filter_rule",title:t("Waf.Report.index_1"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},v({width:100,options:e=>[{label:t("Public.Btn.Details"),onClick:async()=>{const{message:a}=await _e({id:e.id});s(a)&&a.length>0&&w(a[0])}},{label:"HTTP",onClick:()=>{R(e)}}]})]),R=e=>{y({title:t("Waf.Report.index_32",[e.time_localtime]),width:800,minHeight:458,data:{id:e.id},component:j((()=>i((()=>import("./http.js?v=1749179669910")),__vite__mapDeps([20,21,4,2,3,5,6,1,8,7,22,9,10,12,13,14,15,16,17,18,11]))))})},D=async()=>{var a,t;try{await(null==(a=l.value)?void 0:a.validate()),h(!0);const{message:i}=await(t=(()=>{const{time:e}=p,a=e?u(e[0],"yyyy-MM-dd"):"",t=e?u(e[1],"yyyy-MM-dd"):"";return{..."all"===p.site?{is_all:1}:{server_name:p.site},..."4"===p.type?{start_time:a,end_time:t}:{serach:p.search},p:p.p,type:p.type}})(),e.post("/plugin?action=a&name=btwaf&s=get_search",t));o(i)&&(x.data=s(i.data)?i.data:[],x.total=r(i.page))}finally{h(!1)}};return(async()=>{try{const{message:a}=await e.post("/plugin?action=a&name=btwaf&s=get_server_name");s(a)&&(_.value=a.map((e=>({label:e,value:e}))))}finally{_.value.unshift({label:t("Waf.Report.index_30"),value:"all"})}})(),(e,a)=>{const t=K,i=Q,n=ue,s=d,o=X,r=de,u=g,f=re,v=oe;return C(),P("div",ve,[k(r,{ref_key:"formRef",ref:l,model:M(p),rules:c},{default:$((()=>[k(i,{label:e.$t("Waf.Report.index_21")},{default:$((()=>[I("div",ye,[k(t,{value:M(p).site,"onUpdate:value":a[0]||(a[0]=e=>M(p).site=e),options:M(_)},null,8,["value","options"])])])),_:1},8,["label"]),k(i,{label:e.$t("Waf.Report.index_22")},{default:$((()=>[I("div",ge,[k(t,{value:M(p).type,"onUpdate:value":a[1]||(a[1]=e=>M(p).type=e),options:m},null,8,["value"])]),I("div",null,[a[6]||(a[6]=I("span",{class:"mr-8px text-error"},"*",-1)),I("span",xe,E(e.$t("Waf.Report.index_23")),1)])])),_:1},8,["label"]),L(k(i,{label:e.$t("Waf.Report.index_25"),path:"search"},{default:$((()=>[I("div",be,[k(n,{value:M(p).search,"onUpdate:value":a[2]||(a[2]=e=>M(p).search=e),rows:3},null,8,["value"])])])),_:1},8,["label"]),[[O,"4"!==M(p).type]]),L(k(i,{label:e.$t("Waf.Report.index_26"),path:"time"},{default:$((()=>[k(s,{value:M(p).time,"onUpdate:value":a[3]||(a[3]=e=>M(p).time=e),type:"daterange",clearable:""},null,8,["value"])])),_:1},8,["label"]),[[O,"4"===M(p).type]]),k(i,{label:" "},{default:$((()=>[k(o,{type:"primary",onClick:D},{default:$((()=>[T(E(e.$t("Waf.Report.index_27")),1)])),_:1})])),_:1})])),_:1},8,["model"]),k(v,null,{table:$((()=>[k(u,{loading:M(x).loading,data:M(x).data,columns:M(b)},null,8,["loading","data","columns"])])),pageRight:$((()=>[k(f,{page:M(p).p,"onUpdate:page":a[4]||(a[4]=e=>M(p).p=e),"page-size":M(p).limit,"onUpdate:pageSize":a[5]||(a[5]=e=>M(p).limit=e),"display-order":["pages"],"item-count":M(x).total,onRefresh:D},null,8,["page","page-size","item-count"])])),_:1})])}}}),we={class:"h-full p-10px"},Re=p(R({__name:"index",props:{loading:{type:Boolean,default:!1},data:{default:()=>[]}},setup(e){const{columns:a}=f([{key:"ip",title:"",align:"center",render:e=>k(B,null,[k("a",{class:"bt-link",href:"javascript:;",onClick:()=>{h(e)}},[e.ip]),k("span",{class:"mx-6px"},[e.address]),k("span",null,[T("("),e.num,T(")")])])}]);return(e,t)=>{const l=g;return C(),P("div",we,[k(l,{class:"rank-table",loading:e.loading,data:e.data,"flex-height":!0,bordered:!1,"single-line":!1,"single-column":!1,columns:M(a)},null,8,["loading","data","columns"])])}}}),[["__scopeId","data-v-9bacc249"]]),We={class:"flex-center h-full p-10px"},ke=R({__name:"index",props:{data:{default:()=>[]}},setup(e){const a=F(e,"data"),{t:t}=W(),l=S(!1),i=H({backgroundColor:"#fff",title:s(),tooltip:{trigger:"item",confine:!0,formatter(e){const a=e;return"".concat(a.marker," ").concat(a.name,": ").concat(a.value," (").concat(a.percent,"%)")}},series:o()}),n=["#6ec71e","#4885FF","#fc8b40","#818af8","#31c9d7","#f35e7a","#ab7aee","#14d68b","#cde5ff"];function s(e=0){return{text:t("Waf.Report.index_18"),textStyle:{color:"#484848",fontSize:17},subtext:"".concat(e),subtextStyle:{color:"#717171",fontSize:15},itemGap:20,left:"center",top:"42%"}}function o(e=[]){return[{type:"pie",data:e,radius:["50%","60%"],center:["50%","50%"],clockwise:!0,avoidLabelOverlap:!0,label:{show:!0,position:"outside",color:"#999",lineHeight:18,formatter:e=>""!==e.name?0===e.percent?"":t("Waf.Overview.index_33",[e.name,e.value,e.percent]):""},labelLine:{length:30,length2:30,lineStyle:{width:1,color:"#CDCDCD"}},itemStyle:{labelLine:{length:30,length2:30,lineStyle:{width:1,color:"#CDCDCD"}},color:e=>n[e.dataIndex]},emphasis:{scaleSize:15}}]}return A((()=>{a.value&&(l.value=!a.value.length,(()=>{let e=0;const t=[];a.value.forEach((a=>{e+=a[1],t.push({name:a[0],value:a[1]})})),i.title=s(e),i.series=o(t)})())})),(e,a)=>{const t=Z;return C(),P("div",We,[M(l)?(C(),D(t,{key:0})):(C(),D(pe,{key:1,type:"pie",height:"100%",option:M(i)},null,8,["option"]))])}}}),je={class:"flex"},Ce=p(R({__name:"date",props:{value:{default:"today"},valueModifiers:{}},emits:["update:value"],setup(e){const{t:a}=W(),t=S("today"),l=S(null),i=V(e,"value"),n=[{label:a("Public.Search.Yesterday"),value:"yesterday"},{label:a("Public.Search.Today"),value:"today"}],o=e=>{l.value=null,i.value=e},r=e=>{t.value=e?"":"today",i.value=s(e)?e:"today"};return A((()=>{s(i.value)?(l.value=i.value,t.value=""):(t.value=i.value,l.value=null)})),(e,a)=>{const i=ee,s=ae,u=d;return C(),P("div",je,[k(s,{value:M(t),"onUpdate:value":[a[0]||(a[0]=e=>N(t)?t.value=e:null),o],size:"small",class:"bt-radio"},{default:$((()=>[(C(),P(B,null,Y(n,(e=>k(i,{key:e.value,value:e.value},{default:$((()=>[T(E(e.label),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"]),k(u,{value:M(l),"onUpdate:value":[a[1]||(a[1]=e=>N(l)?l.value=e:null),r],type:"daterange",size:"small",class:"bt-date-picker",clearable:!0},null,8,["value"])])}}}),[["__scopeId","data-v-9ee89472"]]),De={class:"h-320px"},Me={class:"h-320px"},Ue=p(R({__name:"index",setup(a){const{loading:t,setLoading:l}=b(),i=S("ip"),n=q({type:[],ip:[],ip_list:{},uri:[],uri_list:{}}),s=G((()=>n.value.ip.map((e=>({ip:e[0],num:e[1],address:e[2],data:n.value.ip_list[e[0]]}))))),r=G((()=>n.value.uri.map((e=>({uri:e[0],num:e[1],list:n.value.uri_list[e[0]].ip_list||[]}))))),d=G((()=>{let e=0;return n.value.type.forEach((a=>{e+=a[1]})),e})),p=e=>{"search"!==e&&x()},f=()=>{x()},v=()=>{const e=m();if("today"===y.date)window.open("".concat(e,"/btwaf/content_report.html"));else{const{start:a,end:t}=g();window.open("".concat(e,"/btwaf/content_report.html?stime=").concat(a,"&etime=").concat(t))}},y=z({date:"today"}),g=()=>{let e="",a="";if(_(y.date))switch(y.date){case"today":e=u(new Date,"yyyy-MM-dd"),a=u(new Date,"yyyy-MM-dd");break;case"yesterday":e=u(ce(new Date,-1),"yyyy-MM-dd"),a=u(ce(new Date,-1),"yyyy-MM-dd")}else e=u(new Date(y.date[0]),"yyyy-MM-dd"),a=u(new Date(y.date[1]),"yyyy-MM-dd");return{start:e,end:a}},x=async()=>{try{l(!0);const{message:t}=await(a=(()=>{const{start:e,end:a}=g();return{..."today"!==y.date?{start_time:e,end_time:a}:{}}})(),e.post("/plugin?action=a&name=btwaf&s=get_report",a));o(t)&&(n.value=t)}finally{l(!1)}var a};return x(),(e,a)=>{const l=te,o=le,u=X,_=ie,m=ne,g=c;return C(),D(g,{class:"report-grid","x-gap":"16"},{default:$((()=>[k(o,{span:"6"},{default:$((()=>[k(l,{class:"report-card mb-16px",title:e.$t("Waf.Report.index_1")},{default:$((()=>[I("div",De,[k(ke,{data:M(n).type},null,8,["data"])])])),_:1},8,["title"]),k(l,{class:"report-card",title:e.$t("Waf.Report.index_2")},{default:$((()=>[I("div",Me,[k(Re,{loading:M(t),data:M(s)},null,8,["loading","data"])])])),_:1},8,["title"])])),_:1}),k(o,{span:"18"},{default:$((()=>[k(l,{class:"h-full"},{default:$((()=>[k(m,{value:M(i),"onUpdate:value":[a[1]||(a[1]=e=>N(i)?i.value=e:null),p],type:"line",class:"report-tabs"},{prefix:$((()=>a[2]||(a[2]=[I("div",null,null,-1)]))),suffix:$((()=>[k(Ce,{value:M(y).date,"onUpdate:value":[a[0]||(a[0]=e=>M(y).date=e),f]},null,8,["value"]),k(u,{class:"ml-16px",type:"primary",size:"small",onClick:v},{default:$((()=>[T(E(e.$t("Waf.Report.index_3")),1)])),_:1}),a[3]||(a[3]=I("div",{class:"w-16px"},null,-1))])),default:$((()=>[k(_,{name:"ip",tab:e.$t("Waf.Report.index_4")},{default:$((()=>[k(me,{loading:M(t),total:M(d),data:M(s)},null,8,["loading","total","data"])])),_:1},8,["tab"]),k(_,{name:"uri",tab:e.$t("Waf.Report.index_5")},{default:$((()=>[k(fe,{loading:M(t),total:M(d),data:M(r)},null,8,["loading","total","data"])])),_:1},8,["tab"]),k(_,{name:"search",tab:e.$t("Waf.Report.index_6")},{default:$((()=>[k(he)])),_:1},8,["tab"])])),_:1},8,["value"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-0329e270"]]),Se=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{_e as g,Se as i};
