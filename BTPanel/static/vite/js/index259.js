import{_ as e,c as a,f as l,a as s,d as t,h as n,u as i}from"./public.js?v=1758789124250";import{k as o,e as r,r as u,R as d,V as c,W as p,a3 as v,U as m,S as b,a0 as f,P as g,o as _,n as x,b as w,a4 as h,j as y,ak as S,c as k,w as j,a2 as I,an as H}from"./vue.js?v=1758789124250";import{e7 as C,bh as N,u as U,_ as A,m as W,e8 as B,W as E,p as O,S as P,d as R}from"./page_layout.js?v=1758789124250";import{j as $,k as z}from"./php.js?v=1758789124250";import{_ as M}from"./index.vue_vue_type_script_setup_true_lang.js?v=1758789124250";import{dR as L,dV as T,da as V,d8 as D,dU as F,dT as q,dj as G}from"./naive.js?v=1758789124250";import{L as J}from"./leader-line-vue.js?v=1758789124250";const K={class:"p-16px"},Q=o({__name:"server-select",props:{callBack:{type:Function,default:()=>{}}},setup(a,{expose:l}){const s=a,t=r({webServer:"nginx"}),n=u([{label:"Nginx",value:"nginx"},{label:"Apache",value:"apache"},{label:"Openlitespeed",value:"openlitespeed"}]);return l({onConfirm:async()=>{await C({status:"disable",reserve:t.webServer}),s.callBack()}}),(a,l)=>{const s=T,i=L,o=M,r=e;return c(),d("div",K,[p(o,{class:"my-16px",model:m(t)},{default:v(()=>[p(i,{label:"Web Server"},{default:v(()=>[p(s,{class:"w-300px!",value:m(t).webServer,"onUpdate:value":l[0]||(l[0]=e=>m(t).webServer=e),options:m(n)},null,8,["value","options"])]),_:1})]),_:1},8,["model"]),p(r,null,{default:v(()=>l[1]||(l[1]=[b("li",null,"Please select the service you want to keep",-1)])),_:1,__:[1]})])}}}),X={class:"p-16px"},Y={class:"border-view mb-20px",id:"nginx-select"},Z={class:"border-view",id:"proxy-select"},ee={class:"flex items-center my-20px"},ae={class:"mr-10px"},le={class:"w-280px"},se={class:"w-280px"},te=O(o({__name:"version-select",setup(a,{expose:l}){const s=N(),{webserver:t}=f(s),{t:n}=g(),i=U(),o=u(1),r=u([{name:"Nginx",icon:"nginx",value:"1.24",version:[{label:"Nginx 1.24",value:"1.24"},{label:"Nginx 1.25",value:"1.25"},{label:"Nginx 1.26",value:"1.26"},{label:"Nginx 1.27",value:"1.27"},{label:"Nginx 1.28",value:"1.28"}],disabled:!1},{name:"Apache",icon:"apache",value:"2.4",version:[{label:"Apache 2.4",value:"2.4"}],disabled:!1},{name:"Openlitespeed",icon:"openlitespeed",value:"1.8",version:[{label:"Openlitespeed 1.8",value:"1.8"}],disabled:!1}]);let k=null;_(async()=>{await s.getPHPConfig(),await x(),r.value.forEach(e=>{e.icon===t.value&&(e.disabled=!0)}),setTimeout(()=>{(()=>{const e=document.getElementById("nginx-select"),a=document.getElementById("proxy-select");e&&a?k=J.setLine(e,a,{color:"var(--color-border)",size:2,path:"grid",startSocket:"right",endSocket:"right"}):console.warn("Elements not found, will retry on mounted")})()},500)}),w(()=>{k&&k.remove()});return l({onConfirm:async()=>{const e=W.loading(n("Home.Install.index_13"));try{const e=r.value.filter(e=>e.disabled);for(const a of r.value)e.includes(a)||await B({sName:a.icon,version:a.value,type:o.value,id:50,Skip:!0});await E(),i.getConfigSimple()}finally{e.close()}}}),(a,l)=>{const s=A,t=T,n=V,i=F,u=D,f=q,g=e;return c(),d("div",X,[b("div",Y,[p(n,{class:"flex-nowrap! items-center"},{default:v(()=>[p(s,{name:"soft-".concat(m(r)[0].icon),size:"32"},null,8,["name"]),p(t,{value:m(r)[0].value,"onUpdate:value":l[0]||(l[0]=e=>m(r)[0].value=e),options:m(r)[0].version,disabled:m(r)[0].disabled},null,8,["value","options","disabled"])]),_:1})]),b("div",Z,[p(n,{class:"flex-nowrap! items-center"},{default:v(()=>[p(s,{name:"soft-".concat(m(r)[1].icon),size:"32"},null,8,["name"]),p(t,{value:m(r)[1].value,"onUpdate:value":l[1]||(l[1]=e=>m(r)[1].value=e),options:m(r)[1].version,disabled:m(r)[1].disabled},null,8,["value","options","disabled"])]),_:1}),p(n,{class:"flex-nowrap! items-center mt-12px"},{default:v(()=>[p(s,{name:"soft-".concat(m(r)[2].icon),size:"32"},null,8,["name"]),p(t,{value:m(r)[2].value,"onUpdate:value":l[2]||(l[2]=e=>m(r)[2].value=e),options:m(r)[2].version,disabled:m(r)[2].disabled},null,8,["value","options","disabled"])]),_:1})]),b("div",ee,[b("span",ae,h(a.$t("Home.Install.index_4")),1),p(f,{value:m(o),"onUpdate:value":l[3]||(l[3]=e=>S(o)?o.value=e:null)},{default:v(()=>[p(u,{trigger:"hover"},{trigger:v(()=>[p(i,{value:1},{default:v(()=>[y(h(a.$t("Home.Install.index_5")),1)]),_:1})]),default:v(()=>[b("div",le,h(a.$t("Home.Install.index_6")),1)]),_:1}),p(u,{trigger:"hover"},{trigger:v(()=>[p(i,{value:0},{default:v(()=>[y(h(a.$t("Home.Install.index_7")),1)]),_:1})]),default:v(()=>[b("div",se,h(a.$t("Home.Install.index_8")),1)]),_:1})]),_:1},8,["value"])]),p(g,{class:"mt-10px"},{default:v(()=>l[4]||(l[4]=[b("li",null,"After enabling multiple services, Apache, Nginx, and Openlitespeed will be installed",-1)])),_:1,__:[4]})])}}}),[["__scopeId","data-v-f88636ab"]]),ne=O(o({__name:"index",setup(o){const r=U(),{isMultiServiceInstall:d,taskCount:g}=f(r),_=u(!1),x=k(()=>g.value>0&&d.value),{table:w,columns:h}=a([{key:"webserver",title:"Web server"},{key:"status",title:"Status",render:e=>p("span",{class:e.status?"text-primary":"text-error"},[e.status?"Running":"stop"])},l({width:190,options:e=>[{label:"Repair",onClick:()=>{C(e.name)}}]})]),S=async e=>{i(e?{title:"Enable multiple services",width:400,footer:!0,component:te}:{title:"Retention Service",width:480,footer:!0,data:{callBack:()=>{W(),r.getConfigSimple()}},component:Q})},C=async e=>{s({title:"Repair multiple services",content:"The repair process will make the website inaccessible. Do you want to continue?",onConfirm:async()=>{await $({server:e})}})},{loading:N,setLoading:A}=t();j(()=>x.value,e=>{e||W()});const W=async()=>{try{A(!0);const{message:e}=await z();R(e)&&(_.value=e.status,w.data=Object.entries(e).filter(([e])=>"status"!==e).map(([e,a])=>({webserver:e.charAt(0).toUpperCase()+e.slice(1),name:e,status:a})))}finally{A(!1)}};return W(),(a,l)=>{const s=G,t=V,i=e,o=n,r=P;return c(),I(r,{show:m(N)||m(x),description:m(x)?"Switching, please wait...":""},{default:v(()=>[p(t,{class:"items-center mt-10px"},{default:v(()=>[l[0]||(l[0]=b("span",null,"Multi-WebServer Hosting",-1)),p(s,{value:m(_),"onUpdate:value":S,disabled:m(x)},null,8,["value","disabled"])]),_:1,__:[0]}),p(i,{class:"my-16px"},{default:v(()=>l[1]||(l[1]=[b("li",null,[y("Please make sure the following ports are not in use: "),b("span",{class:"text-warning"},"8188, 8189, 8190, 8288, 8289, 8290, 80, 443")],-1),b("li",null,"After switching to Multi-WebServer Hosting service architecture, you can specify its own WebEngine for each website",-1),b("li",null,"Before enabling Multi-WebServer Hosting, ensure that the current service master configuration, port, and individual website configuration have not been manually modified. Please restore the original configuration or uninstall and reinstall from the App Store. ",-1)])),_:1,__:[1]}),m(_)?(c(),I(o,{key:0,data:m(w).data,columns:m(h),loading:m(N)},null,8,["data","columns","loading"])):H("",!0)]),_:1},8,["show","description"])}}}),[["__scopeId","data-v-35bcab84"]]);export{ne as O};
