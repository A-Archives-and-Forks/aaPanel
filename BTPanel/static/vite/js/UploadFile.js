import{_ as e}from"./index.js?v=1756367574781";import{n as l,_ as a,cm as t,m as i,t as s,p as o}from"./page_layout.js?v=1756367574781";import{a as n}from"./public.js?v=1756367574781";import{u,g as d}from"./index39.js?v=1756367574781";import{k as c,P as p,i as f,r,W as m,a2 as v,V as h,a3 as y,S as g,a4 as x,U as _,ak as w,c as k,R as M,j as b,an as C,F as j,O as S,I as $}from"./vue.js?v=1756367574781";import{dg as z,di as P,aC as F}from"./naive.js?v=1756367574781";import"./common.js?v=1756367574781";import"./__commonjsHelpers__.js?v=1756367574781";import"./soft2.js?v=1756367574781";import"./soft.js?v=1756367574781";import"./file2.js?v=1756367574781";import"./index.vue_vue_type_script_setup_true_lang7.js?v=1756367574781";const U={class:"p-20px"},I={class:"flex items-center gap-10px mb-16px"},N={class:"flex-1 w-0 text-14px"},L=c({__name:"FileConflict",props:{fileList:{}},emits:["step","confirm"],setup(t,{emit:i}){const{t:s}=p(),o=i,n=f("fileStore"),{fileConflictShow:u}=n,d=r([{title:s("file.uploadModal.conflictFileName"),key:"filename",ellipsis:{tooltip:!0}},{title:s("file.uploadModal.conflictFileDifference"),key:"difference",width:200,render:e=>m("span",null,[l(e.size)+"--\x3e"+l(e.size)])}]),c=()=>{o("step")},k=()=>{o("confirm")};return(l,t)=>{const i=a,o=z,n=e;return h(),v(n,{show:_(u),"onUpdate:show":t[0]||(t[0]=e=>w(u)?u.value=e:null),title:_(s)("file.uploadModal.conflictTitle"),width:600,footer:!0,"confirm-text":_(s)("file.uploadModal.conflictOverwrite"),"cancel-text":_(s)("file.uploadModal.conflictSkip"),onCancel:c,onConfirm:k},{default:y(()=>[g("div",U,[g("div",I,[m(i,{name:"base-warning",class:"text-warning text-30px"}),g("div",N,x(_(s)("file.uploadModal.conflictMessage")),1)]),m(o,{"max-height":400,columns:_(d),data:l.fileList},null,8,["columns","data"])])]),_:1},8,["show","title","confirm-text","cancel-text"])}}}),R={class:"p-20px"},A={key:0,class:"flex justify-between items-center mb-16px"},B={key:1,class:"status-tools-wrapper mb-16px"},E={class:"status-tools"},H={class:"tools-item"},O={class:"item-label"},T={class:"value"},D={class:"tools-item"},V={class:"item-label"},W={class:"value"},q={class:"tools-item"},G={class:"item-label"},J={class:"value"},K={key:0,class:"tools-item"},Q={class:"item-label"},X={class:"value"},Y={key:2,class:"files-list-wrapper"},Z={class:"files-tit"},ee={class:"name"},le={class:"size"},ae={class:"status"},te={class:"operation"},ie={class:"name"},se={class:"size"},oe={class:"status"},ne={class:"operation"},ue={key:3,class:"file-empty"},de={class:"flex justify-end gap-16px mt-20px"},ce=o(c({__name:"UploadFile",setup(o,{expose:c}){const z=f("fileStore"),{uploadFileList:U,uploadShow:I}=z,{currentPath:N,uploadComplete:ce,startUpload:pe,fileConflictShow:fe}=z,re=r([]),{t:me}=p(),ve=r({total:0,done:0,time:0,speed:0,num:0}),he=r(),ye=r(),ge=r([{key:"file",label:k(()=>me("file.uploadFile"))},{key:"dir",label:k(()=>me("file.uploadFolder"))}]);function xe(e){"file"==e?_e():ye.value.click()}function _e(){he.value.click()}function we(e){const l=e.target.files;if(l){let e=!1;for(let a=0;a<l.length;a++){-1==U.value.findIndex(e=>e.file.name==l[a].name)?U.value.push({relativePath:"",file:l[a],status:0,name:l[a].name,size:l[a].size,progress:0}):e=!0}e&&i.error(me("file.uploadModal.fileAlreadyExists"),{close:!0})}he.value.value=""}function ke(e){const l=e.target.files;if(l){let e=!1;for(let a=0;a<l.length;a++){let t=l[a].webkitRelativePath.split("/");t.pop();-1==U.value.findIndex(e=>e.file.name==l[a].name)?U.value.push({relativePath:t.join("/"),file:l[a],name:l[a].name,status:0,size:l[a].size,progress:0}):e=!0}e&&i.error(me("file.uploadModal.fileAlreadyExists"),{close:!0})}ye.value.value=""}function Me(){U.value=[]}function be(e){switch(e){case 0:return me("file.uploadModal.statusNotStarted");case 1:return me("file.uploadModal.statusUploading");case 2:return me("file.uploadModal.statusCompleted");case 3:return me("file.uploadModal.statusFailed")}}async function Ce(){const e=U.value.map(e=>e.relativePath?N.value+"/"+e.relativePath+"/"+e.file.name:N.value+"/"+e.file.name),l=await async function(e){return(await s.post("/files?action=upload_files_exists",{files:e.join("\n")})).message.filter(e=>e.exists)}(e);0==l.length?await $e():(re.value=l,fe.value=!0)}function je(){fe.value=!1,async function(){U.value=U.value.filter(e=>-1==re.value.findIndex(l=>l.filename.includes(e.file.name))),U.value.length>0?await $e():ze()}()}function Se(){fe.value=!1,$e()}async function $e(){ve.value.total=U.value.reduce((e,l)=>e+l.file.size,0),pe.value=!0;const e=function(){let e=0;const l=setInterval(()=>{e++,ve.value.time=e,ve.value.speed=ve.value.done/ve.value.time,console.log(ve.value)},1e3);return l}();for(let a=0;a<U.value.length;a++){U.value[a].status=1;try{await u(U.value[a].file,"/files?action=upload",1048576,N.value+"/"+U.value[a].relativePath,(e,l)=>{U.value[a].progress=e},e=>{isNaN(Number(e.message))||(ve.value.done=Number(e.message))}),U.value[a].status=2,ve.value.num+=1}catch(l){U.value[a].status=3,console.warn(l)}}clearInterval(e),ce.value=!0,d(z),U.value=[]}function ze(){ce.value=!1,pe.value=!1,ve.value={total:0,done:0,speed:0,num:0,time:0},U.value=[]}c({open(){I.value=!0},close(){I.value=!1}});const Pe=()=>{if(!ce.value&&U.value.length>0)return n({title:me("file.uploadModal.cancelUpload"),content:me("file.uploadModal.cancelUploadConfirm"),onConfirm(){I.value=!1}}),!1},Fe=()=>{ze()};return(i,s)=>{const o=a,n=F,u=P,d=t,c=e;return h(),M(j,null,[m(c,{show:_(I),"onUpdate:show":s[0]||(s[0]=e=>w(I)?I.value=e:null),title:i.$t("file.uploadModal.title"),width:720,onPublicClose:Pe,onAfterLeave:Fe},{default:y(()=>[g("div",R,[g("input",{type:"file",style:{display:"none"},ref_key:"fileInputRef",ref:he,onChange:we,multiple:""},null,544),g("input",{type:"file",style:{display:"none"},ref_key:"dirInputRef",ref:ye,onChange:ke,webkitdirectory:"",directory:"",multiple:""},null,544),_(pe)&&0!=_(U).length?(h(),M("div",B,[g("div",E,[g("div",H,[g("div",O,x(i.$t("file.uploadModal.uploadSize")),1),g("div",T,x("".concat(_(l)(_(ve).done),"/").concat(_(l)(_(ve).total))),1)]),g("div",D,[g("div",V,x(i.$t("file.uploadModal.averageSpeed")),1),g("div",W,x(_(l)(_(ve).speed))+"/s",1)]),g("div",q,[g("div",G,x(i.$t("file.uploadModal.uploadSuccess")),1),g("div",J,x(_(U).length)+" / "+x(_(ve).num),1)]),_(ce)?(h(),M("div",K,[g("div",Q,x(i.$t("file.uploadModal.totalTime")),1),g("div",X,x(_(ve).time)+"s",1)])):C("",!0)])])):(h(),M("div",A,[m(u,{options:_(ge),trigger:"hover",onSelect:xe},{default:y(()=>[m(n,{type:"primary","icon-placement":"right",onClick:_e},{icon:y(()=>[m(o,{name:"base-arrow-bottom",size:"14"})]),default:y(()=>[b(x(i.$t("file.uploadFile"))+" ",1)]),_:1})]),_:1},8,["options"]),m(n,{disabled:0==_(U).length,onClick:Me},{default:y(()=>[b(x(i.$t("Public.Btn.Clear")),1)]),_:1},8,["disabled"])])),_(U).length>0?(h(),M("div",Y,[g("div",Z,[g("span",ee,x(i.$t("file.uploadModal.fileName")),1),g("span",le,x(i.$t("file.uploadModal.fileSize")),1),g("span",ae,x(i.$t("file.uploadModal.uploadStatus")),1),g("span",te,x(i.$t("file.uploadModal.operation")),1)]),m(d,{style:{height:"350px"}},{default:y(()=>[(h(!0),M(j,null,S(_(U),(e,a)=>(h(),M("div",{class:"list-item",key:a},[g("span",ie,x(e.relativePath?"".concat(e.relativePath,"/").concat(e.file.name):e.file.name),1),g("span",se,x(_(l)(e.file.size)),1),g("span",oe,x(be(e.status)),1),g("span",ne,[2!==e.status?(h(),v(n,{key:0,text:"",type:"primary",onClick:e=>function(e){U.value.splice(e,1)}(a)},{default:y(()=>[b(x(i.$t("Public.Btn.Cancel")),1)]),_:2},1032,["onClick"])):C("",!0)]),g("div",{class:"progress",style:$({width:"".concat(e.progress,"%")})},null,4)]))),128))]),_:1})])):(h(),M("div",ue,[g("span",null,x(i.$t("file.uploadModal.dragFilesHere")),1)])),g("div",de,[_(pe)?(h(),v(n,{key:0,type:"primary",onClick:ze},{default:y(()=>[b(x(i.$t("file.uploadModal.continueUpload")),1)]),_:1})):(h(),v(n,{key:1,type:"primary",disabled:0==_(U).length,onClick:Ce},{default:y(()=>[b(x(i.$t("file.uploadModal.confirmUpload")),1)]),_:1},8,["disabled"]))])])]),_:1},8,["show","title"]),m(L,{"file-list":_(re),onStep:je,onConfirm:Se},null,8,["file-list"])],64)}}}),[["__scopeId","data-v-70709f9b"]]);export{ce as default};
