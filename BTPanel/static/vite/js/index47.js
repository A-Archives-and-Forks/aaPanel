const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/unsubscribe.js?v=1741416570306","js/index.js?v=1741416570306","js/vue.js?v=1741416570306","js/__commonjsHelpers__.js?v=1741416570306","js/common.js?v=1741416570306","js/public.js?v=1741416570306","js/page_layout.js?v=1741416570306","js/naive.js?v=1741416570306","css/page_layout.css?v=1741416570306","css/public.css?v=1741416570306","css/index90.css?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang.js?v=1741416570306","js/mail.js?v=1741416570306","js/index182.js?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang4.js?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang8.js?v=1741416570306","css/index19.css?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang5.js?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang6.js?v=1741416570306","js/campaign.js?v=1741416570306","js/index183.js?v=1741416570306","js/index104.js?v=1741416570306","css/index21.css?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang17.js?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang16.js?v=1741416570306","js/index95.js?v=1741416570306","js/upload.js?v=1741416570306","js/index103.js?v=1741416570306","css/index20.css?v=1741416570306","js/file.js?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang12.js?v=1741416570306","js/index.vue_vue_type_script_setup_true_lang7.js?v=1741416570306","js/index99.js?v=1741416570306","css/index16.css?v=1741416570306","css/index76.css?v=1741416570306"])))=>i.map(i=>d[i]);
var e=Object.defineProperty;import{_ as t}from"./index104.js?v=1741416570306";import{av as a,r as l,aC as i,d as n,ar as s,P as o,Q as r,N as u,$ as d,R as c,F as p,Y as m,S as v,ae as f,c as y,ao as _,j as h,a0 as g,_ as b,M as x,ap as w,aB as k,f as M,w as C,n as U,e as P,aq as R,af as j,m as E,t as T,G as D,H as S,k as B,v as $,W as z,a7 as L,u as A,ah as O,L as H}from"./vue.js?v=1741416570306";import{bP as G,b as I,U as N,a5 as W,u as F,k as q,G as K,j as V,I as J,bG as Q,bQ as Y,g as X,a as Z,m as ee,H as te,av as ae,az as le,d as ie}from"./page_layout.js?v=1741416570306";import{d as ne,a as se,c as oe,f as re,h as ue,i as de,s as ce,j as pe,k as me,l as ve,m as fe,n as ye,o as _e,p as he,q as ge,r as be,t as xe,u as we,v as ke,w as Me,x as Ce,y as Ue,z as Pe,A as Re,B as je,C as Ee,D as Te,E as De,F as Se,G as Be,H as $e,I as ze,J as Le,K as Ae,L as Oe,M as He,N as Ge,O as Ie,P as Ne,g as We,Q as Fe,R as qe}from"./campaign.js?v=1741416570306";import{e as Ke,b as Ve,c as Je,u as Qe,a as Ye,f as Xe,d as Ze,E as et,h as tt}from"./public.js?v=1741416570306";import{_ as at}from"./index.vue_vue_type_script_setup_true_lang17.js?v=1741416570306";import{j as lt,R as it,S as nt}from"./common.js?v=1741416570306";import{cm as st,cf as ot,T as rt,bX as ut,cu as dt,ch as ct,_ as pt,cb as mt,cw as vt,bR as ft,bV as yt,cg as _t,bS as ht,ci as gt,bO as bt,ce as xt,bu as wt}from"./naive.js?v=1741416570306";import{_ as kt}from"./index.vue_vue_type_script_setup_true_lang6.js?v=1741416570306";import{_ as Mt}from"./index.vue_vue_type_script_setup_true_lang16.js?v=1741416570306";import{_ as Ct}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1741416570306";import{b as Ut,c as Pt,a as Rt,i as jt,d as Et,e as Tt,s as Dt,f as St,h as Bt}from"./mail.js?v=1741416570306";import{_ as $t}from"./index.js?v=1741416570306";import{_ as zt}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1741416570306";import{_ as Lt}from"./index.vue_vue_type_script_setup_true_lang.js?v=1741416570306";import{_ as At}from"./index95.js?v=1741416570306";import{o as Ot}from"./upload.js?v=1741416570306";import{_ as Ht}from"./index103.js?v=1741416570306";import{g as Gt}from"./file.js?v=1741416570306";import{_ as It}from"./index.vue_vue_type_script_setup_true_lang12.js?v=1741416570306";import{_ as Nt}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1741416570306";import{_ as Wt}from"./index99.js?v=1741416570306";const Ft=a("menu-mail-market","overview"),qt=l(null),Kt=l(!1),Vt=l(-1),Jt=class e{constructor(){}static getInstance(){return e.instance||(e.instance=i()),e.instance}};var Qt,Yt;((t,a,l)=>{a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l})(Jt,"symbol"!=typeof(Qt="instance")?Qt+"":Qt,Yt);let Xt=Jt;const Zt=l(!1),ea=l(""),ta=l({type:"today",data:function(){const{start:e,end:t}=G(new Date);return[e.getTime(),t.getTime()]}()});function aa(){const e=Xt.getInstance();function t(){return{...ea.value?{domain:ea.value}:{},start_time:Math.floor(ta.value.data[0]/1e3),end_time:Math.floor(ta.value.data[1]/1e3)}}return{getRate:e=>e>=0?"".concat(e,"%"):"--",getChartTime:(e,t)=>{let a=new Date;return"hourly"===e?(a.setMinutes(0),a.setSeconds(0),a.setHours(t)):"daily"===e&&(a=new Date(1e3*t)),N(a)},getOverview:async function(){try{Zt.value=!0;const{message:a}=await ne(t());I(a)&&e.trigger(a)}finally{Zt.value=!1}},getParams:t,onResult:e.on}}const la={class:"w-240px ml-8px"},ia=n({__name:"date",props:{type:{},typeModifiers:{},value:{default:()=>[]},valueModifiers:{}},emits:["update:type","update:value"],setup(e){const t=s(e,"type"),a=s(e,"value");function l(e=new Date){const t=it(e),a=nt(e);return[t.getTime(),a.getTime()]}const i=e=>{switch(e){case"today":a.value=l();break;case"yesterday":a.value=l(lt(new Date,-1));break;case"7day":a.value=(()=>{const e=new Date,t=nt(e);return[it(lt(e,-6)).getTime(),t.getTime()]})()}},n=e=>{const t=new Date,a=lt(t,-30);return it(a).getTime()>e||nt(t).getTime()<e},m=e=>{t.value="custom",a.value=[it(e[0]).getTime(),nt(e[1]).getTime()]};return(e,l)=>{const s=st,v=ot,f=W;return o(),r(p,null,[u(v,{value:t.value,"onUpdate:value":[l[0]||(l[0]=e=>t.value=e),i]},{default:d((()=>[u(s,{label:e.$t("Public.Search.Today"),value:"today"},null,8,["label"]),u(s,{label:e.$t("Public.Search.Yesterday"),value:"yesterday"},null,8,["label"]),u(s,{label:e.$t("Public.Search.Last7"),value:"7day"},null,8,["label"])])),_:1},8,["value"]),c("div",la,[u(f,{value:a.value,type:"daterange","is-date-disabled":n,"onUpdate:value":m},null,8,["value"])])],64)}}}),na={class:"flex items-center justify-between"},sa={class:"flex items-center gap-16px"},oa={class:"w-240px"},ra={key:0},ua={class:"flex items-center"},da=n({__name:"index",setup(e){const t=F(),{getOverview:a}=aa(),{isFree:l}=m(t),i=()=>{Ke({source:324})},n=()=>{a()},s=()=>{a()};return(e,t)=>{const a=rt;return o(),r("div",na,[c("div",sa,[c("div",oa,[u(at,{value:v(ea),"onUpdate:value":[t[0]||(t[0]=e=>f(ea)?ea.value=e:null),n]},null,8,["value"])]),v(l)?(o(),r("div",ra,[t[4]||(t[4]=c("span",{class:"mr-8px"},"Upgrade to Pro Edition to unlock all reports immediately",-1)),u(a,{type:"primary",size:"small",ghost:"",onClick:i},{default:d((()=>t[3]||(t[3]=[y("Upgrade Now")]))),_:1})])):_("",!0)]),c("div",ua,[u(ia,{type:v(ta).type,"onUpdate:type":t[1]||(t[1]=e=>v(ta).type=e),value:v(ta).data,"onUpdate:value":[t[2]||(t[2]=e=>v(ta).data=e),s]},null,8,["type","value"])])])}}}),ca={class:"rate-box"},pa={class:"rate-list"},ma={class:"rate-text"},va={class:"rate-list"},fa={class:"rate-text"},ya={class:"rate-list"},_a={class:"rate-text"},ha={class:"rate-list"},ga={class:"rate-text"},ba=q(n({__name:"index",setup(e){const{onResult:t,getRate:a}=aa(),l=h({delivery:0,open:0,click:0,bounce:0});return t((e=>{l.delivery=e.dashboard.delivery_rate,l.open=e.dashboard.open_rate,l.click=e.dashboard.click_rate,l.bounce=e.dashboard.bounce_rate})),(e,t)=>(o(),r("div",ca,[c("div",pa,[t[0]||(t[0]=c("div",{class:"rate-title"},"Delivered",-1)),c("div",ma,g("".concat(v(l).delivery,"%")),1)]),c("div",va,[t[1]||(t[1]=c("div",{class:"rate-title"},"Open",-1)),c("div",fa,g(v(a)(v(l).open)),1)]),c("div",ya,[t[2]||(t[2]=c("div",{class:"rate-title"},"Click",-1)),c("div",_a,g(v(a)(v(l).click)),1)]),c("div",ha,[t[3]||(t[3]=c("div",{class:"rate-title"},"Bounce",-1)),c("div",ga,g(v(a)(v(l).bounce)),1)])]))}}),[["__scopeId","data-v-6ec46142"]]),xa=q(n({__name:"index",setup(e){const{getRate:t,onResult:a}=aa(),{table:l,columns:i}=Ve([{key:"mail_provider",title:"Mail Provider",ellipsis:{tooltip:!0}},{key:"delivery_rate",title:"Delivered",render:e=>t(e.delivery_rate)},{key:"open_rate",title:"Open",render:e=>t(e.open_rate)},{key:"click_rate",title:"Click",render:e=>t(e.click_rate)},{key:"bounce_rate",title:"Bounce",render:e=>t(e.bounce_rate)}]);return a((e=>{l.data=e.mail_providers})),(e,t)=>{const a=kt;return o(),b(a,{"min-height":268,"max-height":268,bordered:!1,loading:v(Zt),data:v(l).data,columns:v(i)},null,8,["loading","data","columns"])}}}),[["__scopeId","data-v-3bfb2bbb"]]),wa={class:"p-20px"},ka=n({__name:"error",setup(e){const{t:t}=x(),{getParams:a}=aa(),{loading:l,setLoading:i}=Je(),{table:n,columns:s}=Ve([{key:"recipient",title:t("Mail.Mass.index_50"),width:160,render:e=>u(ut,{class:e.tooltip?"":"break-all!","line-clamp":e.tooltip?999:1,tooltip:!1},{default:()=>[e.recipient]})},{key:"dsn",title:"Dsn",width:60},{key:"delay",title:t("Mail.Mass.index_51"),width:70},{key:"delays",title:t("Mail.Mass.index_52"),width:150},{key:"status",title:t("Public.Table.Status"),width:100,ellipsis:{tooltip:!0},render:e=>e.status},{key:"relay",title:t("Mail.Mass.index_53"),width:200,render:e=>u(ut,{class:e.tooltip?"":"break-all!","line-clamp":e.tooltip?9999:1,tooltip:!1},{default:()=>[e.relay]})},{key:"description",title:t("Public.Btn.Details"),render:e=>u(ut,{class:e.tooltip?"":"break-all!","line-clamp":e.tooltip?9999:1,tooltip:!1},{default:()=>[e.description]})}]),c=e=>({onMousemove:()=>{e.tooltip=!0},onMouseleave:()=>{e.tooltip=!1}});return(async()=>{try{i(!0);const e=a(),{message:t}=await Ut({...e.domain?{domain:e.domain}:{},start:e.start_time,end:e.end_time});n.data=K(t)?t.map((e=>({...e,tooltip:!1}))):[]}finally{i(!1)}})(),(e,t)=>{const a=kt,i=Ct;return o(),r("div",wa,[u(i,null,{table:d((()=>[u(a,{"max-height":600,loading:v(l),data:v(n).data,columns:v(s),"row-props":c},null,8,["loading","data","columns"])])),_:1})])}}}),Ma={class:"total-list"},Ca={class:"total-item"},Ua={class:"total-label"},Pa={class:"total-value text-primary text-22px"},Ra={class:"total-item"},ja={class:"total-label"},Ea={class:"total-value text-17px"},Ta={class:"total-item"},Da={class:"total-label"},Sa={class:"total-value text-17px"},Ba=q(n({__name:"index",setup(e){const{t:t}=x(),{onResult:a,getChartTime:i,getOverview:n}=aa(),s=w("chartRef"),m=l({delivered:0,delivery_rate:0,failed:0,failure_rate:0,sends:0}),f=()=>{Qe({title:t("Mail.Overview.today_9"),width:980,component:ka})},_=k({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},legend:{top:0,itemGap:16,icon:"circle",itemWidth:10,itemHeight:10,data:[t("Mail.Overview.today_2"),t("Mail.Overview.today_3")],textStyle:{lineHeight:12,padding:[0,0,-2,0],rich:{a:{verticalAlign:"middle"}}}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},yAxis:{type:"value",boundaryGap:[0,"6%"],splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#ebeef5"}}},xAxis:h(),series:[{type:"bar",name:t("Mail.Overview.today_3"),data:[]},{type:"bar",name:t("Mail.Overview.today_2"),data:[]}]});function h(e="HH:mm"){return{type:"category",axisLabel:{formatter:t=>N(t,e)}}}return a((e=>{e.send_mail_chart&&(m.value=e.send_mail_chart.dashboard,(e=>{const a=[],l=[];e.data.forEach((t=>{a.push([i(e.column_type,t.x),t.failed,e.column_type]),l.push([i(e.column_type,t.x),t.delivered,e.column_type])})),_.series=[{type:"bar",name:t("Mail.Overview.today_3"),data:a,stack:"total",itemStyle:{color:"#1A519B"}},{type:"bar",name:t("Mail.Overview.today_2"),data:l,stack:"total",itemStyle:{color:"#91CC75"}}],_.xAxis=h("hourly"===e.column_type?"HH:mm":"yyyy-MM-dd")})(e.send_mail_chart))})),M((()=>{setTimeout((()=>{if(s.value){s.value.getChart().on("click",(e=>{if("bar"===e.componentSubType&&K(e.value)&&"daily"===e.value[2]){const t=new Date(e.value[0]);ta.value.type="custom",ta.value.data=[it(t).getTime(),nt(t).getTime()],n()}}))}}),1e3)})),(e,t)=>{const a=V,l=J;return o(),r(p,null,[t[0]||(t[0]=c("div",{class:"mb-16px font-bold text-16px text-default"},"Send today",-1)),c("div",Ma,[c("div",Ca,[c("div",Ua,g(e.$t("Mail.Overview.today_1")),1),c("div",Pa,g(v(m).delivery_rate)+"%",1)]),c("div",Ra,[c("div",ja,g(e.$t("Mail.Overview.today_2")),1),c("div",Ea,g(v(m).delivered),1)]),c("div",Ta,[c("div",Da,[y(g(e.$t("Mail.Overview.today_3"))+" ",1),u(a,{class:"ml-4px",onClick:f},{default:d((()=>[y(g(e.$t("Public.Btn.Details")),1)])),_:1})]),c("div",Sa,[u(a,{class:"text-17px!",onClick:f},{default:d((()=>[y(g(v(m).failed),1)])),_:1})])])]),u(l,{class:"w-100% h-200px",show:v(Zt)},{default:d((()=>[u(Mt,{ref_key:"chartRef",ref:s,type:"bar",height:"200",option:v(_)},null,8,["option"])])),_:1},8,["show"])],64)}}}),[["__scopeId","data-v-1d6a0b1a"]]),$a=n({name:"AuthBox",setup(e,{slots:t}){const a=F(),{isFree:l}=m(a);return()=>{var e;return u(p,null,[l.value?u("div",{class:"text-14px color-desc"},[y("Pro Edition Exclusive Features")]):null==(e=t.default)?void 0:e.call(t)])}}}),za={class:"flex-center h-200px"},La=n({__name:"unique",setup(e){const{onResult:t,getChartTime:a}=aa(),l=k({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"2%",containLabel:!0},yAxis:{type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#ebeef5"}},name:"%",max:({max:e})=>e>100?100:e},xAxis:i(),series:n()});function i(e="HH:mm"){return{type:"category",axisLabel:{formatter:t=>N(t,e)}}}function n(e=[]){return[{name:"Unique Open Rate",type:"line",data:e,itemStyle:{color:"#1a519b"},smooth:!1,showSymbol:!1,sampling:"average"}]}return t((e=>{const{open_rate_chart:t}=e;if(t){const e=t.data.map((e=>[a(t.column_type,e.x),e.open_rate]));l.series=n(e),l.xAxis=i("hourly"===t.column_type?"HH:mm":"yyyy-MM-dd")}})),(e,t)=>{const a=J;return o(),r(p,null,[t[0]||(t[0]=c("div",{class:"mb-16px font-bold text-16px text-default"},"Unique Open Rate %",-1)),c("div",za,[u(v($a),null,{default:d((()=>[u(a,{class:"w-100%",show:v(Zt)},{default:d((()=>[u(Mt,{height:200,option:v(l)},null,8,["option"])])),_:1},8,["show"])])),_:1})])],64)}}}),Aa={class:"flex-center h-200px"},Oa=n({__name:"click",setup(e){const{onResult:t,getChartTime:a}=aa(),l=k({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"2%",containLabel:!0},yAxis:{name:"%",type:"value",boundaryGap:[0,"6%"],splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#ebeef5"}},max:({max:e})=>e>100?100:e},xAxis:i(),series:n()});function i(e="HH:mm"){return{type:"category",axisLabel:{formatter:t=>N(t,e)}}}function n(e=[]){return[{name:"Click Rate",type:"line",data:e,itemStyle:{color:"#1a519b"},smooth:!1,showSymbol:!1,sampling:"average"}]}return t((e=>{const{click_rate_chart:t}=e;if(t){const e=t.data.map((e=>[a(t.column_type,e.x),e.click_rate]));l.series=n(e),l.xAxis=i("hourly"===t.column_type?"HH:mm":"yyyy-MM-dd")}})),(e,t)=>{const a=J;return o(),r(p,null,[t[0]||(t[0]=c("div",{class:"mb-16px font-bold text-16px text-default"},"Click Rate %",-1)),c("div",Aa,[u(v($a),null,{default:d((()=>[u(a,{class:"w-100%",show:v(Zt)},{default:d((()=>[u(Mt,{height:200,option:v(l)},null,8,["option"])])),_:1},8,["show"])])),_:1})])],64)}}}),Ha={class:"flex-center h-200px"},Ga=n({__name:"bounce",setup(e){const{onResult:t,getChartTime:a}=aa(),l=k({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"2%",containLabel:!0},yAxis:{name:"%",type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",width:1,color:"#ebeef5"}},max:({max:e})=>e>100?100:e},xAxis:i(),series:n()});function i(e="HH:mm"){return{type:"category",axisLabel:{formatter:t=>N(t,e)}}}function n(e=[]){return[{name:"Bounce Rate",type:"line",data:e,itemStyle:{color:"#20a53a"},smooth:!1,showSymbol:!1,sampling:"average"}]}return t((e=>{const{bounce_rate_chart:t}=e;if(t){const e=t.data.map((e=>[a(t.column_type,e.x),e.bounce_rate]));l.series=n(e),l.xAxis=i("hourly"===t.column_type?"HH:mm":"yyyy-MM-dd")}})),(e,t)=>{const a=J;return o(),r(p,null,[t[0]||(t[0]=c("div",{class:"mb-16px font-bold text-16px text-default"},"Bounce Rate %",-1)),c("div",Ha,[u(v($a),null,{default:d((()=>[u(a,{class:"w-100%",show:v(Zt)},{default:d((()=>[u(Mt,{height:200,option:v(l)},null,8,["option"])])),_:1},8,["show"])])),_:1})])],64)}}}),Ia={class:"overview-card"},Na={class:"overview-card"},Wa={class:"overview-card"},Fa={class:"overview-card"},qa={class:"overview-card"},Ka=q(n({__name:"index",setup(e){const{getOverview:t}=aa();return t(),(e,t)=>{const a=dt,l=Q;return o(),r("div",null,[u(da),u(ba),u(l,{class:"mt-16px","x-gap":"16","y-gap":"16",cols:2},{default:d((()=>[u(a,null,{default:d((()=>[c("div",Ia,[u(xa)])])),_:1}),u(a,null,{default:d((()=>[c("div",Na,[u(Ba)])])),_:1}),u(a,null,{default:d((()=>[c("div",Wa,[u(La)])])),_:1}),u(a,null,{default:d((()=>[c("div",Fa,[u(Oa)])])),_:1}),u(a,null,{default:d((()=>[c("div",qa,[u(Ga)])])),_:1})])),_:1})])}}}),[["__scopeId","data-v-5777b7d2"]]);const Va=n({__name:"template",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e,{expose:t}){const a=s(e,"value"),i=l([]),{loading:n,setLoading:r}=Je(),u=async()=>{try{r(!0);const{message:e}=await se();K(e)&&e.length>0&&(i.value=e.map((e=>({label:e.name,value:e.id}))),a.value||(a.value=e[0].id))}finally{r(!1)}};return u(),t({getList:u}),(e,t)=>{const l=ct;return o(),b(l,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),loading:v(n),filterable:!0,options:v(i)},null,8,["value","loading","options"])}}}),Ja={class:"w-170px mr-10px"},Qa={class:"w-180px"},Ya=n({__name:"sender",props:{value:{},valueModifiers:{}},emits:R(["change"],["update:value"]),setup(e,{emit:t}){const a=t,i=l(null),n=s(e,"value"),d=l([]),m=P((()=>y.value.filter((e=>e.domain===i.value)).map((e=>({data:e,label:e.username,value:e.username}))))),y=l([]),_=(e,t)=>{const{data:l}=t;I(l)&&a("change",l.full_name)},h=l(!1),g=l(!1),b=async()=>{try{h.value=!0;const{message:e}=await Pt();K(e)&&(d.value=e.map((e=>({label:e,value:e}))),i.value=e[0]||null)}finally{h.value=!1}},x=async()=>{try{g.value=!0;const{message:e}=await Rt();K(e)&&e.length>0&&(y.value=e)}finally{g.value=!1}},w=()=>{if(m.value[0]){const{data:e}=m.value[0];n.value="".concat(m.value[0].value),I(e)&&a("change",e.full_name)}else n.value=null,a("change","")},k=()=>{w()};return(async()=>{if(await Promise.all([b(),x()]),n.value){for(const e of y.value)if(e.username===n.value){i.value=e.domain;break}}else w()})(),(e,t)=>{const a=ct;return o(),r(p,null,[c("div",Ja,[u(a,{value:v(i),"onUpdate:value":[t[0]||(t[0]=e=>f(i)?i.value=e:null),k],loading:v(h),options:v(d)},null,8,["value","loading","options"])]),c("div",Qa,[u(a,{value:n.value,"onUpdate:value":[t[1]||(t[1]=e=>n.value=e),_],loading:v(g),options:v(m)},null,8,["value","loading","options"])])],64)}}}),Xa={class:"flex items-center mb-8px"},Za={class:"ml-40px"},el=n({__name:"import",props:R({path:{default:""},accept:{default:()=>[]}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const t=e,{path:a,accept:l}=t,i=s(e,"value"),n=()=>{Ot({path:a,size:5,uploadData:{accept:l.map((e=>".".concat(e))).join(","),multiple:!1},onUploadSuccess:e=>{i.value=e[0].name}})};return(e,t)=>{const a=rt;return o(),r("div",null,[c("div",Xa,[u(a,{onClick:n},{default:d((()=>[y(g(e.$t("Public.Btn.Import")),1)])),_:1}),c("div",Za,[y(g(e.$t("Mail.Mass.index_43"))+" ",1),c("span",{class:j(i.value?"text-primary":"text-error")},g(i.value||e.$t("Mail.Mass.index_44")),3)])]),E(e.$slots,"default")])}}}),tl={class:"p-20px"},al={class:"w-250px"},ll=n({__name:"type-create",props:{refresh:{}},setup(e,{expose:t}){const a=e,{refresh:i}=a,n=l(null),s=h({mail_type:"",file:""}),p={mail_type:{required:!0,message:"Please enter group name",trigger:["blur","input"]},file:{required:!0,message:"Please upload file",trigger:["blur","change"]}},m=()=>{Y("/www/server/panel/plugin/mail_sys/data/example_recipients.txt")};return t({onConfirm:async()=>{var e;await(null==(e=n.value)?void 0:e.validate()),await jt({...s}),null==i||i()}}),(e,t)=>{const a=pt,l=mt,i=Lt,f=V,_=At;return o(),r("div",tl,[u(i,{ref_key:"formRef",ref:n,model:v(s),rules:p},{default:d((()=>[u(l,{label:"Group name",path:"mail_type"},{default:d((()=>[c("div",al,[u(a,{type:"text",value:v(s).mail_type,"onUpdate:value":t[0]||(t[0]=e=>v(s).mail_type=e),placeholder:"Please enter group name"},null,8,["value"])])])),_:1}),u(l,{label:"Emails",path:"file"},{default:d((()=>[u(el,{value:v(s).file,"onUpdate:value":t[1]||(t[1]=e=>v(s).file=e),path:"/www/server/panel/data/mail/in_bulk/recipient",accept:["txt","json"]},null,8,["value"])])),_:1})])),_:1},8,["model"]),u(_,{class:"mt-4px"},{default:d((()=>[c("li",null,[t[3]||(t[3]=y(" File type:txt/json One mailbox per line Not more than 5 MB ")),u(f,{target:"_blank",onClick:m},{default:d((()=>t[2]||(t[2]=[y("Download the template")]))),_:1})])])),_:1})])}}}),il={class:"flex-1"},nl={class:"flex items-center"},sl={class:"w-260px"},ol={class:"ml-10px"},rl={class:"mt-8px"},ul=n({__name:"type",props:{value:{},valueModifiers:{},name:{},nameModifiers:{}},emits:["update:value","update:name"],setup(e,{expose:t}){const a=s(e,"value"),i=s(e,"name"),n=l([]),p=l([]),m=l(0),{loading:f,setLoading:_}=Je(),h=async()=>{try{_(!0);const{message:e}=await oe();K(e)&&(p.value=e,n.value=e.map((e=>({label:e.mail_type,value:e.id}))))}finally{_(!1)}},b=async e=>{i.value=p.value.filter((t=>e.includes(t.id))).map((e=>e.mail_type));const{message:t}=await re({etypes:e.join(",")});I(t)&&(m.value=t.result)},x=()=>{Qe({title:"Create New Group",width:480,footer:!0,data:{refresh:h},component:ll})};return h(),t({getType:h}),(e,t)=>{const l=ct,i=V;return o(),r("div",il,[c("div",nl,[c("div",sl,[u(l,{value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),b],options:v(n),multiple:!0,filterable:!0,loading:v(f),placeholder:"Please select recipients with groups"},null,8,["value","options","loading"])]),c("div",ol,[u(i,{onClick:x},{default:d((()=>t[1]||(t[1]=[y("Create")]))),_:1})])]),c("div",rl,[t[2]||(t[2]=y("Send Emails (")),c("b",null,g(v(m)),1),t[3]||(t[3]=y(" Recipients)"))])])}}});var dl=(e=>(e.Columns="columns",e.Button="button",e.Divider="divider",e.Header="header",e.Text="text",e.Image="image",e.Menu="menu",e.Html="html",e.commonComp="commonComp",e))(dl||{});const cl=["button","divider","header","text","image","menu","html","commonComp"];const pl={comp_type:{button:()=>$l}};function ml(){const e=Object.keys(pl.comp_type);Object.entries(wl.value).forEach((([,t])=>{e.includes(t.type)&&Object.entries(Cl.value).forEach((([e,a])=>{if(e===t.key){const e=pl.comp_type[t.type]();a.style=vt(a.style,e)}}))}))}const vl=l(!1),fl=l(""),yl=l(""),_l=l("");l("bottom");const hl=l(""),gl=l([]),bl=l({}),xl=l({}),wl=l({}),kl=l({}),Ml=l({}),Cl=l({}),Ul=l({}),Pl=l({backgroundColor:"#ffffff",maxWidth:"500px"}),Rl=l(),jl=P((()=>({version:1.4,columns_source:gl.value,column_map:bl.value,cell_map:xl.value,cell_style_map:kl.value,column_row_style_map:Ml.value,comp_style_map:Cl.value,compOptions:Ul.value,comp_map:wl.value,page_style:Pl.value}))),El=l(!0),Tl=l((async()=>!1)),Dl=l([{type:"columns",name:"Columns",key:"0",children:[]},{type:"button",name:"Button",key:"0"},{type:"divider",name:"Divider",key:"0"},{type:"header",name:"Header",key:"0"},{type:"text",name:"Text",key:"0"},{type:"image",name:"Image",key:"0"},{type:"menu",name:"Menu",key:"0"}]),Sl={style:{background:"transparent",textAlign:"center",padding:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""},border:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""}}},Bl={style:{backgroundColor:"transparent",padding:{more:!1,all:"0px",top:"",right:"",bottom:"",left:""}}},$l={border:{more:!1,all:"",top:"",right:"",bottom:"",left:""},padding:{more:!0,all:"",top:"10px",left:"20px",right:"20px",bottom:"10px"},borderRadius:{more:!1,all:"4px",top:"",left:"",right:"",bottom:""},width:"auto",lineHeight:"120%",color:"#ffffff",display:"inline-block",backgroundColor:"#3AAEE0",FontWeight:"normal",fontSize:"14px",textAlign:"center",LetterSpacing:"0px"},zl={button:{style:$l,general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{href:"",target:"_blank"},content:"Button"},divider:{style:{borderTop:"1px solid #bbbbbb",width:"100%",display:"inline-block",lineHeight:"1px",height:"0px",verticalAlign:"middle"},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{}},header:{style:{position:"relative",display:"block",lineHeight:"140%",fontWeight:"normal",fontSize:"22px",letterSpacing:"0px",color:"#333333"},general:{textAlign:"left",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{},content:"Header"},text:{style:{fontSize:"14px",fontWeight:"normal",color:"#333",textAlign:"left",lineHeight:"140%",letterSpacing:"0px"},general:{padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{},content:"Text"},image:{style:{display:"inline-block",width:"100%"},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{href:"",target:"_blank",src:"",alt:""}},menu:{style:{fontWeight:"normal",fontSize:"14px",letterSpacing:"0px",color:"#444444",linkColor:"#0068A5",padding:{more:!0,all:"",top:"5px",left:"15px",right:"15px",bottom:"5px"}},general:{textAlign:"center",padding:{more:!1,all:"10px",top:"",left:"",right:"",bottom:""}},info:{layout:"horizontal"},links:[{id:hi(6),label:"Menu",href:""},{id:hi(6),label:"Menu",href:""}]}},Ll={events:{makeDom:[function(){let e=null;return()=>{clearTimeout(e),e=setTimeout((()=>{Rl.value=Hl().outerHTML,Al()}),300)}}()]},$emit(e,t){this.events[e]&&this.events[e].forEach((e=>e(t)))}};const Al=function(){let e=null;return()=>{El.value&&(El.value=!1,clearTimeout(e),e=setTimeout((async()=>{await Tl.value(),El.value=!0}),1e3))}}();function Ol(){const e=function(){var e,t,a,l,i,n,s;const o={};for(const r in wl.value){const u=document.createElement("div");Gl(u,Cl.value[r]);let d=null;switch(wl.value[r].type){case"button":d=document.createElement("a"),Il(d,Cl.value[r]);break;case"divider":d=document.createElement("div"),Nl(d,Cl.value[r]);break;case"header":d=document.createElement("div"),Wl(d,Cl.value[r]);break;case"text":d=document.createElement("div"),Fl(d,Cl.value[r]);break;case"image":if(null==(e=Cl.value[r].info)?void 0:e.href){d=document.createElement("a"),d.href=null==(t=Cl.value[r].info)?void 0:t.href,d.target=null==(a=Cl.value[r].info)?void 0:a.target;const e=document.createElement("img");e.src=(null==(l=Cl.value[r].info)?void 0:l.src)||"",e.alt=(null==(i=Cl.value[r].info)?void 0:i.alt)||"",e.style.display="block",e.style.width="100%",d.appendChild(e)}else d=document.createElement("img"),d.src=(null==(n=Cl.value[r].info)?void 0:n.src)||"",d.alt=(null==(s=Cl.value[r].info)?void 0:s.alt)||"";ql(d,Cl.value[r]);break;case"menu":d=document.createElement("div"),Kl(d,Cl.value[r])}d&&u.appendChild(d),o[r]={dom:u,general:{},info:Cl.value[r].info}}return o}(),t={};for(const a in xl.value){const l=document.createElement("td");l.style.width=xl.value[a].width,Jl(l,kl.value[a]),xl.value[a].children.forEach((t=>{if(e[t]){l.appendChild(e[t].dom);for(const a in e[t].general)l.style[a]=e[t].general[a]}})),t[a]={dom:l}}return t}function Hl(){const e=function(){const e=Ol(),t={};for(const a in bl.value){const l=document.createElement("tr"),i=document.createElement("td"),n=document.createElement("div");Vl(n,Ml.value[a]);const s=document.createElement("table");s.style.width="100%";const o=document.createElement("tr");bl.value[a].children.forEach((t=>{o.appendChild(e[t].dom)})),s.appendChild(o),n.appendChild(s),i.appendChild(n),l.appendChild(i),t[a]={dom:l}}return t}(),t=document.createElement("table");t.setAttribute("width",Pl.value.maxWidth),t.style.margin="0 auto",t.style.backgroundColor=Pl.value.backgroundColor;for(const a of gl.value)t.appendChild(e[a].dom);return t}function Gl(e,t){const a=bi(t,"general");a&&Object.entries(a).forEach((([t,a])=>{e.style[t]=a}))}function Il(e,t){const a=bi(t),l=bi(t,"general");for(const n in a)e.style[n]=a[n];e.innerText=t.content;const{info:i}=t;return i&&(e.href=i.href,e.target=i.target),{generalStyle:l}}function Nl(e,t){const a=bi(t),l=bi(t,"general");for(const i in a)e.style[i]=a[i];return{generalStyle:l}}function Wl(e,t){const a=bi(t),l=bi(t,"general");for(const i in a)e.style[i]=a[i];return e.innerText=t.content,{generalStyle:l}}function Fl(e,t){const a=bi(t),l=bi(t,"general");for(const i in a)e.style[i]=a[i];return e.innerText=t.content,{generalStyle:l}}function ql(e,t){const a=bi(t);for(const l in a)e.style[l]=a[l]}function Kl(e,t){const{links:a,info:l}=t;a.forEach((a=>{const i=document.createElement("a");!function(e,t){const a=bi(t);for(const l in a)e.style[l]=a[l]}(i,t),i.style.display="vertical"===(null==l?void 0:l.layout)?"block":"inline-block",i.href=a.href,i.target="_blank",i.innerText=a.label,e.appendChild(i)}))}function Vl(e,t){const a=bi(t);for(const l in a)e.style[l]=a[l]}function Jl(e,t){const a=bi(t);for(const l in a)e.style[l]=a[l]}function Ql(e,t){if("0"==e.key){const e=hi();!function(e,t){gl.value.splice(t,0,e),Ll.$emit("makeDom")}(e,t),function(e){const t=hi();bl.value[e]={type:dl.Columns,name:"列",key:e,children:[t]},Xl(t),function(e){Ml.value[e]=ft(Bl)}(e),Ll.$emit("makeDom")}(e),ai(e,"columns")}Ll.$emit("makeDom")}function Yl(e,t){bl.value[e].children.push(t),Xl(t),Ll.$emit("makeDom")}function Xl(e){xl.value[e]={width:"100%",key:e,children:[]},function(e){kl.value[e]=ft(Sl)}(e),Ll.$emit("makeDom")}function Zl(e,t,a){xl.value[e].children.push(t),ti(t,a),Ll.$emit("makeDom")}function ei(e,t,a,l){xl.value[e].children.splice(l,0,t),ti(t,a),Ll.$emit("makeDom")}function ti(e,t){wl.value[e]={key:e,type:t},ai(e,t),Ll.$emit("makeDom")}function ai(e,t){Cl.value[e]=ft(zl[t]),Ll.$emit("makeDom")}function li(e,t){!function(e){delete Cl.value[e],Ll.$emit("makeDom")}(e),delete wl.value[e],xl.value[t].children=xl.value[t].children.filter((t=>t!==e)),Ll.$emit("makeDom")}function ii(e,t){xl.value[e].children.forEach((t=>{li(t,e)})),delete xl.value[e],bl.value[t].children=bl.value[t].children.filter((t=>t!==e)),Ll.$emit("makeDom")}function ni(e){fl.value="",yl.value="",bl.value[e].children.forEach((t=>{ii(t,e)})),delete bl.value[e],gl.value=gl.value.filter((t=>t!==e)),Ll.$emit("makeDom")}function si(e,t,a){const l=xl.value[e].children.findIndex((e=>e==t)),i=xl.value[e].children.findIndex((e=>e==a));-1!==l&&-1!==i&&l>i&&(xl.value[e].children.splice(l,1),xl.value[e].children.splice(i,0,t)),Ll.$emit("makeDom")}function oi(e,t,a){const l=xl.value[e].children.findIndex((e=>e==t)),i=xl.value[e].children.findIndex((e=>e==a));-1!==l&&-1!==i&&l<i&&(xl.value[e].children.splice(i,1),xl.value[e].children.splice(l,0,a)),Ll.$emit("makeDom")}function ri(e,t){const a=gl.value.findIndex((t=>t==e)),l=gl.value.findIndex((e=>e==t));-1!==a&&-1!==l&&a<l&&(gl.value[a]=t,gl.value[l]=e),Ll.$emit("makeDom")}function ui(e,t){const a=gl.value.findIndex((t=>t==e)),l=gl.value.findIndex((e=>e==t));-1!==a&&-1!==l&&a>l&&(gl.value[a]=t,gl.value[l]=e),Ll.$emit("makeDom")}function di(e,t){const a=bl.value[t].children;if(a.length<e.length){const l=e.length-a.length;for(let e=0;e<l;e++){const e=hi();Yl(t,e)}}else{a.splice(e.length).forEach((e=>{ii(e,t)}))}a.forEach(((t,a)=>{xl.value[t].width=e[a]+"%"})),Ll.$emit("makeDom")}function ci(e){const t=[];bl.value[e].children.forEach((e=>{t.push(Number(xl.value[e].width.split("%")[0]))}));const a=100/(t.length+1),l=t.reduce(((e,t)=>e+t),0),i=(100-(l+a))/l;t.push(a);for(let n=0;n<t.length-1;n++)t[n]+=t[n]*i;di(t,e),Ll.$emit("makeDom")}function pi(e,t){const a=bl.value[t].children.reduce(((t,a)=>{const l=Number(xl.value[e].width.split("%")[0]);return{...t,[a]:l}}),{});delete a[e];let l=Object.values(a);const i=l.reduce(((e,t)=>e+t),0),n=(100-i)/i;l=l.map((e=>parseFloat((e*(1+n)).toFixed(2))));const s=100-l.reduce(((e,t)=>e+t),0);0!==s&&(l[l.length-1]+=s),ii(e,t),di(l,t),Ll.$emit("makeDom")}function mi(e,t){const a=xl.value[t],l=wl.value[e],i=Cl.value[e];if(a&&l&&i){const t=ft(i),n=ft(l),s=hi(),o=a.children.findIndex((t=>t===e));-1!==o&&a.children.splice(o+1,0,s),n.key=s,wl.value[s]=n,Cl.value[s]=t}}function vi(e){const t=JSON.parse(e);Ul.value=t.compOptions,kl.value=t.cell_style_map,Ml.value=t.column_row_style_map,bl.value=t.column_map,wl.value=t.comp_map,xl.value=t.cell_map,Cl.value=t.comp_style_map,gl.value=t.columns_source,t.page_style&&(Pl.value=t.page_style)}function fi(e){e&&(vi(e),ml(),Ll.$emit("makeDom"))}function yi(){gl.value=[],bl.value={},xl.value={},wl.value={},kl.value={},Ml.value={},Cl.value={},Ul.value={}}function _i(e){if(!e)return;return 1.4!==JSON.parse(e).version?(vi(e),ml(),{content:Hl().outerHTML,render:jl.value}):null}function hi(e=10){return Math.random().toString(16).slice(2,2+e)}function gi(e,t){let a="",l="",i="",n="",s="";return"border"==t&&(a="border",l="borderTop",i="borderRight",n="borderBottom",s="borderLeft"),"padding"==t&&(a="padding",l="paddingTop",i="paddingRight",n="paddingBottom",s="paddingLeft"),"borderRadius"==t&&(a="borderRadius",l="borderTopLeftRadius",i="borderTopRightRadius",n="borderBottomRightRadius",s="borderBottomLeftRadius"),e.more?{[l]:e.top,[i]:e.right,[n]:e.bottom,[s]:e.left}:{[a]:e.all}}function bi(e,t="style"){if(!e)return;const a={};for(const i in e[t])"border"==(l=i)||"padding"==l||"borderRadius"==l?Object.assign(a,gi(e[t][i],i)):a[i]=e[t][i];var l;return a}const xi=["innerHTML"],wi=n({__name:"preview",props:{id:{}},setup(e){const t=T(e,"id"),a=l(""),i=async()=>{if(!t.value)return;const{message:e}=await ue({id:t.value});if(I(e)){const l=_i(e.render);l&&1===e.type?(a.value=l.content,await de({id:t.value,type:e.type,temp_name:e.name,render:JSON.stringify(l.render),content:l.content},!1)):a.value=e.content}};return C((()=>t.value),(()=>{i()})),i(),(e,t)=>(o(),r("div",{class:"flex-1 min-w-520px overflow-auto border-#ebebeb border-1 border-solid rounded-4px p-12px",innerHTML:v(a)},null,8,xi))}}),ki={class:"mb-12px font-bold text-15px text-default leading-28px"},Mi={class:"flex flex-col w-550px"},Ci={class:"form-card mb-16px pt-20px"},Ui={class:"w-360px"},Pi={class:"w-360px"},Ri={class:"w-260px"},ji={class:"w-60px ml-24px"},Ei={class:"form-card flex-1 py-20px"},Ti={class:"w-360px"},Di={class:"flex w-360px"},Si={class:"flex-1 mr-10px"},Bi={class:"form-card flex flex-col items-center w-640px ml-16px pt-12px p-16px overflow-hidden"},$i={class:"mb-12px"},zi={class:"min-w-260px"},Li={class:"min-w-260px"},Ai={class:"min-w-260px"},Oi={class:"mt-16px"},Hi=q(n({__name:"index",props:R({row:{},isEdit:{type:Boolean,default:!1},refresh:{type:Function,default:()=>{}}},{show:{type:Boolean},showModifiers:{}}),emits:["update:show"],setup(e){const t=e,{t:a}=x(),{refresh:i}=t,n=s(e,"show"),r=F(),p=w("formRef"),_=w("containerRef"),{height:k}=function(e){const t=l(0),{mainHeight:a,footerHeight:i}=m(F());return C((()=>a.value),(a=>{U((()=>{if(!e.value)return;const{top:l}=e.value.getBoundingClientRect();t.value=a-l-16-16-i.value}))}),{immediate:!0}),{height:P((()=>0===t.value?"auto":t.value+"px"))}}(_),M=h({task_name:X(12),addresser:null,full_name:"",subject:"",temp_id:qt.value,is_record:0,etypes:[],unsubscribe:1,threadsType:0,threads:1,start_time:null,pause:0,remark:"",mail_to:""}),R=l([]),j={full_name:{trigger:["blur","input"],validator:()=>""!==M.full_name||new Error("Please enter display name")},subject:{trigger:["blur","input"],validator:()=>""!==M.subject||new Error("Please enter mail subject")},etypes:{trigger:"change",validator:()=>0!==M.etypes.length||new Error("Please select contact person")},start_time:{validator:()=>1!==M.pause||null!==M.start_time||new Error("Please select send time")}},E=e=>{M.full_name=e||""},T=w("startTimeRef"),L=()=>{U((()=>{var e;null==(e=T.value)||e.restoreValidation()}))},A=()=>{var e;null==(e=T.value)||e.validate()},O=()=>{Qe({title:a("Mail.Mass.index_54"),width:450,minHeight:196,component:z((()=>Z((()=>import("./unsubscribe.js?v=1741416570306")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))))})},H=()=>{Qe({title:a("Mail.Mass.index_42"),width:554,minHeight:604,content:()=>u("img",{src:"/static/vite/images/unsubscribe.png"},[y(" ")])})},G=w("subjectRef"),I=w("mailToRef"),N=async()=>{var e,t;if(!r.isFree)return""===M.subject?(null==(e=G.value)||e.focus(),void ee.error("Please enter mail subject")):""===M.mail_to?(null==(t=I.value)||t.focus(),void ee.error("Please enter test email")):void(await ce({mail_from:M.addresser||"",subject:M.subject,mail_to:M.mail_to,temp_id:M.temp_id||0}));Ke({source:325})},q=()=>{M.subject||M.etypes.length>0?Ye({title:"Tips",content:"Do you want to discard your current edits?",onConfirm:()=>{n.value=!1}}):n.value=!1},K=async()=>{var e;if(r.isFree)return Ke({source:326}),!1;await(null==(e=p.value)?void 0:e.validate());const a={task_name:M.task_name,addresser:M.addresser||"",full_name:M.full_name,subject:M.subject,temp_id:M.temp_id||0,is_record:M.is_record,unsubscribe:M.unsubscribe,threads:0===M.threadsType?0:M.threads,etypes:M.etypes.join(","),start_time:0===M.pause?Math.floor((new Date).getTime()/1e3):Math.floor((M.start_time||0)/1e3),remark:M.remark},{isEdit:l,row:s}=t;l&&s?await pe({...a,id:s.id}):await me(a),n.value=!1,null==i||i()};return D((()=>{qt.value=null,Kt.value=!1})),(()=>{const{row:e,isEdit:a}=t;e&&(M.task_name=a?e.task_name:"".concat(e.task_name,"_").concat(X(4)),M.addresser=e.addresser,M.full_name=e.full_name,M.subject=e.subject,M.is_record=e.is_record,M.unsubscribe=e.unsubscribe,M.threadsType=0===e.threads?0:1,M.threads=e.threads,M.etypes=e.etypes.split(",").map((e=>te(e))),1e3*e.start_time>(new Date).getTime()&&(M.pause=1,M.start_time=1e3*e.start_time),M.temp_id=e.temp_id,M.remark=e.remark)})(),(e,t)=>{const a=mt,l=pt,i=yt,n=rt,s=V,r=_t,m=ot,h=ht,x=W,w=Lt;return o(),b(w,{ref_key:"formRef",ref:p,"label-width":"150",model:v(M),rules:j},{default:d((()=>[c("div",ki,g(e.isEdit?e.$t("Mail.Mass.index_67"):e.$t("Mail.Mass.index_1")),1),c("div",{ref_key:"containerRef",ref:_,class:"flex min-h-654px",style:S({height:v(k)})},[c("div",Mi,[c("div",Ci,[u(a,{label:"From",path:"addresser"},{default:d((()=>[u(Ya,{value:v(M).addresser,"onUpdate:value":t[0]||(t[0]=e=>v(M).addresser=e),onChange:E},null,8,["value"])])),_:1}),u(a,{label:"Display Name",path:"full_name"},{default:d((()=>[c("div",Ui,[u(l,{value:v(M).full_name,"onUpdate:value":t[1]||(t[1]=e=>v(M).full_name=e),placeholder:"Please enter display Name"},null,8,["value"])])])),_:1}),u(a,{label:"Subject",path:"subject"},{default:d((()=>[c("div",Pi,[u(l,{ref_key:"subjectRef",ref:G,value:v(M).subject,"onUpdate:value":t[2]||(t[2]=e=>v(M).subject=e),placeholder:"Please enter mail subject"},null,8,["value"])])])),_:1}),u(a,{label:"Recipients",type:"etypes"},{default:d((()=>[u(ul,{value:v(M).etypes,"onUpdate:value":t[3]||(t[3]=e=>v(M).etypes=e),name:v(R),"onUpdate:name":t[4]||(t[4]=e=>f(R)?R.value=e:null)},null,8,["value","name"])])),_:1}),u(a,{label:"Email template"},{default:d((()=>[c("div",Ri,[u(Va,{value:v(M).temp_id,"onUpdate:value":t[5]||(t[5]=e=>v(M).temp_id=e)},null,8,["value"])])])),_:1}),u(a,{label:e.$t("Mail.Mass.index_30")},{default:d((()=>[u(i,{value:v(M).is_record,"onUpdate:value":t[6]||(t[6]=e=>v(M).is_record=e),"checked-value":1,"unchecked-value":0},null,8,["value"])])),_:1},8,["label"]),u(a,{label:e.$t("Mail.Mass.index_31")},{default:d((()=>[u(i,{value:v(M).unsubscribe,"onUpdate:value":t[7]||(t[7]=e=>v(M).unsubscribe=e),"checked-value":1,"unchecked-value":0},null,8,["value"]),u(n,{class:"ml-16px",size:"small",onClick:O},{default:d((()=>[y(g(e.$t("Public.Btn.Set")),1)])),_:1}),u(s,{class:"ml-16px",onClick:H},{default:d((()=>[y(g(e.$t("Mail.Mass.index_32")),1)])),_:1})])),_:1},8,["label"]),u(a,{label:e.$t("Mail.Mass.index_33"),path:"threads"},{default:d((()=>[u(m,{value:v(M).threadsType,"onUpdate:value":t[8]||(t[8]=e=>v(M).threadsType=e)},{default:d((()=>[u(r,{value:0},{default:d((()=>[y(g(e.$t("Mail.Mass.index_34")),1)])),_:1}),u(r,{value:1},{default:d((()=>[y(g(e.$t("Mail.Mass.index_35")),1)])),_:1})])),_:1},8,["value"]),B(c("div",ji,[u(h,{value:v(M).threads,"onUpdate:value":t[9]||(t[9]=e=>v(M).threads=e),min:1,max:5,"show-button":!1,placeholder:e.$t("Mail.Mass.index_36")},null,8,["value","placeholder"])],512),[[$,1===v(M).threadsType]])])),_:1},8,["label"])]),c("div",Ei,[u(a,{ref_key:"startTimeRef",ref:T,label:"Send time",path:"start_time"},{default:d((()=>[u(m,{value:v(M).pause,"onUpdate:value":[t[11]||(t[11]=e=>v(M).pause=e),L],class:"flex items-center"},{default:d((()=>[u(r,{value:0},{default:d((()=>t[14]||(t[14]=[y("Send Now")]))),_:1}),u(r,{class:"items-center",value:1},{default:d((()=>[u(x,{value:v(M).start_time,"onUpdate:value":[t[10]||(t[10]=e=>v(M).start_time=e),A],type:"datetime",disabled:0===v(M).pause,clearable:""},null,8,["value","disabled"])])),_:1})])),_:1},8,["value"])])),_:1},512),u(a,{label:"Remark"},{default:d((()=>[c("div",Ti,[u(l,{value:v(M).remark,"onUpdate:value":t[12]||(t[12]=e=>v(M).remark=e),placeholder:"Please enter remark"},null,8,["value"])])])),_:1}),u(a,{label:"Send Test email to","show-feedback":!1},{default:d((()=>[c("div",Di,[c("div",Si,[u(l,{ref_key:"mailToRef",ref:I,value:v(M).mail_to,"onUpdate:value":t[13]||(t[13]=e=>v(M).mail_to=e),placeholder:"Please enter email"},null,8,["value"])]),u(n,{onClick:N},{default:d((()=>t[15]||(t[15]=[y("Send Test Mail")]))),_:1})])])),_:1})])]),c("div",Bi,[c("div",$i,[u(a,{label:"From: ","show-feedback":!1,style:{"--n-blank-height":"21px"},"label-style":{fontWeight:"bold"}},{default:d((()=>[c("div",zi,g(v(M).addresser),1)])),_:1}),u(a,{label:"To: ","show-feedback":!1,style:{"--n-blank-height":"21px"},"label-style":{fontWeight:"bold"}},{default:d((()=>[c("div",Li,g(v(R).length>0?v(R).join(", "):"--"),1)])),_:1}),u(a,{label:"Subject: ","show-feedback":!1,style:{"--n-blank-height":"21px"},"label-style":{fontWeight:"bold"}},{default:d((()=>[c("div",Ai,g(v(M).subject||"--"),1)])),_:1})]),u(wi,{id:v(M).temp_id},null,8,["id"])])],4),c("div",Oi,[u(n,{class:"mr-16px",onClick:q},{default:d((()=>[y(g(e.$t("Public.Btn.Cancel")),1)])),_:1}),u(n,{type:"primary",onClick:K},{default:d((()=>[y(g(e.$t("Public.Btn.Confirm")),1)])),_:1})])])),_:1},8,["model"])}}}),[["__scopeId","data-v-3b3d3467"]]),Gi={class:"p-20px"},Ii=n({__name:"details",props:{id:{},type:{},row:{}},setup(e){const t=e,{t:a}=x(),l=h({task_id:t.id,type:t.type,value:"domain"===t.type?t.row.domain:t.row.status,page:1,size:10}),{loading:i,setLoading:n}=Je(),{table:s,columns:c}=Ve([{key:"recipient",title:a("Mail.Mass.index_50"),width:160,render:e=>u(ut,{class:e.tooltip?"":"break-all!","line-clamp":e.tooltip?999:1,tooltip:!1},{default:()=>[e.recipient]})},{key:"dsn",title:"Dsn",width:60},{key:"delay",title:a("Mail.Mass.index_51"),width:70},{key:"delays",title:a("Mail.Mass.index_52"),width:150},{key:"relay",title:a("Mail.Mass.index_53"),width:200,render:e=>u(ut,{class:e.tooltip?"":"break-all!","line-clamp":e.tooltip?9999:1,tooltip:!1},{default:()=>[e.relay]})},{key:"err_info",title:a("Public.Btn.Details"),render:e=>u(ut,{class:e.tooltip?"":"break-all!","line-clamp":e.tooltip?9999:1,tooltip:!1},{default:()=>[e.err_info]})}]),p=e=>({onMousemove:()=>{e.tooltip=!0},onMouseleave:()=>{e.tooltip=!1}}),m=async()=>{try{n(!0);const{message:e}=await Et(L(l));I(e)&&(s.data=K(e.data)?e.data.map((e=>({...e,tooltip:!1}))):[],s.total=ae(e.page))}finally{n(!1)}};return"domain"===l.type&&c.value.push({key:"status",title:a("Public.Table.Status"),width:100,ellipsis:{tooltip:!0},render:e=>e.status}),"status"===l.type&&c.value.unshift({key:"domain",title:a("Mail.Mass.index_45"),width:120,ellipsis:{tooltip:!0},render:e=>e.domain}),m(),(e,t)=>{const a=kt,n=zt,f=Ct;return o(),r("div",Gi,[u(f,null,{table:d((()=>[u(a,{loading:v(i),data:v(s).data,columns:v(c),"row-props":p},null,8,["loading","data","columns"])])),pageRight:d((()=>[u(n,{page:v(l).page,"onUpdate:page":t[0]||(t[0]=e=>v(l).page=e),"page-size":v(l).size,"onUpdate:pageSize":t[1]||(t[1]=e=>v(l).size=e),"item-count":v(s).total,onRefresh:m},null,8,["page","page-size","item-count"])])),_:1})])}}}),Ni={class:"p-20px"},Wi=n({__name:"index",props:{row:{}},setup(e){const t=e,{t:a}=x(),l=h({task_id:t.row.id,type:"domain"}),i=async()=>{const{message:e}=await ve({task_id:t.row.id});I(e)&&Y(e.result)},{loading:n,setLoading:s}=Je(),{table:c,columns:m}=Ve([{key:"domain",title:()=>u(p,null,["domain"===l.type?a("Mail.Mass.index_45"):a("Public.Table.Status")]),render:e=>"domain"===l.type?e.domain:e.status},{key:"count",title:a("Mail.Mass.index_46")},Xe({width:120,options:e=>[{label:a("Public.Btn.Details"),onClick:()=>{_(e)}}]})]),f=Ze(""),_=e=>{f.data.id=t.row.id,f.data.type=l.type,f.data.row=e,f.title=a("Mail.Mass.index_49",["domain"===l.type?e.domain:e.status]),f.show=!0},b=async()=>{try{s(!0);const{message:e}=await Tt(L(l));c.data=K(e)?e:[]}finally{s(!1)}};return b(),(e,t)=>{const a=st,s=ot,p=rt,_=kt,h=Ct,x=$t;return o(),r("div",Ni,[u(h,null,{toolsLeft:d((()=>[u(s,{value:v(l).type,"onUpdate:value":[t[0]||(t[0]=e=>v(l).type=e),b]},{default:d((()=>[u(a,{value:"domain"},{default:d((()=>[y(g(e.$t("Mail.Mass.index_45")),1)])),_:1}),u(a,{value:"status"},{default:d((()=>[y(g(e.$t("Public.Table.Status")),1)])),_:1})])),_:1},8,["value"]),u(p,{onClick:i},{default:d((()=>[y(g(e.$t("Public.Btn.Export")),1)])),_:1})])),table:d((()=>[u(_,{"max-height":340,loading:v(n),data:v(c).data,columns:v(m)},null,8,["loading","data","columns"])])),_:1}),u(x,{show:v(f).show,"onUpdate:show":t[1]||(t[1]=e=>v(f).show=e),title:v(f).title,data:v(f).data,width:980,"min-height":152,component:Ii},null,8,["show","title","data"])])}}}),Fi={class:"h-full"},qi=n({__name:"index",props:{row:{}},setup(e){const t=e,{t:a}=x(),i=l(a("Mail.Mass.index_48")),{loading:n,setLoading:s}=Je();return(async()=>{try{s(!0);const{message:e}=await Gt({path:t.row.error_log});I(e)&&(i.value=e.data?e.data.slice(-1e4):a("Mail.Mass.index_48"))}finally{s(!1)}})(),(e,t)=>{const a=Ht;return o(),r("div",Fi,[u(a,{log:v(i),loading:v(n)},null,8,["log","loading"])])}}}),Ki=q(n({__name:"index",setup(e){const{t:t}=x(),a=h({p:1,size:10}),l=h({title:"",row:void 0,isEdit:!1}),i=e=>{l.row=e,l.isEdit=!1,Kt.value=!0},{table:n,columns:s}=Ve([{key:"created",title:t("Mail.Mass.index_2"),width:"14%",minWidth:140,render:e=>N(e.created)},{key:"subject",title:t("Mail.Mass.index_23"),width:"12%",minWidth:100,ellipsis:{tooltip:!0}},{key:"addresser",title:t("Mail.Mass.index_4"),minWidth:180,width:"15%",ellipsis:{tooltip:!0}},{key:"recipient_count",title:t("Mail.Mass.index_5"),width:"7%",minWidth:80},{key:"success_count",title:t("Mail.Mass.index_6"),width:"7%",minWidth:80,render:e=>2===e.task_process?e.delivered-e.count.error_count:"--"},{key:"error_count",title:t("Mail.Mass.index_7"),width:"7%",minWidth:80,render:e=>2===e.task_process?u("a",{class:"bt-link error",href:"javascript:;",onClick:()=>{m(e)}},[e.count.error_count]):"--"},{key:"task_process",title:t("Public.Table.Status"),width:"7%",render:e=>0===e.task_process||1===e.pause?u("span",{class:"text-#fcb040"},[y(" "),t("Mail.Mass.index_9"),y(" ")]):1===e.task_process?u("span",{class:"text-#fcb040"},[y(" "),t("Mail.Mass.index_10"),y(" ")]):t("Mail.Mass.index_11")},{key:"remark",title:t("Public.Table.Ps"),width:"10%",minWidth:80,ellipsis:{tooltip:!0}},et({status:"success"}),Xe({width:180,options:e=>[{label:t("Public.Btn.Edit"),show:0===e.task_process&&0===e.pause,onClick:()=>{(e=>{l.row=e,l.isEdit=!0,Kt.value=!0})(e)}},{label:t("Mail.Mass.index_61"),show:!(0===e.task_process&&0===e.pause),onClick:()=>{c(e)}},{label:1===e.pause?t("Mail.Mass.index_12"):t("Public.Status.Pause"),show:2!==e.task_process,onClick:()=>{k(e)}},{label:t("Public.Btn.Del"),onClick:()=>{M(e)}}]})]),c=e=>{Qe({title:t("Mail.Mass.index_62",[e.subject]),width:640,minHeight:320,footer:!0,confirmText:t("Mail.Mass.index_63"),data:{row:e,onAdd:i},component:z((()=>Z((()=>import("./index182.js?v=1741416570306")),__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,14,15,16,17,18,19]))))})},p=Ze(""),m=e=>{p.data.row=e,p.title=t("Mail.Mass.index_13",[e.subject]),p.show=!0},w=Ze(""),k=e=>{Ye({title:t("Mail.Mass.index_15",[e.subject]),content:e.task_process?t("Mail.Mass.index_16"):t("Mail.Mass.index_17"),onConfirm:async()=>{await Dt({task_id:e.id,pause:e.pause?0:1}),C()}})},M=async e=>{Ye({title:t("Mail.Mass.index_18"),content:t("Mail.Mass.index_19",[e.subject]),onConfirm:async()=>{await St({task_id:e.id}),C()}})},C=async()=>{try{n.loading=!0;const{message:e}=await Bt(L(a));I(e)&&(n.data=K(e.data)?e.data:[],n.total=ae(e.page))}finally{n.loading=!1}};return C(),(e,t)=>{const c=rt,m=kt,h=zt,x=Ct,k=$t;return o(),r("div",null,[B(u(x,null,{toolsLeft:d((()=>[u(c,{type:"primary",onClick:t[0]||(t[0]=e=>i())},{default:d((()=>[y(g(e.$t("Mail.Mass.index_1")),1)])),_:1})])),table:d((()=>[u(m,{loading:v(n).loading,data:v(n).data,columns:v(s)},null,8,["loading","data","columns"])])),pageRight:d((()=>[u(h,{page:v(a).p,"onUpdate:page":t[1]||(t[1]=e=>v(a).p=e),"page-size":v(a).size,"onUpdate:pageSize":t[2]||(t[2]=e=>v(a).size=e),"item-count":v(n).total,onRefresh:C},null,8,["page","page-size","item-count"])])),_:1},512),[[$,!v(Kt)]]),v(Kt)?(o(),b(Hi,{key:0,show:v(Kt),"onUpdate:show":t[3]||(t[3]=e=>f(Kt)?Kt.value=e:null),"is-edit":v(l).isEdit,title:v(l).title,row:v(l).row,refresh:C},null,8,["show","is-edit","title","row"])):_("",!0),u(k,{show:v(p).show,"onUpdate:show":t[4]||(t[4]=e=>v(p).show=e),title:v(p).title,data:v(p).data,width:700,"min-height":192,component:Wi},null,8,["show","title","data"]),u(k,{show:v(w).show,"onUpdate:show":t[5]||(t[5]=e=>v(w).show=e),title:v(w).title,data:v(w).data,width:750,height:580,component:qi},null,8,["show","title","data"])])}}}),[["__scopeId","data-v-8e0ce07e"]]),Vi=e=>{Ft.value=e},Ji={class:"mb-20px"},Qi={class:"w-320px"},Yi={class:"flex items-center"},Xi=n({__name:"form",props:R({data:{default:null},refresh:{}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:["update:show"],setup(e){const t=e,a=z((()=>Z((()=>import("./index183.js?v=1741416570306")),__vite__mapDeps([20,2,3,6,7,4,5,9,8,21,22,19,23,12,18,24,14,15,16,1,10,17,11,25,26,27,28,29,30,31,32,33,34])))),i=T(t,"data"),n=s(e,"show"),p=w("editorRef"),m=l(1),h=l(""),b=()=>{n.value=!1},x=l(!1),k=async(e=!1)=>{var t,a;if(i.value)try{e||(x.value=!0),await de({id:i.value.id,type:m.value,temp_name:h.value,render:JSON.stringify(null==(t=p.value)?void 0:t.getEmailData()),content:(null==(a=p.value)?void 0:a.getEmailHTML())||""},e)}finally{e||(x.value=!1)}},C=async()=>{await k(!0),b(),t.refresh()};return M((()=>{(async()=>{x.value=!0,setTimeout((async()=>{var e;if(i.value)try{h.value=i.value.name;const{message:t}=await ue({id:i.value.id});I(t)&&(null==(e=p.value)||e.setEmailData(t.render))}finally{setTimeout((()=>{x.value=!1}),500)}}),500)})()})),(e,t)=>{const l=mt,i=pt,n=gt,s=rt;return o(),r("div",null,[t[5]||(t[5]=c("div",{class:"mb-14px font-bold text-18px text-default leading-28px"},"Template Editor",-1)),u(n,null,{default:d((()=>[_("",!0),c("div",Ji,[u(v(a),{ref_key:"editorRef",ref:p,save:k},null,512)]),u(l,{label:"Template name"},{default:d((()=>[c("div",Qi,[u(i,{value:v(h),"onUpdate:value":t[1]||(t[1]=e=>f(h)?h.value=e:null)},null,8,["value"])])])),_:1})])),_:1}),c("div",Yi,[u(s,{onClick:b},{default:d((()=>t[4]||(t[4]=[y("Back")]))),_:1}),u(s,{type:"primary",loading:v(x),disabled:v(x),class:"ml-12px",onClick:C},{default:d((()=>[y(g(e.$t("Public.Btn.Confirm")),1)])),_:1},8,["loading","disabled"])])])}}}),Zi=["innerHTML"],en=n({__name:"preview",props:{row:{}},setup(e){const t=T(e,"row"),a=l("");return(async()=>{const{message:e}=await ue({id:t.value.id});if(I(e)){const l=_i(e.render);l&&1===e.type?(a.value=l.content,await de({id:t.value.id,type:e.type,temp_name:e.name,render:JSON.stringify(l.render),content:l.content},!1)):a.value=e.content}})(),(e,t)=>(o(),r("div",{class:"min-h-600px overflow-auto",innerHTML:v(a)},null,8,Zi))}}),tn={class:"relative"},an=n({__name:"index",setup(e){const{t:t}=x(),a=l(!1),i=l(null),n=async()=>{const e="template_".concat(N(new Date,"yyyyMMddHHmmss")),{message:t}=await ge({temp_name:e,type:1});T(),I(t)&&(i.value=t.data,a.value=!0)},s=()=>{Ot({path:"/tmp/upload",size:1,confirmText:t("Public.Btn.Import"),showSuccessMsg:!1,uploadData:{accept:["zip"].map((e=>".".concat(e))).join(","),multiple:!1},onUploadSuccess:async e=>{const t=e[0];await be({path:"/tmp/upload/".concat(t.name)}),T()}})},{keys:c,table:p,columns:m,setLoading:w}=Ve([{type:"selection",width:40},{key:"name",title:"Name"},{key:"created",title:"Add Time",render:e=>N(e.created)},Xe({width:360,options:e=>[{label:"Create task",onClick:()=>{var t;t=e.id,Vi("task"),qt.value=t,U((()=>{Kt.value=!0}))}},{label:"Duplicate",onClick:()=>{M(e)}},{label:t("Public.Btn.Export"),onClick:()=>{C(e)}},{label:"Preview",onClick:()=>{P(e)}},{label:t("Public.Btn.Edit"),onClick:()=>{R(e)}},{label:t("Public.Btn.Del"),onClick:()=>{j(e)}}]})]),k=[{key:"import",label:"Batch Export",onBatch:async e=>{const{message:t}=await ye({ids:e.map((e=>e.id)).join(",")});I(t)&&Y(t.result)}}],M=async e=>{await fe({id:"".concat(e.id)}),T()},C=async e=>{const{message:t}=await ye({ids:"".concat(e.id)});I(t)&&Y(t.result)},P=e=>{Qe({title:"Preview [".concat(e.name,"]"),width:800,data:{row:e},component:en})},R=e=>{i.value=e,a.value=!0},j=e=>{Ye({title:"Delete Template [".concat(e.name,"]"),content:"Are you sure you want to delete this template?",onConfirm:async()=>{await _e({id:e.id}),T()}})},E=h({p:1,size:10}),T=async()=>{try{w(!0);const{message:e}=await he(L(E));I(e)&&(p.data=K(e.data)?e.data:[],p.total=e.total)}finally{w(!1)}};return T(),(e,t)=>{const l=rt,h=kt,x=It,w=zt,M=Ct;return o(),r("div",tn,[B(u(M,null,{toolsLeft:d((()=>[u(l,{type:"primary",onClick:n},{default:d((()=>t[5]||(t[5]=[y("Add Template")]))),_:1}),u(l,{onClick:s},{default:d((()=>[y(g(e.$t("Public.Btn.Import")),1)])),_:1})])),table:d((()=>[u(h,{"checked-row-keys":v(c),"onUpdate:checkedRowKeys":t[0]||(t[0]=e=>f(c)?c.value=e:null),loading:v(p).loading,data:v(p).data,columns:v(m)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:d((()=>[u(x,{"checked-row-keys":v(c),"onUpdate:checkedRowKeys":t[1]||(t[1]=e=>f(c)?c.value=e:null),data:v(p).data,options:k},null,8,["checked-row-keys","data"])])),pageRight:d((()=>[u(w,{page:v(E).p,"onUpdate:page":t[2]||(t[2]=e=>v(E).p=e),"page-size":v(E).size,"onUpdate:pageSize":t[3]||(t[3]=e=>v(E).size=e),"item-count":v(p).total,onRefresh:T},null,8,["page","page-size","item-count"])])),_:1},512),[[$,!v(a)]]),v(a)?(o(),b(Xi,{key:0,show:v(a),"onUpdate:show":t[4]||(t[4]=e=>f(a)?a.value=e:null),data:v(i),refresh:T},null,8,["show","data"])):_("",!0)])}}}),ln=(e={})=>le.post("/plugin?action=a&name=mail_sys&s=get_mail_type_list",e),nn=n({__name:"index",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e,{expose:t}){const a=s(e,"value"),i=l([]),{loading:n,setLoading:r}=Je(),u=async()=>{try{r(!0);const{message:e}=await ln();K(e)&&(i.value=e.map((e=>({label:e.mail_type,value:e.id}))))}finally{r(!1)}};return u(),t({getType:u}),(e,t)=>{const l=ct;return o(),b(l,A(e.$attrs,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),options:v(i),loading:v(n)}),null,16,["value","options","loading"])}}}),sn={class:"px-20px pt-24px pb-8px"},on={class:"w-300px"},rn={class:"w-300px"},un=n({__name:"index",props:{row:{},onRefresh:{}},setup(e,{expose:t}){const{t:a}=x(),i=e,{row:n,onRefresh:s}=i;U((()=>{m.etypes=n.mail_type.map((e=>te(Object.keys(e)[0])))}));const p=l(null),m=h({etypes:[]}),f={etypes:{trigger:"change",validator:()=>!!m.etypes.length||new Error(a("Mail.Unsubscribe.index_16"))}};return t({onConfirm:async()=>{var e;await(null==(e=p.value)?void 0:e.validate()),await xe({etypes:m.etypes.join(","),recipients:n.recipient,active:n.active}),null==s||s()}}),(e,t)=>{const a=pt,l=mt,i=Lt;return o(),r("div",sn,[u(i,{ref_key:"formRef",ref:p,model:v(m),rules:f},{default:d((()=>[u(l,{label:e.$t("Config.Alarm.index_43")},{default:d((()=>[c("div",on,[u(a,{value:v(n).recipient,"onUpdate:value":t[0]||(t[0]=e=>v(n).recipient=e),readonly:!0},null,8,["value"])])])),_:1},8,["label"]),u(l,{label:"Groups",path:"etypes"},{default:d((()=>[c("div",rn,[u(nn,{ref:"typeSelect",value:v(m).etypes,"onUpdate:value":t[1]||(t[1]=e=>v(m).etypes=e),multiple:"",filterable:""},null,8,["value"])])])),_:1})])),_:1},8,["model"])])}}}),dn={class:"p-20px"},cn={class:"w-320px"},pn={class:"flex-1"},mn={class:"flex items-center h-32px mb-8px"},vn={class:"w-320px"},fn=n({__name:"index",props:{active:{},group:{},refresh:{}},setup(e,{expose:t}){const{t:a}=x(),i=e,{refresh:n}=i,s=l(null),p=h({etypes:-1!==i.group?[i.group]:[],type:1,file:"",content:""}),m={etypes:{trigger:"change",validator:()=>!!p.etypes.length||new Error(a("Mail.Unsubscribe.index_16"))},data:{validator:()=>1!==p.type||p.content?!(0===p.type&&!p.file)||new Error("Please upload the file"):new Error("Please enter the content")}},f=()=>{Y("/www/server/panel/plugin/mail_sys/data/example_recipients.txt")};return t({onConfirm:async()=>{var e;await(null==(e=s.value)?void 0:e.validate()),1===p.type&&await we({etypes:p.etypes.join(","),recipient_content:p.content}),0===p.type&&await ke({etypes:p.etypes.join(","),file:p.file}),null==n||n()}}),(e,t)=>{const a=mt,l=_t,i=ot,n=Wt,_=Lt,h=V,b=At;return o(),r("div",dn,[u(_,{ref_key:"formRef",ref:s,model:v(p),rules:m},{default:d((()=>[u(a,{label:"Groups",path:"etypes"},{default:d((()=>[c("div",cn,[u(nn,{ref:"typeSelect",value:v(p).etypes,"onUpdate:value":t[0]||(t[0]=e=>v(p).etypes=e),multiple:"",filterable:""},null,8,["value"])])])),_:1}),u(a,{label:"Data",path:"data"},{default:d((()=>[c("div",pn,[c("div",mn,[u(i,{value:v(p).type,"onUpdate:value":t[1]||(t[1]=e=>v(p).type=e)},{default:d((()=>[u(l,{value:1},{default:d((()=>t[4]||(t[4]=[y("Paste data")]))),_:1}),u(l,{value:0},{default:d((()=>t[5]||(t[5]=[y("Upload file")]))),_:1})])),_:1},8,["value"])]),B(c("div",vn,[u(n,{value:v(p).content,"onUpdate:value":t[2]||(t[2]=e=>v(p).content=e),rows:6,placeholder:"Please paste in the data"},null,8,["value"])],512),[[$,1===v(p).type]]),B(c("div",null,[u(el,{value:v(p).file,"onUpdate:value":t[3]||(t[3]=e=>v(p).file=e),path:"/www/server/panel/data/mail/in_bulk/recipient",accept:["txt","json"]},null,8,["value"])],512),[[$,0===v(p).type]])])])),_:1})])),_:1},8,["model"]),u(b,{class:"mt-8px ml-24px"},{default:d((()=>[c("li",null,[y(g(e.$t("Mail.Mass.index_74"))+" ",1),u(h,{target:"_blank",onClick:f},{default:d((()=>t[6]||(t[6]=[y("Download the template")]))),_:1})])])),_:1})])}}}),yn=l([]),_n=async()=>{const{message:e}=await ln();yn.value=K(e)?e:[]},hn={class:"p-20px"},gn={class:"flex-1"},bn={class:"mt-12px"},xn={class:"px-20px pt-24px pb-8px"},wn={class:"w-150px"},kn=n({__name:"set",setup(e){const{t:t}=x(),a=l(""),{table:i,columns:n,setLoading:s}=Ve([{key:"mail_type",title:"Group Name"},Xe({width:120,options:e=>[{label:t("Public.Btn.Edit"),disabled:0===e.id,onClick:()=>{m(e)}},{label:t("Public.Btn.Delete"),disabled:0===e.id,onClick:()=>{_(e)}}]})]),p=async()=>{const e=a.value.trim();var t;""!==e?(await(t={mail_type:e},le.post("/plugin?action=a&name=mail_sys&s=add_mail_type",t,{requestOptions:{loading:ie.global.t("Mail.Api.index_22"),successMessage:!0}})),b(),a.value=""):ee.error("Please enter group name")},m=e=>{w.title="Edit Group",M.id=e.id,M.mail_type=e.mail_type,w.show=!0},_=e=>{Ye({title:"Delete Group [".concat(e.mail_type,"]"),content:"Are you sure you want to delete this group?",onConfirm:async()=>{var t;await(t={ids:"".concat(e.id)},le.post("/plugin?action=a&name=mail_sys&s=del_mail_type_list",t,{requestOptions:{loading:ie.global.t("Mail.Api.index_37"),successMessage:!0}})),b()}})},b=async()=>{try{s(!0),await _n(),i.data=yn.value}finally{s(!1)}},w=Ze(),k=l(null),M=h({id:-1,mail_type:""}),C={mail_type:{required:!0,message:"Please enter group name",trigger:["blur","change"]}},U=async()=>{var e,t;await(null==(e=k.value)?void 0:e.validate()),await(t=L(M),le.post("/plugin?action=a&name=mail_sys&s=edit_mail_type",t,{requestOptions:{loading:ie.global.t("Mail.Api.index_42"),successMessage:!0}})),await b()};return b(),(e,t)=>{const l=pt,s=rt,m=bt,_=kt,h=mt,b=Lt,x=$t;return o(),r("div",hn,[u(m,null,{default:d((()=>[c("div",gn,[u(l,{value:v(a),"onUpdate:value":t[0]||(t[0]=e=>f(a)?a.value=e:null),placeholder:"Please enter group name"},null,8,["value"])]),c("div",null,[u(s,{type:"primary",onClick:p},{default:d((()=>[y(g(e.$t("Public.Btn.Add")),1)])),_:1})])])),_:1}),c("div",bn,[u(_,{"max-height":300,loading:v(i).loading,data:v(i).data,columns:v(n)},null,8,["loading","data","columns"])]),u(x,{show:v(w).show,"onUpdate:show":t[2]||(t[2]=e=>v(w).show=e),title:v(w).title,width:350,footer:!0,onConfirm:U},{default:d((()=>[c("div",xn,[u(b,{ref_key:"formRef",ref:k,model:v(M),rules:C},{default:d((()=>[u(h,{label:"Group Name",path:"mail_type"},{default:d((()=>[c("div",wn,[u(l,{value:v(M).mail_type,"onUpdate:value":t[1]||(t[1]=e=>v(M).mail_type=e),placeholder:""},null,8,["value"])])])),_:1})])),_:1},8,["model"])])])),_:1},8,["show","title"])])}}}),Mn={class:"w-200px"},Cn=n({__name:"index",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const{t:t}=x(),a=s(e,"value"),l=P((()=>{const e=yn.value.map((e=>({label:e.mail_type,value:e.id})));return e.unshift({label:t("Public.All"),value:-1}),e})),i=({option:e})=>"Group: ".concat(e.label),n=()=>{Qe({title:"Group Management",width:360,component:kn})},{loading:c,setLoading:p}=Je();return(async()=>{try{p(!0),await _n()}finally{p(!1)}})(),D((()=>{yn.value=[]})),(e,t)=>{const s=rt,p=ct;return o(),r("div",Mn,[u(p,{value:a.value,"onUpdate:value":t[0]||(t[0]=e=>a.value=e),loading:v(c),options:v(l),renderTag:i},{action:d((()=>[u(s,{block:"",onClick:n},{default:d((()=>t[1]||(t[1]=[y("Group Management")]))),_:1})])),_:1},8,["value","loading","options"])])}}}),Un={class:"px-20px pt-24px pb-8px"},Pn={class:"w-240px"},Rn=n({__name:"batch",props:{rows:{}},emits:["refresh"],setup(e,{expose:t,emit:a}){const l=e,i=a,{t:n}=x(),{rows:s}=l,p=w("formRef"),m=h({type:null}),f={type:{trigger:"change",validator:()=>null!==m.type||new Error(n("Mail.Unsubscribe.index_16"))}},y=P((()=>yn.value.map((e=>({label:e.mail_type,value:e.id}))))),{loading:_,setLoading:g}=Je();(async()=>{try{g(!0),await _n()}finally{g(!1)}})();return t({onConfirm:async()=>{var e;await(null==(e=p.value)?void 0:e.validate()),await Me({etypes:"".concat(m.type||0),recipients:s.map((e=>e.recipient)).join(","),active:s[0].active}),i("refresh")}}),(e,t)=>{const a=ct,l=mt,i=Lt;return o(),r("div",Un,[u(i,{ref_key:"formRef",ref:p,model:v(m),rules:f},{default:d((()=>[u(l,{label:"Groups",path:"type"},{default:d((()=>[c("div",Pn,[u(a,{value:v(m).type,"onUpdate:value":t[0]||(t[0]=e=>v(m).type=e),loading:v(_),options:v(y),multiple:"",filterable:""},null,8,["value","loading","options"])])])),_:1})])),_:1},8,["model"])])}}}),jn={class:"text-center fw-bold text-18px color-#666"},En={class:"w-96% h-200px mx-auto"},Tn=n({__name:"index",props:{active:{default:0}},setup(e){const t=T(e,"active"),a=(e=[])=>[{data:e}],l=(e=[])=>[{name:"Count",type:"line",data:e,itemStyle:{color:"#20a53a"},smooth:!0,showSymbol:!1,sampling:"average",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,global:!1,colorStops:[{offset:0,color:"rgba(32, 164, 58, 0.4)"},{offset:.7,color:"rgba(32, 164, 58, 0)"}]}}}],i=k({tooltip:{trigger:"axis",order:"seriesDesc",axisPointer:{type:"shadow"}},grid:{top:"16%",left:"2%",right:"2%",bottom:"4%",containLabel:!0},xAxis:a(),yAxis:{type:"value"},series:l()}),{loading:n,setLoading:s}=Je(),r=async()=>{try{s(!0);const{message:e}=await Ce({active:t.value});if(K(e)){const t=e.map((e=>e.month)),n=e.map((e=>e.count));i.xAxis=a(t),i.series=l(n)}}finally{s(!1)}};return r(),C((()=>t.value),(()=>{r()})),(e,a)=>{const l=J;return o(),b(l,{class:"mb-16px",show:v(n)},{default:d((()=>[c("div",jn,g(v(t)?e.$t("Mail.Mass.index_71"):e.$t("Mail.Mass.index_72"))+" "+g(e.$t("Mail.Mass.index_73")),1),c("div",En,[u(Mt,{height:200,option:v(i)},null,8,["option"])])])),_:1},8,["show"])}}}),Dn=n({__name:"index",setup(e,{expose:t}){const{t:a}=x(),l=h({p:1,size:10,active:1,keyword:""}),i=()=>{Qe({title:a("Mail.Mass.index_75"),width:540,minHeight:170,footer:!0,data:{active:l.active,group:Vt.value,refresh:()=>{w()}},component:fn})},n=e=>{l.active=e,l.p=1,w()},s=()=>{l.p=1,w()},{keys:r,table:c,columns:p,setLoading:m}=Ve([{type:"selection",width:40},{key:"recipient",title:a("Mail.Unsubscribe.index_1"),ellipsis:{tooltip:!0}},{key:"mail_type",title:"Group Name",render:e=>e.mail_type.map((e=>Object.values(e)[0])).join(", ")},{key:"created",title:a("Mail.Unsubscribe.index_19"),width:"12%",minWidth:140,render:e=>N(e.created)},Xe({width:250,options:e=>[{label:a("Mail.Mass.index_76"),onClick:async()=>{Qe({title:a("Mail.Mass.index_76"),width:500,footer:!0,data:{row:e,onRefresh:()=>{w()}},component:un})}},{label:e.active?a("Mail.Mass.index_72"):a("Mail.Mass.index_71"),show:!1,onClick:async()=>{Ye({title:"".concat(e.active?a("Mail.Mass.index_72"):a("Mail.Mass.index_71")," [").concat(e.recipient,"]"),content:a("Mail.Mass.index_77",[e.active?a("Mail.Mass.index_72"):a("Mail.Mass.index_71")]),onConfirm:async()=>{await Ue({recipient:e.recipient,active:0===e.active?1:0}),w()}})}},{label:a("Public.Btn.Del"),onClick:async()=>{Ye({title:"".concat(a("Public.Btn.Del")," [").concat(e.recipient,"]"),content:a("Mail.Mass.index_78",[e.active?a("Mail.Mass.index_71"):a("Mail.Mass.index_72")]),onConfirm:async()=>{await Pe({mails:"".concat(e.recipient),active:e.active}),w()}})}}]})]),_=[{key:"del",label:a("Public.Batch.Del"),onBatch:e=>{Ye({title:a("Public.Batch.Del"),content:a("Site.Batch.index_11"),onConfirm:async()=>{await Pe({mails:e.map((e=>e.recipient)).join("\n"),active:l.active}),w()}})}},{key:"category",label:"Batch set group",onBatch:e=>{Qe({title:"Batch set group",width:440,footer:!0,data:{rows:e,onRefresh:()=>{w()}},component:Rn})}}],w=async()=>{try{m(!0);const{message:e}=await Re({...-1===Vt.value?{}:{etype:Vt.value},search:l.keyword,p:l.p,size:l.size,active:l.active});I(e)&&(c.data=e.data,c.total=e.total)}finally{r.value=[],m(!1)}};return M((()=>{w()})),D((()=>{Vt.value=-1})),t({init:w}),(e,t)=>{const a=rt,m=st,h=ot,x=Nt,k=kt,M=It,C=zt,U=Ct,P=xt;return o(),b(P,null,{default:d((()=>[u(Tn,{active:v(l).active},null,8,["active"]),u(U,null,{toolsLeft:d((()=>[u(a,{type:"primary",onClick:i},{default:d((()=>[y(g(e.$t("Public.Btn.Import")),1)])),_:1})])),toolsRight:d((()=>[u(h,{value:v(l).active,"onUpdate:value":t[0]||(t[0]=e=>v(l).active=e),onUpdateValue:n},{default:d((()=>[u(m,{label:e.$t("Mail.Mass.index_71"),value:1},null,8,["label"]),u(m,{label:e.$t("Mail.Mass.index_72"),value:0},null,8,["label"])])),_:1},8,["value"]),u(Cn,{value:v(Vt),"onUpdate:value":[t[1]||(t[1]=e=>f(Vt)?Vt.value=e:null),w]},null,8,["value"]),u(x,{value:v(l).keyword,"onUpdate:value":t[2]||(t[2]=e=>v(l).keyword=e),width:240,placeholder:e.$t("Mail.Unsubscribe.index_5"),onSearch:s},null,8,["value","placeholder"])])),table:d((()=>[u(k,{"checked-row-keys":v(r),"onUpdate:checkedRowKeys":t[3]||(t[3]=e=>f(r)?r.value=e:null),"row-key":"id",loading:v(c).loading,data:v(c).data,columns:v(p)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:d((()=>[u(M,{"checked-row-keys":v(r),"onUpdate:checkedRowKeys":t[4]||(t[4]=e=>f(r)?r.value=e:null),"row-key":"id",data:v(c).data,options:_},null,8,["checked-row-keys","data"])])),pageRight:d((()=>[u(C,{page:v(l).p,"onUpdate:page":t[5]||(t[5]=e=>v(l).p=e),"page-size":v(l).size,"onUpdate:pageSize":t[6]||(t[6]=e=>v(l).size=e),"item-count":v(c).total,"store-key":"mail-unsubscribe",onRefresh:w},null,8,["page","page-size","item-count"])])),_:1})])),_:1})}}}),Sn={class:"p-20px"},Bn={class:"mt-12px"},$n={class:"mt-12px"},zn={class:"w-300px"},Ln={class:"w-300px"},An={class:"ml-32px"},On=n({__name:"AddGroup",props:{refresh:{}},setup(e,{expose:t}){const a=e,i=w("formRef"),n=h({type:1,input_name:"",select_name:null,file_path:""}),s={name:{trigger:["blur","input","change"],validator:()=>1!==n.type||n.input_name?!(0===n.type&&!n.select_name)||new Error("Please select the group name"):new Error("Please enter the group name")},file_path:{message:"Please upload file",trigger:["change"],validator:()=>!(0===n.type&&!n.file_path)||new Error("Please upload file")}},p=l([]),m=()=>{const e="/www/server/panel/data/mail/in_bulk/recipient";Ot({path:e,size:5,uploadData:{accept:["txt"].map((e=>".".concat(e))).join(","),multiple:!1},onUploadSuccess:t=>{n.file_path="".concat(e,"/").concat(t[0].name)}})};(async()=>{const{message:e}=await je();K(e)&&(p.value=e.map((e=>({label:e.mail_type,value:e.mail_type}))))})();return t({onConfirm:async()=>{var e;await(null==(e=i.value)?void 0:e.validate()),await Ee({is_new:n.type,group_name:0===n.type?n.select_name||"":n.input_name,file_path:n.file_path}),a.refresh()}}),(e,t)=>{const a=_t,l=ot,f=mt,h=pt,x=ct,w=rt,k=Lt,M=At;return o(),r("div",Sn,[u(k,{ref_key:"formRef",ref:i,model:v(n),rules:s},{default:d((()=>[u(f,{label:" "},{default:d((()=>[u(l,{value:v(n).type,"onUpdate:value":t[0]||(t[0]=e=>v(n).type=e)},{default:d((()=>[c("div",null,[u(a,{value:1},{default:d((()=>t[3]||(t[3]=[y("Create a new group and import")]))),_:1})]),c("div",Bn,[u(a,{value:0},{default:d((()=>t[4]||(t[4]=[y("Import into existing group")]))),_:1})]),c("div",$n,[u(a,{value:2},{default:d((()=>t[5]||(t[5]=[y("Only create a new group")]))),_:1})])])),_:1},8,["value"])])),_:1}),u(f,{label:"Group name",path:"name"},{default:d((()=>[B(c("div",zn,[u(h,{value:v(n).input_name,"onUpdate:value":t[1]||(t[1]=e=>v(n).input_name=e)},null,8,["value"])],512),[[$,1===v(n).type||2===v(n).type]]),B(c("div",Ln,[u(x,{value:v(n).select_name,"onUpdate:value":t[2]||(t[2]=e=>v(n).select_name=e),options:v(p)},null,8,["value","options"])],512),[[$,0===v(n).type]])])),_:1}),2!==v(n).type?(o(),b(f,{key:0,label:"File",path:"file_path"},{default:d((()=>[u(w,{onClick:m},{default:d((()=>[y(g(e.$t("Public.Btn.Import")),1)])),_:1}),c("div",An,[c("span",null,g(e.$t("Mail.Mass.index_43")),1),c("span",{class:j(v(n).file_path?"text-default":"text-error")},g(v(n).file_path||e.$t("Mail.Mass.index_44")),3)])])),_:1})):_("",!0)])),_:1},8,["model"]),u(M,{class:"ml-20px mt-8px"},{default:d((()=>t[6]||(t[6]=[c("li",null,"Currently, Only group files exported from aaPanel are supported for import.",-1)]))),_:1})])}}}),Hn={class:"p-20px pb-32px"},Gn={class:"flex items-center h-32px"},In={class:"mt-8px"},Nn=n({__name:"BatchExport",props:{rows:{default:()=>[]}},setup(e,{expose:t}){const a=e,l=h({type:0});return t({onConfirm:async()=>{const{message:e}=await Te({is_split:l.type,ids:a.rows.map((e=>e.id)).join(",")});I(e)&&Y(e.result)}}),(e,t)=>{const a=_t,i=ot,n=mt,s=Lt;return o(),r("div",Hn,[u(s,null,{default:d((()=>[u(n,{label:"Export method","show-feedback":!1},{default:d((()=>[u(i,{value:v(l).type,"onUpdate:value":t[0]||(t[0]=e=>v(l).type=e)},{default:d((()=>[c("div",Gn,[u(a,{value:0},{default:d((()=>t[1]||(t[1]=[y(" Export each group to a separate file ")]))),_:1})]),c("div",In,[u(a,{value:1},{default:d((()=>t[2]||(t[2]=[y(" Export multiple groups into a single file ")]))),_:1})])])),_:1},8,["value"])])),_:1})])),_:1})])}}}),Wn={class:"px-20px pt-24px pb-8px"},Fn={class:"w-240px"},qn=n({__name:"BatchMerge",props:{rows:{default:()=>[]},refresh:{}},setup(e,{expose:t}){const a=e,i=h({target_group:a.rows[0].id}),n=l([]);n.value=a.rows.map((e=>({label:e.mail_type,value:e.id})));return t({onConfirm:async()=>{await De({source_groups:a.rows.map((e=>e.id)).join(","),target_group:i.target_group}),a.refresh()}}),(e,t)=>{const a=ct,l=mt,s=Lt;return o(),r("div",Wn,[u(s,null,{default:d((()=>[u(l,{label:"Merge to"},{default:d((()=>[c("div",Fn,[u(a,{value:v(i).target_group,"onUpdate:value":t[0]||(t[0]=e=>v(i).target_group=e),options:v(n)},null,8,["value","options"])])])),_:1})])),_:1})])}}}),Kn={class:"p-20px pt-24px pb-8px"},Vn={class:"w-200px"},Jn=n({__name:"RenameGroup",props:{row:{},isEdit:{type:Boolean},refresh:{}},setup(e,{expose:t}){const a=e,{row:i,isEdit:n,refresh:s}=a,p=l(null),m=h({mail_type:i?i.mail_type:""}),f={mail_type:{required:!0,trigger:"blur",message:"Please enter group name"}};return t({onConfirm:async()=>{var e;await(null==(e=p.value)?void 0:e.validate()),n&&i?await Se({...L(m),id:i.id}):await Be(L(m)),null==s||s()}}),(e,t)=>{const a=pt,l=mt,i=Lt;return o(),r("div",Kn,[u(i,{ref_key:"formRef",ref:p,model:v(m),rules:f},{default:d((()=>[u(l,{label:"Group Name",path:"mail_type"},{default:d((()=>[c("div",Vn,[u(a,{value:v(m).mail_type,"onUpdate:value":t[0]||(t[0]=e=>v(m).mail_type=e),placeholder:"Please enter group name"},null,8,["value"])])])),_:1})])),_:1},8,["model"])])}}}),Qn=n({__name:"index",setup(e,{expose:t}){const{t:a}=x(),l=()=>{R()},i=h({show:!1,title:"Add Group",data:{refresh:l}}),n=()=>{i.title="Add Group",i.show=!0},s=h({p:1,size:10,type:-1,keyword:""}),{keys:c,table:p,columns:m,setLoading:_}=Ve([{type:"selection",width:40},{key:"mail_type",title:"Group Name",render:e=>u("a",{class:"bt-link",href:"javascript:;",onClick:()=>{var t;t=e.id,Vt.value=t,Vi("contact")}},[e.mail_type])},{key:"subscribers",title:a("Mail.Mass.index_71"),align:"center"},{key:"unsubscribers",title:a("Mail.Mass.index_72"),align:"center"},{key:"created",title:a("Mail.Unsubscribe.index_19"),render:e=>N(e.created)},Xe({width:200,options:e=>[{label:a("Mail.Mass.index_83"),show:!1,onClick:()=>{tt(e.subscribe_url)}},{label:a("Docker.Container.index_15"),onClick:()=>{P(e)}},{label:a("Public.Btn.Del"),onClick:()=>{Ye({title:a("Public.Btn.Del"),content:a("Mail.Mass.index_85",[e.mail_type]),onConfirm:async()=>{await $e({ids:e.id}),R()}})}}]})]),g=[{key:"del",type:"confirm",label:a("Public.Batch.Del"),confirm:{title:a("Public.Batch.Del"),desc:a("Site.Batch.index_11"),api:e=>$e({ids:e.id},!1),done:()=>{R()},columns:[{key:"mail_type",title:"Groups",ellipsis:{tooltip:{width:"trigger"}}}]}},{key:"export",label:"Batch export",onBatch:e=>{w(e)}},{key:"merge",label:"Batch merge",onBatch:e=>{C(e)}}],b=h({show:!1,title:"Export Group",data:{rows:[]}}),w=e=>{b.data.rows=e,b.show=!0},k=h({show:!1,title:"Merge Group",data:{rows:[],refresh:l}}),C=e=>{k.data.rows=e,k.show=!0},U=h({show:!1,title:"Edit Group",data:{row:null,isEdit:!1,refresh:l}}),P=e=>{U.data.row=e,U.data.isEdit=!0,U.show=!0},R=async()=>{try{_(!0);const{message:e}=await ze({search:s.keyword,p:s.p,size:s.size});I(e)&&(p.data=e.data,p.total=e.total)}finally{c.value=[],_(!1)}};return M((()=>{R()})),t({init:R}),(e,t)=>{const a=rt,l=Nt,_=kt,h=It,x=zt,w=Ct,M=$t;return o(),r("div",null,[u(w,null,{toolsLeft:d((()=>[u(a,{type:"primary",onClick:n},{default:d((()=>t[9]||(t[9]=[y("Add Group")]))),_:1})])),toolsRight:d((()=>[u(l,{value:v(s).keyword,"onUpdate:value":t[0]||(t[0]=e=>v(s).keyword=e),width:240,placeholder:e.$t("Config.Alarm.index_67"),onSearch:R},null,8,["value","placeholder"])])),table:d((()=>[u(_,{"checked-row-keys":v(c),"onUpdate:checkedRowKeys":t[1]||(t[1]=e=>f(c)?c.value=e:null),"row-key":"id",loading:v(p).loading,data:v(p).data,columns:v(m)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:d((()=>[u(h,{"checked-row-keys":v(c),"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>f(c)?c.value=e:null),"row-key":"id",data:v(p).data,options:g},null,8,["checked-row-keys","data"])])),pageRight:d((()=>[u(x,{page:v(s).p,"onUpdate:page":t[3]||(t[3]=e=>v(s).p=e),"page-size":v(s).size,"onUpdate:pageSize":t[4]||(t[4]=e=>v(s).size=e),"item-count":v(p).total,onRefresh:R},null,8,["page","page-size","item-count"])])),_:1}),u(M,{show:v(i).show,"onUpdate:show":t[5]||(t[5]=e=>v(i).show=e),title:v(i).title,width:530,data:v(i).data,footer:!0,component:On},null,8,["show","title","data"]),u(M,{show:v(U).show,"onUpdate:show":t[6]||(t[6]=e=>v(U).show=e),title:v(U).title,width:400,data:v(U).data,footer:!0,component:Jn},null,8,["show","title","data"]),u(M,{show:v(b).show,"onUpdate:show":t[7]||(t[7]=e=>v(b).show=e),title:v(b).title,width:440,data:v(b).data,footer:!0,component:Nn},null,8,["show","title","data"]),u(M,{show:v(k).show,"onUpdate:show":t[8]||(t[8]=e=>v(k).show=e),title:v(k).title,width:440,data:v(k).data,footer:!0,component:qn},null,8,["show","title","data"])])}}}),Yn=n({__name:"index",setup(e,{expose:t}){const{t:a}=x(),i=h({p:1,size:10,status:"bounced",search:""}),n=l([]),{keys:s,table:r,columns:c,setLoading:p}=Ve([{type:"selection",width:40},{key:"recipient",title:a("Mail.Unsubscribe.index_1")},{key:"task_name",title:a("Mail.Mass.index_23"),render:e=>"".concat(e.task_name," (").concat(N(e.task_time),")")},{key:"status",title:a("Ftp.Table.index_3")},{key:"state",title:a("Config.Safe.index_156"),render:e=>e.state||e.count>=3?a("Mail.Mass.index_95"):a("Mail.Mass.index_96")},{key:"created",title:a("Mail.Unsubscribe.index_19"),render:e=>N(e.created)},Xe({width:200,options:e=>[{label:a("Public.Btn.Del"),onClick:async()=>{Ye({title:a("Public.Btn.Del"),content:a("Mail.Mass.index_85",[e.recipient]),onConfirm:async()=>{await Le({ids:e.id}),k()}})}}]})]),m=[{key:"del",type:"confirm",label:a("Public.Batch.Del"),confirm:{title:a("Public.Batch.Del"),desc:a("Site.Batch.index_11"),api:e=>Le({ids:e.id},!1),done:()=>{k()},columns:[{key:"recipient",title:a("Mail.Unsubscribe.index_1"),ellipsis:{tooltip:{width:"trigger"}}}]}}],_=()=>{i.p=1,k()},w=()=>{Ye({title:a("Public.Btn.Clear"),content:a("Mail.Mass.index_94"),onConfirm:async()=>{await Oe({status:i.status}),k()}})},k=async()=>{try{p(!0);const{message:e}=await Ae(L(i));I(e)&&(r.data=e.data,r.total=e.total)}finally{s.value=[],p(!1)}},{loading:M,setLoading:C}=Je(),U=async()=>{await(async()=>{try{C(!0);const{message:e}=await He();K(e)&&(n.value=e.map((e=>({label:e.status,value:e.status}))),n.value.length&&(i.status=n.value[0].value))}finally{C(!1)}})(),k()};return U(),t({init:U}),(e,t)=>{const a=rt,l=ct,p=Nt,h=kt,x=It,C=zt,U=Ct,P=xt;return o(),b(P,null,{default:d((()=>[u(U,null,{toolsLeft:d((()=>[u(a,{type:"primary",onClick:k},{default:d((()=>[y(g(e.$t("Public.Btn.Refresh")),1)])),_:1}),u(a,{onClick:w},{default:d((()=>[y(g(e.$t("Public.Btn.Clear")),1)])),_:1})])),toolsRight:d((()=>[u(l,{class:"w-200px",loading:v(M),value:v(i).status,"onUpdate:value":[t[0]||(t[0]=e=>v(i).status=e),_],options:v(n)},null,8,["loading","value","options"]),u(p,{value:v(i).search,"onUpdate:value":t[1]||(t[1]=e=>v(i).search=e),width:240,placeholder:e.$t("Config.Alarm.index_67"),onSearch:k},null,8,["value","placeholder"])])),table:d((()=>[u(h,{"checked-row-keys":v(s),"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>f(s)?s.value=e:null),"row-key":"id",loading:v(r).loading,data:v(r).data,columns:v(c)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:d((()=>[u(x,{"checked-row-keys":v(s),"onUpdate:checkedRowKeys":t[3]||(t[3]=e=>f(s)?s.value=e:null),"row-key":"id",data:v(r).data,options:m},null,8,["checked-row-keys","data"])])),pageRight:d((()=>[u(C,{page:v(i).p,"onUpdate:page":t[4]||(t[4]=e=>v(i).p=e),"page-size":v(i).size,"onUpdate:pageSize":t[5]||(t[5]=e=>v(i).size=e),"item-count":v(r).total,onRefresh:k},null,8,["page","page-size","item-count"])])),_:1})])),_:1})}}}),Xn={key:0,class:"pt-40px pb-40px"},Zn={class:"text-center my-24px"},es={class:"flex justify-center"},ts={class:"w-76%"},as=q(n({__name:"conversion",setup(e){const t=F(),{isFree:a}=m(t),l=()=>{Ke({source:360})};return(e,t)=>{const i=rt,n=wt;return o(),r("div",null,[v(a)?(o(),r("div",Xn,[t[0]||(t[0]=c("div",{class:"mb-24px text-center text-24px font-bold"},"Automation",-1)),t[1]||(t[1]=c("div",{class:"text-center text-14px color-desc"}," Pro Edition Exclusive Features ",-1)),c("div",Zn,[u(i,{type:"primary",class:"px-20px h-38px text-15px",onClick:l},{default:d((()=>[y(g(e.$t("WP.Transition.index_7")),1)])),_:1})]),c("div",es,[c("div",ts,[u(n,{class:"w-full",width:"100%",src:v("/static/vite/images/auto-pro.png")},null,8,["src"])])])])):E(e.$slots,"default",{key:1},void 0,!0)])}}}),[["__scopeId","data-v-f5816121"]]),ls=[{key:"default",title:"Simple welcome email",description:"Send a welcome email to new subscribers",data:{triggers:[{type:"subscriber_added",group_ids:[]}],root:{broken:!1,complete:!1,email_id:0,from:"",from_name:"",id:0,name:"",next:null,nodeKey:"a86bac74",parentNodeKey:"root",parent_id:0,subject:"",track_opens:!0,track_clicks:!0,track_unsubscribe:!0,type:"email"}}}],is={class:"p-24px"},ns={class:"w-260px"},ss={class:"template-list"},os={class:"template-title"},rs={class:"template-desc"},us=q(n({__name:"index",setup(e,{expose:t}){const a=w("formRef"),i=h({name:""}),n=l("default"),s={name:{required:!0,message:"Please enter the task name",trigger:"blur"}},m=O();return t({onConfirm:async()=>{var e;await(null==(e=a.value)?void 0:e.validate());const t=ls.filter((e=>e.key===n.value))[0];if(t){const{message:e}=await Ge({name:i.name,triggers:t.data.triggers,root:t.data.root});ee.success("Add successfully"),I(e)&&m.push("/flow/".concat(e.id))}}}),(e,t)=>{const l=pt,m=mt,f=Lt;return o(),r("div",is,[u(f,{ref_key:"formRef",ref:a,model:v(i),rules:s},{default:d((()=>[u(m,{label:"Task name",path:"name"},{default:d((()=>[c("div",ns,[u(l,{value:v(i).name,"onUpdate:value":t[0]||(t[0]=e=>v(i).name=e)},null,8,["value"])])])),_:1}),u(m,{label:"Template","show-feedback":!1},{default:d((()=>[c("div",ss,[(o(!0),r(p,null,H(v(ls),(e=>(o(),r("div",{key:e.key,class:j(["template-item",{active:v(n)===e.key}])},[c("div",os,g(e.title),1),c("div",rs,g(e.description),1)],2)))),128))])])),_:1})])),_:1},8,["model"])])}}}),[["__scopeId","data-v-5af2dd72"]]),ds={class:"px-20px pt-28px pb-12px"},cs={class:"w-240px"},ps=n({__name:"index",props:{row:{default:null}},setup(e,{expose:t}){const a=e,l=w("formRef"),i=h({name:""}),n={name:{required:!0,trigger:"blur",message:"Please enter the name"}};return(()=>{const{row:e}=a;e&&(i.name=e.name||"")})(),t({onConfirm:async()=>{var e;await(null==(e=l.value)?void 0:e.validate()),await Ie({id:a.row.id,name:i.name}),a.row.name=i.name}}),(e,t)=>{const a=pt,s=mt,p=Lt;return o(),r("div",ds,[u(p,{ref_key:"formRef",ref:l,model:v(i),rules:n},{default:d((()=>[u(s,{label:"Name",path:"name"},{default:d((()=>[c("div",cs,[u(a,{value:v(i).name,"onUpdate:value":t[0]||(t[0]=e=>v(i).name=e)},null,8,["value"])])])),_:1})])),_:1},8,["model"])])}}}),ms=n({__name:"index",setup(e){const{t:t}=x(),a=h({show:!1}),l=()=>{a.show=!0},{table:i,columns:n,setLoading:s}=Ve([{key:"name",title:"Name"},{key:"status",title:"Status",render:e=>u(yt,{value:e.status,checkedValue:1,uncheckedValue:0,size:"small",onUpdateValue:async t=>{await Ne({id:e.id,status:t}),e.status=t}},null)},{key:"sent",title:"Delivered / Sent",render:e=>"".concat(e.delivered," / ").concat(e.sent)},{key:"clicked",title:"Clicked",render:e=>"".concat(e.clicked,"%")},{key:"opened",title:"Opened",render:e=>"".concat(e.opened,"%")},Xe({width:260,options:e=>[{label:"Duplicate",onClick:()=>{r(e)}},{label:"Rename",onClick:()=>{p(e)}},{label:t("Public.Btn.Edit"),disabled:1===e.status,onClick:()=>{f(e)}},{label:t("Public.Btn.Delete"),onClick:()=>{_(e)}}]})]),r=async e=>{const t=ee.loading("Copying, please wait...");try{const{message:t}=await We({id:e.id});if(I(t)){const a=e=>{let t=e;for(;t;)t.id=0,I(t)&&"condition"===t.type&&(a(t.yes),a(t.no)),t=t.next};a(t.root),await Ge({name:"".concat(e.name," - Copy"),triggers:t.triggers,root:t.root},!1),w(),ee.success("Copy success")}}finally{t.close()}},c=h({show:!1,title:"Rename the automation",data:{row:null}}),p=e=>{c.data.row=e,c.show=!0},m=O(),f=e=>{m.push("/flow/".concat(e.id))},_=e=>{Ye({title:"Delete [".concat(e.name,"]"),content:"Are you sure to delete this item?",onConfirm:async()=>{try{s(!0),await Fe({id:e.id}),w()}finally{s(!1)}}})},g=h({keyword:"",p:1,p_size:10}),w=async()=>{try{s(!0);const{message:e}=await qe(L(g));I(e)&&(i.data=K(e.list)?e.list:[],i.total=e.total)}finally{s(!1)}};return w(),(e,t)=>{const s=rt,r=kt,p=zt,m=Ct,f=$t;return o(),b(as,null,{default:d((()=>[u(m,null,{toolsLeft:d((()=>[u(s,{type:"primary",onClick:l},{default:d((()=>t[4]||(t[4]=[y("New automation")]))),_:1})])),table:d((()=>[u(r,{loading:v(i).loading,data:v(i).data,columns:v(n)},null,8,["loading","data","columns"])])),pageRight:d((()=>[u(p,{page:v(g).p,"onUpdate:page":t[0]||(t[0]=e=>v(g).p=e),"page-size":v(g).p_size,"onUpdate:pageSize":t[1]||(t[1]=e=>v(g).p_size=e),"item-count":v(i).total,onRefresh:w},null,8,["page","page-size","item-count"])])),_:1}),u(f,{show:v(a).show,"onUpdate:show":t[2]||(t[2]=e=>v(a).show=e),title:"Add Automated Task",width:500,footer:!0,component:us},null,8,["show"]),u(f,{show:v(c).show,"onUpdate:show":t[3]||(t[3]=e=>v(c).show=e),title:v(c).title,width:440,data:v(c).data,footer:!0,component:ps},null,8,["show","title","data"])])),_:1})}}}),vs=n({__name:"index",setup(e){const a=[{key:"overview",label:"Overview",component:Ka},{key:"task",label:"Marketing Task",component:Ki},{key:"template",label:"Template",component:an},{key:"contact",label:"Subscribers",component:Dn},{key:"mail",label:"Groups",component:Qn},{key:"invalid",label:"Suspend List",component:Yn},{key:"automation",label:"Automation",component:ms}];return(e,l)=>{const i=t,n=xt;return o(),b(n,{class:"p-16px"},{default:d((()=>[u(i,{value:v(Ft),"onUpdate:value":l[0]||(l[0]=e=>f(Ft)?Ft.value=e:null),options:a},null,8,["value"])])),_:1})}}}),fs=Object.freeze(Object.defineProperty({__proto__:null,default:vs},Symbol.toStringTag,{value:"Module"}));export{ui as A,gl as B,di as C,dl as D,ci as E,pi as F,Tl as G,yi as H,fi as I,jl as J,Ql as K,fs as L,Dl as a,si as b,xl as c,cl as d,Rl as e,oi as f,hi as g,bi as h,Zl as i,Cl as j,wl as k,mi as l,yl as m,vl as n,fl as o,bl as p,_l as q,li as r,kl as s,Ll as t,ei as u,hl as v,Ml as w,Pl as x,ni as y,ri as z};
