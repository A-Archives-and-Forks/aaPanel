import{_ as e}from"./index103.js?v=1747989938512";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang.js?v=1747989938512";import{_ as t}from"./index.vue_vue_type_script_setup_true_lang11.js?v=1747989938512";import{_ as s}from"./index97.js?v=1747989938512";import{cr as l,o as i,N as n,_ as d,q as o,g as r,c as p,m as u,bD as _,aV as c,p as v}from"./page_layout.js?v=1747989938512";import{d as m,O as f,_ as P,ae as x,e as S,R as b,S as h,U as w,P as H,V as y,a1 as g,c as $,a2 as U,ao as j,F as k,r as L,n as q,j as E,k as I,aj as M,v as R,a0 as O}from"./vue.js?v=1747989938512";import{aq as C,c as z,aJ as D,aK as B}from"./site.js?v=1747989938512";import{d as F,u as J}from"./public.js?v=1747989938512";import{b as N}from"./soft.js?v=1747989938512";import{cp as Q,co as T,cn as V,cj as K,_ as Z,bU as A,c0 as G,bZ as W}from"./naive.js?v=1747989938512";import{D as X}from"./domain-input.js?v=1747989938512";import"./index96.js?v=1747989938512";import"./common.js?v=1747989938512";import"./__commonjsHelpers__.js?v=1747989938512";const Y={class:"w-150px"},ee={key:0,class:"ml-8px"},ae=m({__name:"select-ftp",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const{t:a}=f(),t=l(),{ftp:s}=P(t),n=x(e,"value"),d=[{label:a("Site.PHP.add_site_31"),value:"0"},{label:a("Site.PHP.add_site_34"),value:"1"}],o=S((()=>!s.value.setup)),r=()=>{N("pureftpd")};return(e,a)=>{const t=Q,s=i;return b(),h(k,null,[w("div",Y,[H(t,{value:n.value,"onUpdate:value":a[0]||(a[0]=e=>n.value=e),class:"ftp-select",options:d,disabled:y(o)},null,8,["value","disabled"])]),y(o)?(b(),h("div",ee,[H(s,{onClick:r},{default:g((()=>[$(U(e.$t("Site.PHP.add_site_33")),1)])),_:1})])):j("",!0)],64)}}}),te={class:"w-150px"},se={key:0,class:"ml-8px"},le=m({__name:"select-database",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const{t:a}=f(),t=l(),{mysql:s}=P(t),n=x(e,"value"),d=[{label:a("Site.PHP.add_site_31"),value:"0"},{label:a("Site.PHP.add_site_32"),value:"MySQL"}],o=S((()=>!s.value.setup)),r=()=>{N("mysql")};return(e,a)=>{const t=Q,s=i;return b(),h(k,null,[w("div",te,[H(t,{value:n.value,"onUpdate:value":a[0]||(a[0]=e=>n.value=e),class:"db-select",options:d,disabled:y(o)},null,8,["value","disabled"])]),y(o)?(b(),h("div",se,[H(s,{onClick:r},{default:g((()=>[$(U(e.$t("Site.PHP.add_site_30")),1)])),_:1})])):j("",!0)],64)}}}),ie={class:"w-150px"},ne=m({__name:"select-php",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const a=x(e,"value"),{loading:t,setLoading:s}=F(),l=L([]);return(async()=>{try{s(!0);const{message:e}=await C(),t=n(e)?e:[];l.value=t.reverse().map((e=>({label:e.name,value:e.version}))),await q(),t.length>0&&(a.value=t[0].version)}finally{s(!1)}})(),(e,s)=>{const i=Q;return b(),h("div",ie,[H(i,{value:a.value,"onUpdate:value":s[0]||(s[0]=e=>a.value=e),class:"php-select",loading:y(t),options:y(l)},null,8,["value","loading","options"])])}}}),de={class:"w-150px"},oe=m({__name:"select-category",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const a=x(e,"value"),{loading:t,setLoading:s}=F(),l=L([]);return(async()=>{try{s(!0);const{message:e}=await z();n(e)?(l.value=e.map((e=>({label:e.name,value:e.id}))),e.length>0&&(a.value=e[0].id)):l.value=[]}finally{s(!1)}})(),(e,s)=>{const i=Q;return b(),h("div",de,[H(i,{value:a.value,"onUpdate:value":s[0]||(s[0]=e=>a.value=e),class:"type-select",loading:y(t),options:y(l)},null,8,["value","loading","options"])])}}}),re={class:"flex items-center w-600px py-30px px-50px"},pe={class:"w-120px text-primary"},ue={class:"flex flex-col gap-16px flex-1 ml-60px"},_e={key:0,class:"leading-24px"},ce={class:"flex items-center h-30px"},ve={class:"mt-8px"},me={class:"font-bold"},fe={class:"font-bold"},Pe={key:1,class:"leading-24px"},xe={class:"flex items-center h-30px"},Se={class:"mt-8px"},be={class:"font-bold"},he={class:"font-bold"},we=m({__name:"site-result",props:{data:{}},setup(e){const a=e,{info:t}=a.data;return(e,a)=>{const s=d,l=o;return b(),h("div",re,[w("div",pe,[H(s,{name:"base-success",size:"120"})]),w("div",ue,[y(t).ftpStatus?(b(),h("div",_e,[w("div",ce,U(e.$t("Site.PHP.add_site_35")),1),H(l,{dashed:""}),w("div",ve,[$(U(e.$t("Site.PHP.add_site_37")),1),w("span",me,U(y(t).ftpUser||"--"),1)]),w("div",null,[$(U(e.$t("Site.PHP.add_site_38")),1),w("span",fe,U(y(t).ftpPass||"--"),1)])])):j("",!0),y(t).databaseStatus?(b(),h("div",Pe,[w("div",xe,U(e.$t("Site.PHP.add_site_36")),1),H(l,{dashed:""}),w("div",Se,[$(U(e.$t("Site.PHP.add_site_37"))+" ",1),w("span",be,U(y(t).databaseUser||"--"),1)]),w("div",null,[$(U(e.$t("Site.PHP.add_site_38"))+" ",1),w("span",he,U(y(t).databasePass||"--"),1)])])):j("",!0)])])}}}),He={class:"w-440px"},ye={class:"w-400px"},ge={class:"w-400px"},$e={class:"flex-1"},Ue={class:"w-174px"},je={class:"ml-8px"},ke={class:"w-174px"},Le={class:"mt-8px text-desc"},qe={class:"flex-1"},Ee={class:"w-174px"},Ie={class:"ml-8px"},Me={class:"w-174px"},Re={class:"mt-8px text-desc"},Oe={class:"w-150px"},Ce=m({__name:"index",props:{getList:{type:Function}},setup(e,{expose:i}){const n=e,{t:o}=f(),_=l(),c=L("0"),v=L("0"),m=L(null),P=L(null),x=L([]),S=E({type:0,domain:[""],webname:{domain:""},ps:"",path:_.sitePath,ftp:!1,ftp_username:"",ftp_password:"",sql:!1,codeing:"utf8",datauser:"",datapassword:"",version:null,type_id:null,set_ssl:!1,force_ssl:!1,is_create_default_file:!0}),k={"webname.domain":{required:!0,trigger:["blur","change"],validator:(e,a)=>""!==a.trim()||0!==S.type||new Error(o("Site.PHP.add_site_23"))},domain:{trigger:["blur"],validator:(e,a)=>!(!a[0]&&1===S.type)||new Error(o("Site.PHP.add_site_23"))},path:{trigger:["blur","change"],validator:(e,a)=>""!==a||new Error(o("Site.PHP.add_site_26"))},version:{trigger:"change",validator:(e,a)=>null!==a||new Error(o("Site.PHP.add_site_27"))},type_id:{trigger:"change",validator:(e,a)=>null!==a||new Error(o("Site.PHP.add_site_28"))}},q=e=>{if(!e)return void(S.webname.domain=S.domain.filter(Boolean).join("\n"));const a=S.webname.domain.trim();a!==S.domain.join("\n")&&(S.domain=a?a.split("\n").filter(Boolean):[""],S.domain.forEach(((e,a)=>{var t;return null==(t=m.value)?void 0:t.onDomainItemBlur(e,a)})))},C=e=>{const a=null==e?void 0:e.trim().split("\n")[0].split(":")[0];if(a){const e=a.replace(new RegExp(/([-.])/g),"_");S.ps=e,S.path="".concat(_.sitePath,"/").concat(a),S.ftp_username="ftp_".concat(e),S.ftp_password=r(16),S.datauser="sql_".concat(e),S.datapassword=r(16)}else S.ps="",S.path=_.sitePath,S.ftp_username="",S.ftp_password="",S.datauser="",S.datapassword=""},z=e=>{S.ftp="1"===e},B=e=>{S.sql="0"!==e&&e};return i({onConfirm:async()=>{var e;await new Promise(((e,a)=>{0===x.value.filter((e=>e.hash)).length&&1===S.type?(u.error("This domain does not support automatic resolution, please choose manual resolution"),a(!1)):e(!0)})),await(null==(e=P.value)?void 0:e.validate());const{message:a}=await D((()=>{const{version:e,type_id:a}=S;if(null===e)throw u.error(o("Site.PHP.add_site_27")),new Error(o("Site.PHP.add_site_27"));if(null===a)throw u.error(o("Site.PHP.add_site_28")),new Error(o("Site.PHP.add_site_28"));const t=S.webname.domain.trim().split("\n"),s=t[0]+"\r",l=t[0].split(":")[1]||"80",i=t.length>1?t.slice(1):[],n=x.value.filter((e=>e.hash)).map((e=>({domain:e.domain,hash:e.hash,support:[...e.auto?["auto"]:[],...e.ssl_cert?["ssl_cert"]:[],...e.cf_proxy?["cf_proxy"]:[]]})));let d={webname:{domain:s,domainlist:i,count:i.length},parse_list:1===S.type&&n.length?JSON.stringify(n):null,port:l,type:"PHP",ps:S.ps,path:S.path,ftp:S.ftp,sql:S.sql,codeing:S.codeing,version:e,type_id:a,set_ssl:S.set_ssl?1:0,force_ssl:S.force_ssl?1:0,is_create_default_file:S.is_create_default_file};return S.ftp&&(d=Object.assign(d,{ftp_username:S.ftp_username,ftp_password:S.ftp_password})),S.sql&&(d=Object.assign(d,{datauser:S.datauser,datapassword:S.datapassword})),d})());var t;!p(a)||!1===a.ftpStatus&&!1===a.databaseStatus?u.success(o("Site.PHP.add_site_29")):(t=a,J({title:o("Site.PHP.add_site_29"),data:{info:t},component:we})),n.getList()}}),(e,l)=>{const i=T,n=V,o=d,r=K,p=s,u=Z,_=t,f=A,L=G,E=a;return b(),h("div",null,[H(E,{ref_key:"formRef",ref:P,model:y(S),rules:k},{default:g((()=>[H(r,{label:e.$t("SSL.index_1")},{default:g((()=>[H(n,{value:y(S).type,"onUpdate:value":[l[0]||(l[0]=e=>y(S).type=e),q]},{default:g((()=>[H(i,{value:0},{default:g((()=>[$(U(e.$t("SSL.index_2")),1)])),_:1}),H(i,{value:1},{default:g((()=>[$(U(e.$t("SSL.index_3")),1)])),_:1})])),_:1},8,["value"]),H(o,{name:"ssl-stars",size:22})])),_:1},8,["label"]),I(H(r,{label:e.$t("Site.PHP.add_site_4"),path:"domain"},{default:g((()=>[H(X,{ref_key:"domainInputRef",ref:m,value:y(S).domain,"onUpdate:value":l[1]||(l[1]=e=>y(S).domain=e),"parse-list":y(x),"onUpdate:parseList":l[2]||(l[2]=e=>M(x)?x.value=e:null),"onUpdate:domain":C},null,8,["value","parse-list"])])),_:1},8,["label"]),[[R,1===y(S).type]]),I(H(r,{label:e.$t("Site.PHP.add_site_4"),path:"webname.domain"},{default:g((()=>[w("div",He,[H(p,{value:y(S).webname.domain,"onUpdate:value":[l[3]||(l[3]=e=>y(S).webname.domain=e),C],name:"domain"},{default:g((()=>[w("p",null,U(e.$t("Site.PHP.add_site_5")),1),w("p",null,U(e.$t("Site.PHP.add_site_6")),1),w("p",null,U(e.$t("Site.PHP.add_site_7")),1)])),_:1},8,["value"])])])),_:1},8,["label"]),[[R,0===y(S).type]]),H(r,{label:e.$t("Site.PHP.add_site_8"),path:"ps"},{default:g((()=>[w("div",ye,[H(u,{value:y(S).ps,"onUpdate:value":l[4]||(l[4]=e=>y(S).ps=e),"input-props":{name:"ps"},placeholder:""},null,8,["value"])])])),_:1},8,["label"]),H(r,{label:e.$t("Site.PHP.add_site_9"),path:"path"},{default:g((()=>[w("div",ge,[H(_,{value:y(S).path,"onUpdate:value":l[5]||(l[5]=e=>y(S).path=e),"input-props":{name:"path"}},null,8,["value"])])])),_:1},8,["label"]),H(r,{label:e.$t("Site.PHP.add_site_10")},{default:g((()=>[H(ae,{value:y(c),"onUpdate:value":[l[6]||(l[6]=e=>M(c)?c.value=e:null),z]},null,8,["value"])])),_:1},8,["label"]),"1"===y(c)?(b(),O(r,{key:0,label:e.$t("Site.PHP.add_site_11")},{default:g((()=>[w("div",$e,[H(f,{class:"items-center"},{default:g((()=>[w("div",Ue,[H(u,{value:y(S).ftp_username,"onUpdate:value":l[7]||(l[7]=e=>y(S).ftp_username=e),"input-props":{name:"ftp_username"},placeholder:e.$t("Site.PHP.add_site_12")},null,8,["value","placeholder"])]),w("div",je,U(e.$t("Site.PHP.add_site_13")),1),w("div",ke,[H(u,{value:y(S).ftp_password,"onUpdate:value":l[8]||(l[8]=e=>y(S).ftp_password=e),"input-props":{name:"ftp_password"},placeholder:e.$t("Site.PHP.add_site_14")},null,8,["value","placeholder"])])])),_:1}),w("div",Le,U(e.$t("Site.PHP.add_site_15")),1)])])),_:1},8,["label"])):j("",!0),H(r,{label:e.$t("Site.PHP.add_site_16")},{default:g((()=>[H(le,{value:y(v),"onUpdate:value":[l[9]||(l[9]=e=>M(v)?v.value=e:null),B]},null,8,["value"])])),_:1},8,["label"]),"MySQL"===y(v)?(b(),O(r,{key:1,label:e.$t("Site.PHP.add_site_17")},{default:g((()=>[w("div",qe,[H(f,{class:"items-center"},{default:g((()=>[w("div",Ee,[H(u,{value:y(S).datauser,"onUpdate:value":l[10]||(l[10]=e=>y(S).datauser=e),"input-props":{name:"db_username"},placeholder:e.$t("Site.PHP.add_site_18")},null,8,["value","placeholder"])]),w("div",Ie,U(e.$t("Site.PHP.add_site_13")),1),w("div",Me,[H(u,{value:y(S).datapassword,"onUpdate:value":l[11]||(l[11]=e=>y(S).datapassword=e),"input-props":{name:"db_password"},placeholder:e.$t("Site.PHP.add_site_19")},null,8,["value","placeholder"])])])),_:1}),w("div",Re,U(e.$t("Site.PHP.add_site_20")),1)])])),_:1},8,["label"])):j("",!0),H(r,{label:e.$t("Site.PHP.add_site_21"),path:"version"},{default:g((()=>[w("div",Oe,[H(ne,{value:y(S).version,"onUpdate:value":l[12]||(l[12]=e=>y(S).version=e)},null,8,["value"])])])),_:1},8,["label"]),H(r,{label:e.$t("Site.PHP.add_site_22"),path:"type_id"},{default:g((()=>[H(oe,{value:y(S).type_id,"onUpdate:value":l[13]||(l[13]=e=>y(S).type_id=e)},null,8,["value"])])),_:1},8,["label"]),H(r,{label:e.$t("SSL.SiteSSL.index_18")},{default:g((()=>[H(L,{value:y(S).is_create_default_file,"onUpdate:value":l[14]||(l[14]=e=>y(S).is_create_default_file=e)},null,8,["value"])])),_:1},8,["label"])])),_:1},8,["model"])])}}}),ze={class:"px-10px"},De={class:"mt-8px leading-22px text-default"},Be={class:"mt-6px"},Fe=m({__name:"index",setup(e,{expose:t}){const{t:i}=f(),n=l(),d=E({domain:"domain|1|0|0|0\ndomain|1|0|0|0\ndomain|1|0|0|0"}),o=L([{key:"name",title:i("Site.TableRow.index_1")},{key:"ftp",title:i("Site.PHP.add_site_10"),render:e=>e.succesInfo?e.succesInfo.ftp_status?H("span",{class:"text-primary"},[i("Site.PHP.index_35")]):"".concat(i("Site.PHP.index_37")):"--"},{key:"database",title:i("Site.PHP.add_site_16"),render:e=>e.succesInfo?e.succesInfo.db_status?H("span",{class:"text-primary"},[i("Site.PHP.index_35")]):"".concat(i("Site.PHP.index_37")):"--"},{key:"result",title:i("Site.DelSite.index_10"),render:e=>"error"===e.status?H("span",{class:"text-error"},[e.errorMsg]):H("span",{class:"text-primary"},[i("Site.PHP.index_35")])}]);return t({onConfirm:async()=>{let e=[];const a=d.domain.trim().split("\n");for(let s=0;s<a.length;s++){const t=a[s].split("|");for(let a=0;a<t.length;a++){const l=s+1,n=t[a].trim();switch(a){case 0:e=n.split(",");for(let a=0;a<e.length;a++){const a=e[0],t=a.split(":");if(!_(t[0]))return void u.error("".concat(i("Site.PHP.index_39")," ").concat(l,", ").concat(i("Site.PHP.index_40")," [").concat(a,"]"));if(void 0!==t[1]&&c(t[1]))return void u.error("".concat(i("Site.PHP.index_39")," ").concat(l,", ").concat(i("Site.PHP.index_41")," [").concat(t[1],"]"))}break;case 1:if("1"!==n&&n.indexOf("/")<-1)return void u.error("".concat(i("Site.PHP.index_39")," ").concat(l,", ").concat(i("Site.PHP.index_42")," [").concat(n,"]"))}}}const{message:t}=await B({websites_content:a});p(t)&&(u.success(t.msg),(e=>{const a=[];Object.entries(e.error).forEach((([e,t])=>{a.push({name:e,status:"error",errorMsg:t.result})})),Object.entries(e.success).forEach((([e,t])=>{a.push({name:e,status:"success",succesInfo:t})})),J({title:i("Site.PHP.index_38"),content:()=>H("div",{class:"w-500px p-20px"},[H(W,{data:a,columns:o.value},null)])})})(t)),n.setRefresh(!0)}}),(e,t)=>{const l=s,i=K,n=a;return b(),h("div",ze,[H(n,{ref:"formRef"},{default:g((()=>[H(i,{label:""},{default:g((()=>[H(l,{value:y(d).domain,"onUpdate:value":t[0]||(t[0]=e=>y(d).domain=e),rows:10,name:"batch-domain"},null,8,["value"])])),_:1})])),_:1},512),w("div",De,[w("p",null,U(e.$t("Site.PHP.add_site_39")),1),w("p",Be,U(e.$t("Site.PHP.add_site_40")),1),w("p",null,U(e.$t("Site.PHP.add_site_41")),1),w("p",null,U(e.$t("Site.PHP.add_site_42")),1),w("p",null,U(e.$t("Site.PHP.add_site_43")),1),w("p",null,U(e.$t("Site.PHP.add_site_44")),1),t[1]||(t[1]=w("p",{class:"mt-6px"},"Eq, bt.cn,test.cn:8081|/www/wwwroot/bt.cn|1|1|56",-1))])])}}}),Je={class:"p-20px h-full"},Ne=v(m({__name:"index",props:{done:{type:Function}},setup(a,{expose:t}){const s=a,{t:l}=f(),i=L("single"),n=L(),d=[{key:"single",label:l("Site.PHP.add_site_1"),isLazy:!0,component:Ce,data:{getList:s.done}},{key:"batch",label:l("Site.PHP.add_site_2"),isLazy:!0,component:Fe}];return t({onConfirm:async()=>{var e;await(null==(e=n.value)?void 0:e.onConfirm())}}),(a,t)=>{const s=e;return b(),h("div",Je,[H(s,{ref_key:"tabsRef",ref:n,value:y(i),"onUpdate:value":t[0]||(t[0]=e=>M(i)?i.value=e:null),options:d},null,8,["value"])])}}}),[["__scopeId","data-v-22c72b40"]]);export{Ne as default};
