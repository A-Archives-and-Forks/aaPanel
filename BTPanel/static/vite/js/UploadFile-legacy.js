System.register(["./index-legacy.js?v=1756367574781","./page_layout-legacy.js?v=1756367574781","./public-legacy.js?v=1756367574781","./index-legacy39.js?v=1756367574781","./vue-legacy.js?v=1756367574781","./naive-legacy.js?v=1756367574781","./common-legacy.js?v=1756367574781","./__commonjsHelpers__-legacy.js?v=1756367574781","./soft-legacy2.js?v=1756367574781","./soft-legacy.js?v=1756367574781","./file-legacy2.js?v=1756367574781","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1756367574781"],function(e,l){"use strict";var t,a,i,s,o,n,r,u,d,p,f,c,v,m,g,x,y,b,h,w,_,k,M,C,j,$,z,S,P,F,U,I;return{setters:[e=>{t=e._},e=>{a=e.n,i=e._,s=e.cm,o=e.m,n=e.t,r=e.p},e=>{u=e.a},e=>{d=e.u,p=e.g},e=>{f=e.k,c=e.P,v=e.i,m=e.r,g=e.W,x=e.a2,y=e.V,b=e.a3,h=e.S,w=e.a4,_=e.U,k=e.ak,M=e.c,C=e.R,j=e.j,$=e.an,z=e.F,S=e.O,P=e.I},e=>{F=e.dg,U=e.di,I=e.aC},null,null,null,null,null,null],execute:function(){var l=document.createElement("style");l.textContent='@charset "UTF-8";.modal-footer-btns[data-v-70709f9b]{display:flex;align-items:center;flex-direction:row;justify-content:end;gap:10px;padding:10px}.single-line-ellipsis[data-v-70709f9b]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.files-list-wrapper .files-tit[data-v-70709f9b],.files-list-wrapper .list-item[data-v-70709f9b]{display:flex;justify-content:flex-start;padding:14px 10px;border-bottom:1px solid var(--color-border);position:relative}.files-list-wrapper .files-tit .progress[data-v-70709f9b],.files-list-wrapper .list-item .progress[data-v-70709f9b]{position:absolute;width:0;height:100%;background:rgba(11,199,43,.1);left:0;top:0;transition:all .25s ease-in-out}.files-list-wrapper .files-tit span[data-v-70709f9b],.files-list-wrapper .list-item span[data-v-70709f9b]{box-sizing:border-box;padding-left:10px}.files-list-wrapper .files-tit .name[data-v-70709f9b],.files-list-wrapper .list-item .name[data-v-70709f9b]{flex:4}.files-list-wrapper .files-tit .size[data-v-70709f9b],.files-list-wrapper .list-item .size[data-v-70709f9b],.files-list-wrapper .files-tit .status[data-v-70709f9b],.files-list-wrapper .list-item .status[data-v-70709f9b]{flex:2;text-align:center}.files-list-wrapper .files-tit .operation[data-v-70709f9b],.files-list-wrapper .list-item .operation[data-v-70709f9b]{flex:2;text-align:right}.status-tools-wrapper[data-v-70709f9b]{box-sizing:border-box}.status-tools-wrapper .status-tools[data-v-70709f9b]{display:flex;align-items:center;flex-direction:row;justify-content:start;padding:0 20px;gap:15px;background:#dff0d8;border-radius:10px}.status-tools-wrapper .status-tools .tools-item[data-v-70709f9b]{display:flex;flex-direction:row;justify-content:start;align-items:center;gap:5px}.status-tools-wrapper .status-tools .tools-item .item-label[data-v-70709f9b],.status-tools-wrapper .status-tools .tools-item .value[data-v-70709f9b]{height:40px;line-height:40px;color:#3c763d}.file-empty[data-v-70709f9b]{display:flex;justify-content:center;align-items:center;height:440px;border:2px dashed var(--color-border);border-radius:10px;font-size:30px;color:var(--color-text-3)}\n/*$vite$:1*/',document.head.appendChild(l);const N={class:"p-20px"},L={class:"flex items-center gap-10px mb-16px"},R={class:"flex-1 w-0 text-14px"},A=f({__name:"FileConflict",props:{fileList:{}},emits:["step","confirm"],setup(e,{emit:l}){const{t:s}=c(),o=l,n=v("fileStore"),{fileConflictShow:r}=n,u=m([{title:s("file.uploadModal.conflictFileName"),key:"filename",ellipsis:{tooltip:!0}},{title:s("file.uploadModal.conflictFileDifference"),key:"difference",width:200,render:e=>g("span",null,[a(e.size)+"--\x3e"+a(e.size)])}]),d=()=>{o("step")},p=()=>{o("confirm")};return(e,l)=>{const a=i,o=F,n=t;return y(),x(n,{show:_(r),"onUpdate:show":l[0]||(l[0]=e=>k(r)?r.value=e:null),title:_(s)("file.uploadModal.conflictTitle"),width:600,footer:!0,"confirm-text":_(s)("file.uploadModal.conflictOverwrite"),"cancel-text":_(s)("file.uploadModal.conflictSkip"),onCancel:d,onConfirm:p},{default:b(()=>[h("div",N,[h("div",L,[g(a,{name:"base-warning",class:"text-warning text-30px"}),h("div",R,w(_(s)("file.uploadModal.conflictMessage")),1)]),g(o,{"max-height":400,columns:_(u),data:e.fileList},null,8,["columns","data"])])]),_:1},8,["show","title","confirm-text","cancel-text"])}}}),E={class:"p-20px"},T={key:0,class:"flex justify-between items-center mb-16px"},B={key:1,class:"status-tools-wrapper mb-16px"},H={class:"status-tools"},O={class:"tools-item"},D={class:"item-label"},V={class:"value"},W={class:"tools-item"},q={class:"item-label"},G={class:"value"},J={class:"tools-item"},K={class:"item-label"},Q={class:"value"},X={key:0,class:"tools-item"},Y={class:"item-label"},Z={class:"value"},ee={key:2,class:"files-list-wrapper"},le={class:"files-tit"},te={class:"name"},ae={class:"size"},ie={class:"status"},se={class:"operation"},oe={class:"name"},ne={class:"size"},re={class:"status"},ue={class:"operation"},de={key:3,class:"file-empty"},pe={class:"flex justify-end gap-16px mt-20px"};e("default",r(f({__name:"UploadFile",setup(e,{expose:l}){const r=v("fileStore"),{uploadFileList:f,uploadShow:F}=r,{currentPath:N,uploadComplete:L,startUpload:R,fileConflictShow:fe}=r,ce=m([]),{t:ve}=c(),me=m({total:0,done:0,time:0,speed:0,num:0}),ge=m(),xe=m(),ye=m([{key:"file",label:M(()=>ve("file.uploadFile"))},{key:"dir",label:M(()=>ve("file.uploadFolder"))}]);function be(e){"file"==e?he():xe.value.click()}function he(){ge.value.click()}function we(e){const l=e.target.files;if(l){let e=!1;for(let t=0;t<l.length;t++)-1==f.value.findIndex(e=>e.file.name==l[t].name)?f.value.push({relativePath:"",file:l[t],status:0,name:l[t].name,size:l[t].size,progress:0}):e=!0;e&&o.error(ve("file.uploadModal.fileAlreadyExists"),{close:!0})}ge.value.value=""}function _e(e){const l=e.target.files;if(l){let e=!1;for(let t=0;t<l.length;t++){let a=l[t].webkitRelativePath.split("/");a.pop(),-1==f.value.findIndex(e=>e.file.name==l[t].name)?f.value.push({relativePath:a.join("/"),file:l[t],name:l[t].name,status:0,size:l[t].size,progress:0}):e=!0}e&&o.error(ve("file.uploadModal.fileAlreadyExists"),{close:!0})}xe.value.value=""}function ke(){f.value=[]}function Me(e){switch(e){case 0:return ve("file.uploadModal.statusNotStarted");case 1:return ve("file.uploadModal.statusUploading");case 2:return ve("file.uploadModal.statusCompleted");case 3:return ve("file.uploadModal.statusFailed")}}async function Ce(){const e=f.value.map(e=>e.relativePath?N.value+"/"+e.relativePath+"/"+e.file.name:N.value+"/"+e.file.name),l=await async function(e){return(await n.post("/files?action=upload_files_exists",{files:e.join("\n")})).message.filter(e=>e.exists)}(e);0==l.length?await ze():(ce.value=l,fe.value=!0)}function je(){fe.value=!1,async function(){f.value=f.value.filter(e=>-1==ce.value.findIndex(l=>l.filename.includes(e.file.name))),f.value.length>0?await ze():Se()}()}function $e(){fe.value=!1,ze()}async function ze(){me.value.total=f.value.reduce((e,l)=>e+l.file.size,0),R.value=!0;const e=function(){let e=0;const l=setInterval(()=>{e++,me.value.time=e,me.value.speed=me.value.done/me.value.time,console.log(me.value)},1e3);return l}();for(let t=0;t<f.value.length;t++){f.value[t].status=1;try{await d(f.value[t].file,"/files?action=upload",1048576,N.value+"/"+f.value[t].relativePath,(e,l)=>{f.value[t].progress=e},e=>{isNaN(Number(e.message))||(me.value.done=Number(e.message))}),f.value[t].status=2,me.value.num+=1}catch(l){f.value[t].status=3,console.warn(l)}}clearInterval(e),L.value=!0,p(r),f.value=[]}function Se(){L.value=!1,R.value=!1,me.value={total:0,done:0,speed:0,num:0,time:0},f.value=[]}l({open(){F.value=!0},close(){F.value=!1}});const Pe=()=>{if(!L.value&&f.value.length>0)return u({title:ve("file.uploadModal.cancelUpload"),content:ve("file.uploadModal.cancelUploadConfirm"),onConfirm(){F.value=!1}}),!1},Fe=()=>{Se()};return(e,l)=>{const o=i,n=I,r=U,u=s,d=t;return y(),C(z,null,[g(d,{show:_(F),"onUpdate:show":l[0]||(l[0]=e=>k(F)?F.value=e:null),title:e.$t("file.uploadModal.title"),width:720,onPublicClose:Pe,onAfterLeave:Fe},{default:b(()=>[h("div",E,[h("input",{type:"file",style:{display:"none"},ref_key:"fileInputRef",ref:ge,onChange:we,multiple:""},null,544),h("input",{type:"file",style:{display:"none"},ref_key:"dirInputRef",ref:xe,onChange:_e,webkitdirectory:"",directory:"",multiple:""},null,544),_(R)&&0!=_(f).length?(y(),C("div",B,[h("div",H,[h("div",O,[h("div",D,w(e.$t("file.uploadModal.uploadSize")),1),h("div",V,w(`${_(a)(_(me).done)}/${_(a)(_(me).total)}`),1)]),h("div",W,[h("div",q,w(e.$t("file.uploadModal.averageSpeed")),1),h("div",G,w(_(a)(_(me).speed))+"/s",1)]),h("div",J,[h("div",K,w(e.$t("file.uploadModal.uploadSuccess")),1),h("div",Q,w(_(f).length)+" / "+w(_(me).num),1)]),_(L)?(y(),C("div",X,[h("div",Y,w(e.$t("file.uploadModal.totalTime")),1),h("div",Z,w(_(me).time)+"s",1)])):$("",!0)])])):(y(),C("div",T,[g(r,{options:_(ye),trigger:"hover",onSelect:be},{default:b(()=>[g(n,{type:"primary","icon-placement":"right",onClick:he},{icon:b(()=>[g(o,{name:"base-arrow-bottom",size:"14"})]),default:b(()=>[j(w(e.$t("file.uploadFile"))+" ",1)]),_:1})]),_:1},8,["options"]),g(n,{disabled:0==_(f).length,onClick:ke},{default:b(()=>[j(w(e.$t("Public.Btn.Clear")),1)]),_:1},8,["disabled"])])),_(f).length>0?(y(),C("div",ee,[h("div",le,[h("span",te,w(e.$t("file.uploadModal.fileName")),1),h("span",ae,w(e.$t("file.uploadModal.fileSize")),1),h("span",ie,w(e.$t("file.uploadModal.uploadStatus")),1),h("span",se,w(e.$t("file.uploadModal.operation")),1)]),g(u,{style:{height:"350px"}},{default:b(()=>[(y(!0),C(z,null,S(_(f),(l,t)=>(y(),C("div",{class:"list-item",key:t},[h("span",oe,w(l.relativePath?`${l.relativePath}/${l.file.name}`:l.file.name),1),h("span",ne,w(_(a)(l.file.size)),1),h("span",re,w(Me(l.status)),1),h("span",ue,[2!==l.status?(y(),x(n,{key:0,text:"",type:"primary",onClick:e=>function(e){f.value.splice(e,1)}(t)},{default:b(()=>[j(w(e.$t("Public.Btn.Cancel")),1)]),_:2},1032,["onClick"])):$("",!0)]),h("div",{class:"progress",style:P({width:`${l.progress}%`})},null,4)]))),128))]),_:1})])):(y(),C("div",de,[h("span",null,w(e.$t("file.uploadModal.dragFilesHere")),1)])),h("div",pe,[_(R)?(y(),x(n,{key:0,type:"primary",onClick:Se},{default:b(()=>[j(w(e.$t("file.uploadModal.continueUpload")),1)]),_:1})):(y(),x(n,{key:1,type:"primary",disabled:0==_(f).length,onClick:Ce},{default:b(()=>[j(w(e.$t("file.uploadModal.confirmUpload")),1)]),_:1},8,["disabled"]))])])]),_:1},8,["show","title"]),g(A,{"file-list":_(ce),onStep:je,onConfirm:$e},null,8,["file-list"])],64)}}}),[["__scopeId","data-v-70709f9b"]]))}}});
