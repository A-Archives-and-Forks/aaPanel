System.register(["./page_layout-legacy.js?v=1753954525509","./vue-legacy.js?v=1753954525509","./public-legacy.js?v=1753954525509","./file-legacy2.js?v=1753954525509","./naive-legacy.js?v=1753954525509","./common-legacy.js?v=1753954525509","./__commonjsHelpers__-legacy.js?v=1753954525509"],(function(e,t){"use strict";var a,n,l,o,s,i,r,p,d,c,u,f,m,g,h,x,b,y,_,v,w,C,U,z,F,k,j,M;return{setters:[e=>{a=e.ab,n=e.n,l=e.m,o=e.cl,s=e._,i=e.dQ,r=e.e},e=>{p=e.k,d=e.P,c=e.r,u=e.c,f=e.Q,m=e.j,g=e.U,h=e.V,x=e.W,b=e.a2,y=e.a3,_=e.X,v=e.ah,w=e.a1,C=e.au,U=e.al},e=>{z=e.h},e=>{F=e.b},e=>{k=e.bA,j=e.ay,M=e.c2},null,null],execute:function(){var t=document.createElement("style");t.textContent=".n-upload-dragger[data-v-86c45828]{height:360px;padding:10px}.n-upload-dragger[data-v-86c45828]:hover{--n-dragger-border-hover: 1px dashed #20a53a}.drag-text[data-v-86c45828]{margin-top:20px;font-size:16px}.drag-suffix[data-v-86c45828]{margin-top:12px;color:#777;font-size:14px}.n-data-table[data-v-86c45828]{--n-th-color-modal: transparent;--n-td-color-modal: transparent;--n-th-color-hover-modal: transparent;--n-td-color-hover-modal: transparent;--n-border-color-modal: transparent}\n",document.head.appendChild(t);const S={class:"p-16px"},$={class:"flex items-center mb-12px"},B={key:1,class:"flex-center flex-col h-300px"},D={class:"drag-text"},E={key:0,class:"drag-suffix"},P=p({__name:"index",props:{path:{default:""},size:{default:100},uploadData:{default:()=>({multiple:!1})},uploadSuccess:{},showSuccessMsg:{type:Boolean,default:!0}},emits:["setConfirm"],setup(e,{expose:t,emit:r}){const p=e,P=r,{path:A,uploadData:L}=p,{t:Q}=d(),H=a(),I=c([]),N=c(new Map),T=u((()=>(L.accept||"").split(",").map((e=>`'${e}'`)).join(", "))),V=e=>{const{file:t}=e;return(t.file?.size??0)>1048576*p.size?(l.error(Q("Component.UploadFile.index_7",[t.name,p.size])),!1):(L.multiple||(I.value=[]),!0)},W=c([{key:"name",title:Q("Component.UploadFile.index_3"),ellipsis:!0},{key:"size",title:Q("Component.UploadFile.index_4"),width:100,render:e=>n(e.file?.size)},{key:"status",title:Q("Component.UploadFile.index_5"),width:140,render:e=>{if("pending"===e.status)return Q("Component.UploadFile.index_8");if("finished"===e.status)return f("span",{class:"text-primary"},[Q("Component.UploadFile.index_9")]);if("error"===e.status)return f("span",{class:"text-error"},[m("Upload Failed")]);const t=e.percentage?e.percentage.toFixed(1):0;return f(k,{type:"line",color:H.value.primaryColor,"indicator-placement":"outside",processing:!0,percentage:Number(t)},null)}},z({width:70,options:(e,t)=>[{label:Q("Public.Btn.Del"),type:"error",show:"uploading"!==e.status,onClick:()=>I.value.splice(t,1)},{label:Q("Public.Btn.Cancel"),type:"warning",show:"uploading"===e.status,onClick:()=>(e=>{const t=e.id||e.name,a=N.value.get(t);a&&(a.abort(),N.value.delete(t),e.status="error",e.percentage=0,l.info(`Upload Canceled: ${e.name}`))})(e)}]})]),X=async(e,t,a,n)=>{const l=10485760,o=Math.ceil(e.size/l);let s=0;for(let i=0;i<o;i++){if(n.signal.aborted)throw new Error("Upload Canceled");const o=s,r=Math.min(e.size,o+l),p=e.slice(o,r),d=r-o,c=new FormData;c.append("f_path",A),c.append("f_name",t),c.append("f_size",e.size.toString()),c.append("f_start",o.toString()),c.append("blob",p);try{const t=await F(c,(t=>{if(n.signal.aborted)return;const l=(s+(t.progress||0)*d)/e.size*100;a(Math.min(l,99))}));let o=r;if(t&&"number"==typeof t.message&&(o=t.message),s=Math.max(s,o),a(Math.min(s/e.size*100,99)),s>=e.size)break;i=Math.floor(s/l)-1}catch{let e=!1;for(let t=0;t<3;t++){if(n.signal.aborted)throw new Error("Upload Canceled");try{await new Promise((e=>setTimeout(e,1e3)));const t=await F(c);if(t&&"number"==typeof t.message){s=t.message,e=!0;break}}catch{e=!1}}if(!e)throw new Error(`Chunk ${i+1} upload failed`)}}return a(100),!0};return t({onConfirm:async()=>{const e=I.value.filter((e=>"pending"===e.status));if(!e.length)return l.error(Q("Component.UploadFile.index_10")),!1;P("setConfirm",{disabled:!0}),e.forEach((e=>e.status="uploading"));let t=!0,a=!1;for(const o of e){const e=o.file;if(!e)continue;const n=new AbortController,s=o.id||o.name;N.value.set(s,n);try{if(e.size>52428800){if(!(await X(e,o.name,(e=>o.percentage=e),n))||n.signal.aborted){o.status="error",a=!0;continue}}else{const t=new FormData;t.append("f_path",A),t.append("f_name",o.name),t.append("f_start","0"),t.append("f_size",e.size.toString()),t.append("blob",e),await F(t,(e=>{n.signal.aborted||(o.percentage=100*(e.progress||0))}))}if(n.signal.aborted){o.status="error",a=!0;continue}o.status="finished"}catch{o.status="error",l.error(`${o.name} upload failed}`),t=!1}finally{N.value.delete(s)}}t&&!a&&p.showSuccessMsg&&e.filter((e=>"finished"===e.status)).length&&l.success(Q("Component.UploadFile.index_9")),P("setConfirm",{disabled:!1});const n=e.filter((e=>"finished"===e.status));return n.length&&await(p.uploadSuccess?.(n)),t&&!a}}),(e,t)=>{const a=j,n=o,l=M,r=s,p=i;return g(),h("div",S,[x("div",$,[f(n,{ref:"upload",class:"w-auto","file-list":_(I),"onUpdate:fileList":t[0]||(t[0]=e=>v(I)?I.value=e:null),accept:_(L).accept,multiple:_(L).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:V},{default:b((()=>[f(a,{type:"primary"},{default:b((()=>[m(y(e.$t("Component.UploadFile.index_6")),1)])),_:1})])),_:1},8,["file-list","accept","multiple"])]),f(n,{ref:"upload",class:"w-auto","file-list":_(I),"onUpdate:fileList":t[2]||(t[2]=e=>v(I)?I.value=e:null),accept:_(L).accept,multiple:_(L).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:V},{default:b((()=>[f(p,null,{default:b((()=>[_(I).length>0?(g(),w(l,{key:0,"max-height":300,bordered:!1,data:_(I),columns:_(W),onClick:t[1]||(t[1]=C((()=>{}),["stop"]))},null,8,["data","columns"])):(g(),h("div",B,[f(r,{name:"base-upload",size:"48",class:"text-#999"}),x("div",D,y(e.$t("Component.UploadFile.index_1")),1),_(L).accept?(g(),h("div",E,y(e.$t("Component.UploadFile.index_2",[_(T)])),1)):U("",!0)]))])),_:1})])),_:1},8,["file-list","accept","multiple"])])}}});e("default",r(P,[["__scopeId","data-v-86c45828"]]))}}}));
