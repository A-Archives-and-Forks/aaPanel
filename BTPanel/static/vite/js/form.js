import{_ as e}from"./index.vue_vue_type_script_setup_true_lang.js?v=1741416570306";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang20.js?v=1741416570306";import{_ as l}from"./index.vue_vue_type_script_setup_true_lang11.js?v=1741416570306";import{ax as t,H as u,u as n,b as s,G as r,bT as i}from"./page_layout.js?v=1741416570306";import{n as o,a as d,g as v}from"./alarm.js?v=1741416570306";import{d as m,P as p,Q as _,aq as c,ar as f,t as g,e as y,R as h,N as b,S as x,H as w,a0 as k,ao as j,F as U,$ as C,_ as A,c as E,L as $,a3 as M,M as P,Y as R,r as B,j as D,x as H,ae as S,n as O}from"./vue.js?v=1741416570306";import{ch as T,bS as F,cl as G,y as L,cg as Y,cf as q,cb as I}from"./naive.js?v=1741416570306";import{_ as N}from"./index95.js?v=1741416570306";import{_ as Q}from"./index195.js?v=1741416570306";import{c as z,e as J}from"./public.js?v=1741416570306";import"./common.js?v=1741416570306";import"./__commonjsHelpers__.js?v=1741416570306";const K=m({__name:"form-template-field-none",props:{field:{}},setup:e=>(e,a)=>(p(),_("div"))}),V={key:0,class:"ml-10px whitespace-pre"},W=m({__name:"form-template-field-select",props:c({field:{}},{value:{default:null},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=f(e,"value"),t=g(a,"field"),u=y((()=>t.value.items.map((e=>({label:"".concat(e.title).concat(t.value.unit||""),value:e.value})))));return(e,a)=>{const n=T;return p(),_(U,null,[h("div",{style:w({width:x(t).width?"160px":"260px"})},[b(n,{value:l.value,"onUpdate:value":a[0]||(a[0]=e=>l.value=e),disabled:x(t).disabled,options:x(u)},null,8,["value","disabled","options"])],4),x(t).suffix?(p(),_("div",V,k(x(t).suffix),1)):j("",!0)],64)}}}),X={key:0,class:"ml-10px whitespace-pre"},Z=m({__name:"form-template-field-number",props:c({field:{}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=g(e,"field"),l=f(e,"value"),t=()=>{l.value||(l.value=a.value.default)};return(e,u)=>{const n=F,s=G,r=L;return p(),_(U,null,[h("div",null,[b(r,null,{default:C((()=>[b(n,{value:l.value,"onUpdate:value":u[0]||(u[0]=e=>l.value=e),class:"w-100px",min:1,"show-button":!1,placeholder:"",onBlur:t},null,8,["value"]),x(a).unit?(p(),A(s,{key:0,class:"min-w-52px text-center"},{default:C((()=>[E(k(x(a).unit),1)])),_:1})):j("",!0)])),_:1})]),x(a).suffix?(p(),_("span",X,k(x(a).suffix),1)):j("",!0)],64)}}}),ee=m({__name:"form-template-field-radio",props:c({field:{}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=f(e,"value"),t=g(a,"field");return(e,a)=>{const u=Y,n=q;return p(),A(n,{value:l.value,"onUpdate:value":a[0]||(a[0]=e=>l.value=e)},{default:C((()=>[(p(!0),_(U,null,$(x(t).items,(e=>(p(),A(u,{key:e.value,value:e.value},{default:C((()=>[E(k(e.title),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])}}}),ae=m({__name:"form-template-field-help",props:{field:{}},setup:e=>(e,a)=>{const l=N;return p(),A(l,null,{default:C((()=>[(p(!0),_(U,null,$(e.field.list,(e=>(p(),_("li",{key:e},k(e),1)))),128))])),_:1})}}),le=m({__name:"form-template-field",props:c({field:{}},{value:{},valueModifiers:{}}),emits:c(["change"],["update:value"]),setup(e,{emit:a}){const l=e,t=a,u=f(e,"value"),n=g(l,"field"),s=(()=>{switch(n.value.type){case"select":return W;case"number":return Z;case"radio":return ee;case"help":return ae;default:return K}})(),r=e=>{t("change",e,n.value.attr)};return(e,a)=>(p(),A(M(x(s)),{value:u.value,"onUpdate:value":[a[0]||(a[0]=e=>u.value=e),r],field:x(n)},null,40,["value","field"]))}}),te=m({__name:"form-template",props:c({type:{default:"none"},template:{default:()=>({field:[],sorted:[]})}},{value:{default:()=>({})},valueModifiers:{}}),emits:["update:value"],setup(e,{expose:a}){const l=e,{t:n}=P(),s=g(l,"type"),r=g(l,"template"),i=f(e,"value"),o=y((()=>{const{field:e,sorted:a}=r.value,l=[];return a.forEach((a=>{const t=[];a.forEach((a=>{const l=e.find((e=>e.attr===a));l&&t.push(l)})),l.push(t)})),l})),d=(e,a)=>{"system_disk"===s.value&&"cycle"===a&&v(),"project_status"===s.value&&"cycle"===a&&m()},v=()=>{const{cycle:e}=i.value;switch(e){case 1:r.value.field[2].unit="GB",r.value.field[2].name=n("Config.Alarm.index_26");break;case 2:r.value.field[2].unit="%",r.value.field[2].name=n("Config.Alarm.index_27")}},m=()=>{const{field:e}=r.value,[,a]=e,{all_items:l}=a;if(l&&t(i.value.cycle)){const e=l[u(i.value.cycle)-1];e.length>0?(a.items=e,i.value.project=e[0].value):(a.items=[],i.value.project=null)}},c=()=>{switch(s.value){case"system_disk":v();break;case"project_status":m()}};return c(),a({render:c}),(e,a)=>{const l=I;return p(!0),_(U,null,$(x(o),((e,a)=>(p(),_(U,null,[1===e.length?(p(!0),_(U,{key:0},$(e,(e=>(p(),A(l,{key:"".concat(x(s),"-").concat(e.attr),label:e.name},{default:C((()=>[b(le,{value:i.value[e.attr],"onUpdate:value":a=>i.value[e.attr]=a,field:e,onChange:d},null,8,["value","onUpdate:value","field"])])),_:2},1032,["label"])))),128)):j("",!0),e.length>1?(p(),_("div",{key:"".concat(x(s),"-").concat(a+1),class:"flex"},[(p(!0),_(U,null,$(e,((e,a)=>(p(),A(l,{key:"".concat(x(s),"-").concat(e.attr),label:e.name,"label-width":0!==a?"auto":void 0},{default:C((()=>[b(le,{value:i.value[e.attr],"onUpdate:value":a=>i.value[e.attr]=a,field:e,onChange:d},null,8,["value","onUpdate:value","field"])])),_:2},1032,["label","label-width"])))),128))])):j("",!0)],64)))),256)}}}),ue=m({__name:"form-advanced",props:c({config:{default:()=>({})},inverse:{type:Boolean,default:!1},timeRangeShow:{type:Boolean,default:!1}},{value:{default:()=>({day_num:0,total:0,send_interval:0,time_range:[]})},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=g(a,"config"),t=f(e,"value"),u=e=>a.inverse?!l.value[e]:l.value[e];return(e,a)=>{const l=F,n=G,s=L,r=I,i=Q;return p(),_(U,null,[u("day_num")?(p(),A(r,{key:0,label:e.$t("Config.Alarm.index_28"),path:"day_num"},{default:C((()=>[b(s,null,{default:C((()=>[b(l,{value:t.value.day_num,"onUpdate:value":a[0]||(a[0]=e=>t.value.day_num=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),b(n,{class:"min-w-52px text-center"},{default:C((()=>[E(k(e.$t("Public.Unit.Times")),1)])),_:1})])),_:1})])),_:1},8,["label"])):j("",!0),u("total")?(p(),A(r,{key:1,label:e.$t("Config.Alarm.index_30"),path:"total"},{default:C((()=>[b(s,null,{default:C((()=>[b(l,{value:t.value.total,"onUpdate:value":a[1]||(a[1]=e=>t.value.total=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),b(n,{class:"min-w-52px text-center"},{default:C((()=>[E(k(e.$t("Public.Unit.Times")),1)])),_:1})])),_:1})])),_:1},8,["label"])):j("",!0),u("send_interval")?(p(),A(r,{key:2,label:e.$t("Config.Alarm.index_31"),path:"send_interval"},{default:C((()=>[b(s,null,{default:C((()=>[b(l,{value:t.value.send_interval,"onUpdate:value":a[2]||(a[2]=e=>t.value.send_interval=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),b(n,{class:"min-w-52px text-center"},{default:C((()=>[E(k(e.$t("Public.Unit.Seconds")),1)])),_:1})])),_:1})])),_:1},8,["label"])):j("",!0),e.timeRangeShow?(p(),A(r,{key:3,label:e.$t("Config.Alarm.index_33"),path:"time_range","show-feedback":!1},{default:C((()=>[b(i,{value:t.value.time_range,"onUpdate:value":a[3]||(a[3]=e=>t.value.time_range=e)},null,8,["value"])])),_:1},8,["label"])):j("",!0)],64)}}}),ne={class:"px-20px py-24px"},se={class:"w-260px"},re={class:"w-260px"},ie=m({__name:"form",props:{isEdit:{type:Boolean},row:{}},emits:["refresh"],setup(u,{expose:m,emit:c}){const f=u,w=n(),{isPro:k}=R(w),j=c,{t:U}=P(),A=g(f,"isEdit"),$=B(null),M=B(),F=B(!1),G=D({type:null,method:[],day_num:0,total:0,send_interval:0,time_range:[(new Date).setHours(0,0,0,0),(new Date).setHours(23,59,59,0)],template:{}}),L=D({day_num:{trigger:["input","blur"],validator:()=>!(!G.day_num&&0!==G.day_num)||(V.value.day_num||(F.value=!0),new Error(U("Config.Alarm.index_22")))},total:{trigger:["input","blur"],validator:()=>!(!G.total&&0!==G.total)||(V.value.total||(F.value=!0),new Error(U("Config.Alarm.index_23")))},send_interval:{trigger:["input","blur"],validator:()=>!(!G.send_interval&&0!==G.send_interval)||(V.value.send_interval||(F.value=!0),new Error(U("Config.Alarm.index_24")))},method:{trigger:["change"],validator:()=>0!==G.method.length||new Error(U("Config.Alarm.index_25"))}}),Y=H([]),q=y((()=>Y.value.map(((e,a)=>({label:e.title,value:a,disabled:"80"===e.id&&!k.value,data:e}))))),N=y((()=>{let e="none";const a=Y.value[G.type||0];return a&&(e=a.source),e})),Q=e=>b("div",null,[b("span",null,[e.label,E(" ")]),14===e.value?b("span",{class:"float-right cursor-pointer color-#ffb800",onClick:()=>{J({source:323})}},[E("PRO")]):""]),K=B({field:[],sorted:[]}),V=B({}),W=()=>Y.value[G.type||0],X=()=>{const e=W();K.value=e.template,K.value.field.forEach((a=>{a.default?G.template[a.attr]=a.default:G.template[a.attr]=e.default[a.attr]})),G.day_num=0,G.total=0,G.send_interval=0;const a={},{advanced_default:l}=e;s(l)&&Object.entries(l).forEach((([e,l])=>{s(l)?Object.entries(l).forEach((([e,l])=>{a[e]=!0,ee(e,l)})):t(l)&&(a[e]=!0,ee(e,l))})),V.value=a},Z=["day_num","total","send_interval"],ee=(e,a)=>{Z.includes(e)&&(G[e]=a)},ae=()=>{X(),O((()=>{M.value.render()}))},{loading:le,setLoading:ie}=z(),oe=e=>{const a=new Date,l=a.getFullYear(),t=a.getMonth(),u=a.getDate();return new Date(l,t,u).getTime()+1e3*e};return(async()=>{await(async()=>{try{ie(!0);const{message:e}=await v();r(e)&&(Y.value=e,G.type=0,A.value||X())}finally{ie(!1)}})();const{row:e}=f;A.value&&e&&(G.type=Y.value.findIndex((a=>a.id===e.template_id)),X(),G.method=e.sender,e.number_rule&&(G.day_num=e.number_rule.day_num,G.total=e.number_rule.total),e.time_rule&&(G.send_interval=e.time_rule.send_interval,e.time_rule.time_range&&e.time_rule.time_range.length>0&&(G.time_range=[oe(e.time_rule.time_range[0]),oe(e.time_rule.time_range[1])])),Object.keys(G.template).forEach((a=>{e.task_data&&(G.template[a]=e.task_data[a])})),await O(),M.value.render())})(),m({onConfirm:async()=>{var e;await(null==(e=$.value)?void 0:e.validate());const{row:a}=f,l=(()=>{const e=W();return{template_id:e.id,task_data:{task_data:{tid:e.id,type:e.source,title:e.title,status:!0,count:0,interval:600,project:"",...G.template},sender:G.method,number_rule:{day_num:G.day_num,total:G.total},time_rule:{send_interval:G.send_interval,time_range:[i(G.time_range[0]),i(G.time_range[1])]}}}})();A.value&&a?await o({...l,task_id:a.id}):await d(l),j("refresh")}}),(t,u)=>{const n=T,s=I,r=l,i=a,o=e;return p(),_("div",ne,[b(o,{ref_key:"formRef",ref:$,model:x(G),rules:x(L),"label-width":"140"},{default:C((()=>[b(s,{label:t.$t("Config.Alarm.index_19")},{default:C((()=>[h("div",se,[b(n,{value:x(G).type,"onUpdate:value":[u[0]||(u[0]=e=>x(G).type=e),ae],options:x(q),loading:x(le),"render-label":Q},null,8,["value","options","loading"])])])),_:1},8,["label"]),b(te,{ref_key:"templateRef",ref:M,value:x(G).template,"onUpdate:value":u[1]||(u[1]=e=>x(G).template=e),type:x(N),template:x(K)},null,8,["value","type","template"]),b(ue,{value:x(G),"onUpdate:value":u[2]||(u[2]=e=>S(G)?G.value=e:null),config:x(V)},null,8,["value","config"]),b(s,{label:t.$t("Config.Alarm.index_20"),path:"method"},{default:C((()=>[h("div",re,[b(r,{value:x(G).method,"onUpdate:value":u[3]||(u[3]=e=>x(G).method=e)},null,8,["value"])])])),_:1},8,["label"]),b(i,{show:x(F),"onUpdate:show":u[5]||(u[5]=e=>S(F)?F.value=e:null),title:t.$t("Config.Alarm.index_21")},{default:C((()=>[b(ue,{value:x(G),"onUpdate:value":u[4]||(u[4]=e=>S(G)?G.value=e:null),config:x(V),inverse:!0,"time-range-show":!0},null,8,["value","config"])])),_:1},8,["show","title"])])),_:1},8,["model","rules"])])}}});export{ie as default};
