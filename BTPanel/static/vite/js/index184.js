import{al as e,h as a,m as l,bX as t,_ as s,eG as i,k as o}from"./page_layout.js?v=1741416570306";import{d as n,M as p,r as d,e as r,N as u,P as c,Q as m,R as f,$ as _,c as x,a0 as h,S as v,ae as g,_ as C,an as U}from"./vue.js?v=1741416570306";import{f as y}from"./public.js?v=1741416570306";import{u as w}from"./file.js?v=1741416570306";import{bt as b,T as F,cn as j}from"./naive.js?v=1741416570306";import"./common.js?v=1741416570306";import"./__commonjsHelpers__.js?v=1741416570306";const k={class:"p-16px"},z={class:"flex items-center mb-12px"},S={key:1,class:"flex-center flex-col h-300px"},B={class:"drag-text"},D={class:"drag-suffix"},$=o(n({__name:"index",props:{path:{default:""},size:{default:100},uploadData:{default:()=>({multiple:!1})},uploadSuccess:{},showSuccessMsg:{type:Boolean,default:!0}},emits:["setConfirm"],setup(o,{expose:n,emit:$}){const M=o,L=$,{path:P,uploadData:E}=M,{t:G}=p(),H=e(),I=d([]),N=r((()=>(E.accept||"").split(",").map((e=>"'".concat(e,"'"))).join(", "))),Q=e=>{var a,t;const{file:s}=e,{size:i}=M;return(null!=(t=null==(a=s.file)?void 0:a.size)?t:0)>1048576*i?(l.error(G("Component.UploadFile.index_7",[s.name,i])),!1):(E.multiple||(I.value=[]),!0)},R=d([{key:"name",title:G("Component.UploadFile.index_3"),ellipsis:!0},{key:"size",title:G("Component.UploadFile.index_4"),width:100,render:e=>{var l;return a(null==(l=e.file)?void 0:l.size)}},{key:"status",title:G("Component.UploadFile.index_5"),width:140,render:e=>"pending"===e.status?G("Component.UploadFile.index_8"):"finished"===e.status?u("span",{class:"text-primary"},[G("Component.UploadFile.index_9")]):u(b,{type:"line",color:H.value.primaryColor,"indicator-placement":"outside",processing:!0,percentage:e.percentage||0},null)},y({width:70,options:(e,a)=>[{label:G("Public.Btn.Del"),type:"error",show:"uploading"!==e.status,onClick:()=>{I.value.splice(a,1)}}]})]);return n({onConfirm:async()=>{var e;const a=I.value.filter((e=>"pending"===e.status));if(0===a.length)return l.error(G("Component.UploadFile.index_10")),!1;L("setConfirm",{disabled:!0}),a.forEach((e=>{e.status="uploading"}));for(let l of a){const e=new FormData;e.append("f_path",P),e.append("f_name",l.name),e.append("f_start","0"),l.file&&(e.append("f_size",l.file.size.toString()),e.append("blob",l.file)),await w(e,(e=>{l.percentage=100*(e.progress||0)})),l.status="finished"}M.showSuccessMsg&&l.success(G("Component.UploadFile.index_9")),L("setConfirm",{disabled:!1}),await(null==(e=M.uploadSuccess)?void 0:e.call(M,a))}}),(e,a)=>{const l=F,o=t,n=j,p=s,d=i;return c(),m("div",k,[f("div",z,[u(o,{ref:"upload",class:"w-auto","file-list":v(I),"onUpdate:fileList":a[0]||(a[0]=e=>g(I)?I.value=e:null),accept:v(E).accept,multiple:v(E).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:Q},{default:_((()=>[u(l,{type:"primary"},{default:_((()=>[x(h(e.$t("Component.UploadFile.index_6")),1)])),_:1})])),_:1},8,["file-list","accept","multiple"])]),u(o,{ref:"upload",class:"w-auto","file-list":v(I),"onUpdate:fileList":a[2]||(a[2]=e=>g(I)?I.value=e:null),accept:v(E).accept,multiple:v(E).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:Q},{default:_((()=>[u(d,null,{default:_((()=>[v(I).length>0?(c(),C(n,{key:0,"max-height":300,bordered:!1,data:v(I),columns:v(R),onClick:a[1]||(a[1]=U((()=>{}),["stop"]))},null,8,["data","columns"])):(c(),m("div",S,[u(p,{name:"base-upload",size:"48",class:"text-#999"}),f("div",B,h(e.$t("Component.UploadFile.index_1")),1),f("div",D,h(e.$t("Component.UploadFile.index_2",[v(N)])),1)]))])),_:1})])),_:1},8,["file-list","accept","multiple"])])}}}),[["__scopeId","data-v-d0ef0c12"]]);export{$ as default};
