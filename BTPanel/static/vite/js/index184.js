import{aj as e,n as a,m as l,cC as t,_ as s,fP as i,p as o}from"./page_layout.js?v=1749179669910";import{d as n,O as p,r as d,e as r,P as u,R as c,S as m,U as f,a1 as _,c as x,a2 as v,V as h,aj as C,a0 as g,at as U}from"./vue.js?v=1749179669910";import{f as y}from"./public.js?v=1749179669910";import{u as w}from"./file.js?v=1749179669910";import{bz as b,T as F,bZ as j}from"./naive.js?v=1749179669910";import"./common.js?v=1749179669910";import"./__commonjsHelpers__.js?v=1749179669910";const z={class:"p-16px"},k={class:"flex items-center mb-12px"},S={key:1,class:"flex-center flex-col h-300px"},B={class:"drag-text"},D={class:"drag-suffix"},P=o(n({__name:"index",props:{path:{default:""},size:{default:100},uploadData:{default:()=>({multiple:!1})},uploadSuccess:{},showSuccessMsg:{type:Boolean,default:!0}},emits:["setConfirm"],setup(o,{expose:n,emit:P}){const $=o,L=P,{path:M,uploadData:E}=$,{t:H}=p(),I=e(),O=d([]),R=r((()=>(E.accept||"").split(",").map((e=>"'".concat(e,"'"))).join(", "))),T=e=>{var a,t;const{file:s}=e,{size:i}=$;return(null!=(t=null==(a=s.file)?void 0:a.size)?t:0)>1048576*i?(l.error(H("Component.UploadFile.index_7",[s.name,i])),!1):(E.multiple||(O.value=[]),!0)},V=d([{key:"name",title:H("Component.UploadFile.index_3"),ellipsis:!0},{key:"size",title:H("Component.UploadFile.index_4"),width:100,render:e=>{var l;return a(null==(l=e.file)?void 0:l.size)}},{key:"status",title:H("Component.UploadFile.index_5"),width:140,render:e=>"pending"===e.status?H("Component.UploadFile.index_8"):"finished"===e.status?u("span",{class:"text-primary"},[H("Component.UploadFile.index_9")]):u(b,{type:"line",color:I.value.primaryColor,"indicator-placement":"outside",processing:!0,percentage:e.percentage||0},null)},y({width:70,options:(e,a)=>[{label:H("Public.Btn.Del"),type:"error",show:"uploading"!==e.status,onClick:()=>{O.value.splice(a,1)}}]})]);return n({onConfirm:async()=>{var e;const a=O.value.filter((e=>"pending"===e.status));if(0===a.length)return l.error(H("Component.UploadFile.index_10")),!1;L("setConfirm",{disabled:!0}),a.forEach((e=>{e.status="uploading"}));for(let l of a){const e=new FormData;e.append("f_path",M),e.append("f_name",l.name),e.append("f_start","0"),l.file&&(e.append("f_size",l.file.size.toString()),e.append("blob",l.file)),await w(e,(e=>{l.percentage=100*(e.progress||0)})),l.status="finished"}$.showSuccessMsg&&l.success(H("Component.UploadFile.index_9")),L("setConfirm",{disabled:!1}),await(null==(e=$.uploadSuccess)?void 0:e.call($,a))}}),(e,a)=>{const l=F,o=t,n=j,p=s,d=i;return c(),m("div",z,[f("div",k,[u(o,{ref:"upload",class:"w-auto","file-list":h(O),"onUpdate:fileList":a[0]||(a[0]=e=>C(O)?O.value=e:null),accept:h(E).accept,multiple:h(E).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:T},{default:_((()=>[u(l,{type:"primary"},{default:_((()=>[x(v(e.$t("Component.UploadFile.index_6")),1)])),_:1})])),_:1},8,["file-list","accept","multiple"])]),u(o,{ref:"upload",class:"w-auto","file-list":h(O),"onUpdate:fileList":a[2]||(a[2]=e=>C(O)?O.value=e:null),accept:h(E).accept,multiple:h(E).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:T},{default:_((()=>[u(d,null,{default:_((()=>[h(O).length>0?(c(),g(n,{key:0,"max-height":300,bordered:!1,data:h(O),columns:h(V),onClick:a[1]||(a[1]=U((()=>{}),["stop"]))},null,8,["data","columns"])):(c(),m("div",S,[u(p,{name:"base-upload",size:"48",class:"text-#999"}),f("div",B,v(e.$t("Component.UploadFile.index_1")),1),f("div",D,v(e.$t("Component.UploadFile.index_2",[h(R)])),1)]))])),_:1})])),_:1},8,["file-list","accept","multiple"])])}}}),[["__scopeId","data-v-d0ef0c12"]]);export{P as default};
