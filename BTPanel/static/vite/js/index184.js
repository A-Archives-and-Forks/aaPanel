import{aq as e,h as a,m as l,cH as t,_ as s,fq as i,k as o}from"./page_layout.js?v=1744703330658";import{d as n,O as p,r as d,e as r,P as u,R as c,S as f,U as m,a0 as _,c as x,a1 as h,V as v,af as g,$ as C,ao as U}from"./vue.js?v=1744703330658";import{f as y}from"./public.js?v=1744703330658";import{u as w}from"./file.js?v=1744703330658";import{bz as F,T as b,ct as j}from"./naive.js?v=1744703330658";import"./common.js?v=1744703330658";import"./__commonjsHelpers__.js?v=1744703330658";const z={class:"p-16px"},k={class:"flex items-center mb-12px"},S={key:1,class:"flex-center flex-col h-300px"},B={class:"drag-text"},D={class:"drag-suffix"},$=o(n({__name:"index",props:{path:{default:""},size:{default:100},uploadData:{default:()=>({multiple:!1})},uploadSuccess:{},showSuccessMsg:{type:Boolean,default:!0}},emits:["setConfirm"],setup(o,{expose:n,emit:$}){const q=o,H=$,{path:L,uploadData:M}=q,{t:P}=p(),E=e(),I=d([]),O=r((()=>(M.accept||"").split(",").map((e=>"'".concat(e,"'"))).join(", "))),R=e=>{var a,t;const{file:s}=e,{size:i}=q;return(null!=(t=null==(a=s.file)?void 0:a.size)?t:0)>1048576*i?(l.error(P("Component.UploadFile.index_7",[s.name,i])),!1):(M.multiple||(I.value=[]),!0)},T=d([{key:"name",title:P("Component.UploadFile.index_3"),ellipsis:!0},{key:"size",title:P("Component.UploadFile.index_4"),width:100,render:e=>{var l;return a(null==(l=e.file)?void 0:l.size)}},{key:"status",title:P("Component.UploadFile.index_5"),width:140,render:e=>"pending"===e.status?P("Component.UploadFile.index_8"):"finished"===e.status?u("span",{class:"text-primary"},[P("Component.UploadFile.index_9")]):u(F,{type:"line",color:E.value.primaryColor,"indicator-placement":"outside",processing:!0,percentage:e.percentage||0},null)},y({width:70,options:(e,a)=>[{label:P("Public.Btn.Del"),type:"error",show:"uploading"!==e.status,onClick:()=>{I.value.splice(a,1)}}]})]);return n({onConfirm:async()=>{var e;const a=I.value.filter((e=>"pending"===e.status));if(0===a.length)return l.error(P("Component.UploadFile.index_10")),!1;H("setConfirm",{disabled:!0}),a.forEach((e=>{e.status="uploading"}));for(let l of a){const e=new FormData;e.append("f_path",L),e.append("f_name",l.name),e.append("f_start","0"),l.file&&(e.append("f_size",l.file.size.toString()),e.append("blob",l.file)),await w(e,(e=>{l.percentage=100*(e.progress||0)})),l.status="finished"}q.showSuccessMsg&&l.success(P("Component.UploadFile.index_9")),H("setConfirm",{disabled:!1}),await(null==(e=q.uploadSuccess)?void 0:e.call(q,a))}}),(e,a)=>{const l=b,o=t,n=j,p=s,d=i;return c(),f("div",z,[m("div",k,[u(o,{ref:"upload",class:"w-auto","file-list":v(I),"onUpdate:fileList":a[0]||(a[0]=e=>g(I)?I.value=e:null),accept:v(M).accept,multiple:v(M).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:R},{default:_((()=>[u(l,{type:"primary"},{default:_((()=>[x(h(e.$t("Component.UploadFile.index_6")),1)])),_:1})])),_:1},8,["file-list","accept","multiple"])]),u(o,{ref:"upload",class:"w-auto","file-list":v(I),"onUpdate:fileList":a[2]||(a[2]=e=>g(I)?I.value=e:null),accept:v(M).accept,multiple:v(M).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:R},{default:_((()=>[u(d,null,{default:_((()=>[v(I).length>0?(c(),C(n,{key:0,"max-height":300,bordered:!1,data:v(I),columns:v(T),onClick:a[1]||(a[1]=U((()=>{}),["stop"]))},null,8,["data","columns"])):(c(),f("div",S,[u(p,{name:"base-upload",size:"48",class:"text-#999"}),m("div",B,h(e.$t("Component.UploadFile.index_1")),1),m("div",D,h(e.$t("Component.UploadFile.index_2",[v(O)])),1)]))])),_:1})])),_:1},8,["file-list","accept","multiple"])])}}}),[["__scopeId","data-v-d0ef0c12"]]);export{$ as default};
