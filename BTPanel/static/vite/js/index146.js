import{_ as e}from"./index226.js?v=1742891699271";import{_ as a}from"./index95.js?v=1742891699271";import{_ as n,a as t}from"./index.vue_vue_type_script_setup_true_lang21.js?v=1742891699271";import{d as s,R as l,S as i,P as o,a1 as _,U as u,a2 as r,F as c,O as d,V as f,c as p,a0 as b,r as m,af as y,j as x,N as h}from"./vue.js?v=1742891699271";import{_ as g}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1742891699271";import{e7 as z,e8 as v,e9 as k,cy as w,ea as q,b as P,l as M,W as j,h as B,eb as N,aa as S,ab as I,K as C,ec as $,ed as T,ee as U,ef as F,I as L,eg as G,eh as R}from"./page_layout.js?v=1742891699271";import{g as K,m as O,p as Q}from"./soft.js?v=1742891699271";import{a as A,c as D,b as E,f as H,w as J}from"./public.js?v=1742891699271";import{T as V,bU as W,bY as Y,b$ as X,cn as Z}from"./naive.js?v=1742891699271";import{s as ee}from"./php.js?v=1742891699271";import{_ as ae}from"./index.vue_vue_type_script_setup_true_lang6.js?v=1742891699271";import{_ as ne}from"./index96.js?v=1742891699271";import{_ as te}from"./index103.js?v=1742891699271";import{o as se}from"./logs.js?v=1742891699271";import{b as le}from"./file.js?v=1742891699271";import"./alarm.js?v=1742891699271";import"./index.vue_vue_type_script_setup_true_lang.js?v=1742891699271";import"./index.vue_vue_type_script_setup_true_lang11.js?v=1742891699271";import"./index.vue_vue_type_script_setup_true_lang15.js?v=1742891699271";import"./theme-chrome.js?v=1742891699271";import"./__commonjsHelpers__.js?v=1742891699271";import"./common.js?v=1742891699271";const ie=s({__name:"index",setup:e=>(e,t)=>{const s=a;return l(),i(c,null,[o(n),o(s,{class:"mt-10px"},{default:_((()=>[u("li",null,r(e.$t("Plugin.Mysql.index_25")),1)])),_:1})],64)}}),oe=s({__name:"index",setup(e,{expose:n}){const{t:t}=d(),s=()=>{A({title:t("Plugin.Mysql.index_16"),content:t("Plugin.Mysql.index_17",[O.datadir]),onConfirm:async()=>{await z({datadir:O.datadir})}})};return K(),n({init:K}),(e,n)=>{const t=g,d=V,b=W,m=a;return l(),i(c,null,[o(b,null,{default:_((()=>[o(t,{value:f(O).datadir,"onUpdate:value":n[0]||(n[0]=e=>f(O).datadir=e),class:"w-300px"},null,8,["value"]),o(d,{type:"primary",onClick:s},{default:_((()=>[p(r(e.$t("Plugin.Mysql.index_13")),1)])),_:1})])),_:1}),o(m,{class:"mt-10px"},{default:_((()=>[u("li",null,r(e.$t("Plugin.Mysql.index_14")),1),u("li",null,r(e.$t("Plugin.Mysql.index_15")),1)])),_:1})],64)}}}),_e=s({__name:"index",setup(e,{expose:a}){const n=async()=>{await v({port:O.port})};return K(),a({init:K}),(e,a)=>{const t=Y,s=V,i=W;return l(),b(i,null,{default:_((()=>[o(t,{class:"w-100px!","show-button":!1,value:f(O).port,"onUpdate:value":a[0]||(a[0]=e=>f(O).port=e),placeholder:e.$t("Site.TableRow.index_16")},null,8,["value","placeholder"]),o(s,{type:"primary",onClick:n},{default:_((()=>[p(r(e.$t("Public.Btn.Conf")),1)])),_:1})])),_:1})}}}),ue=s({__name:"index",setup(e,{expose:n}){const{t:t}=d(),s=m(!1),b=async()=>{try{await k()}catch(e){s.value=!s.value}},x=()=>{A({title:t("Plugin.Mysql.index_22",[Q.title]),content:t("Plugin.Mysql.index_24",[Q.title]),onConfirm:async()=>{await ee({name:"mysqld",type:"restart"})}})},h=()=>{w(encodeURIComponent("/www/server/data/ssl.zip"))},{loading:g,setLoading:z}=D(),v=async()=>{try{z(!0);const{message:e}=await q();P(e)&&(s.value=e.status)}finally{z(!1)}};return v(),n({init:v}),(e,n)=>{const t=X,d=V,m=W,z=M,v=a;return l(),i(c,null,[o(m,{class:"items-center"},{default:_((()=>[u("span",null,r(e.$t("Plugin.Mysql.index_30"))+" Mysql SSL",1),o(t,{value:f(s),"onUpdate:value":[n[0]||(n[0]=e=>y(s)?s.value=e:null),b],loading:f(g)},null,8,["value","loading"]),o(d,{onClick:x,type:"primary"},{default:_((()=>[p(r(e.$t("Plugin.Mysql.index_22",[f(Q).title])),1)])),_:1})])),_:1}),o(z,{class:"my-16px!"}),o(v,{class:"mb-16px"},{default:_((()=>[u("li",null,r(e.$t("Database.Mysql.index_27")),1),u("li",null,[p(r(e.$t("Database.Mysql.index_28"))+" ",1),u("a",{class:"bt-link",onClick:h},"【SSL.zip】")])])),_:1})],64)}}}),re=[{label:"Launch Time",value:"Run",isTime:!0},{label:"Total Connections",value:"Connections"},{label:"Send",value:"Bytes_sent",isSize:!0},{label:"Receive",value:"Bytes_received",isSize:!0},{label:"Query per second",value:"query"},{label:"Transaction per second",value:"transaction"},{label:"File",value:"File"},{label:"Position",value:"Position"}],ce=[{name:"Active/Max connections",function:e=>e.Threads_running+"/"+e.Max_used_connections,value:"",ps:"If too high, increase max_connections"},{name:"Thread cache hit rate",value:"",function:e=>{const a=(100*(1-Number(e.Threads_created)/Number(e.Connections))).toFixed(2);return a?a+"%":"0"},ps:"If too low, increase thread_cache_size"},{value:"",name:"Index hit rate",function:e=>{const a=Number(e.Key_reads),n=Number(e.Key_read_requests);return(n>0?(100*(1-a/n)).toFixed(2):"0.00")+"%"},ps:"If too low, increase key_buffer_size"},{value:"",name:"Innodb index hit rate",function:e=>{const a=(100*(1-Number(e.Innodb_buffer_pool_reads)/Number(e.Innodb_buffer_pool_read_requests))).toFixed(2);return a||"0"},ps:"If too low, increase innodb_buffer_pool_size"},{value:"",name:"Query cache hit rate",function:e=>{let a=(parseInt(e.Qcache_hits)/(parseInt(e.Qcache_hits)+parseInt(e.Qcache_inserts))*100).toFixed(2)+"%";return"NaN%"==a&&(a="OFF"),a},ps:"If too low, increase query_cache_size"},{value:"",name:"Created temporary tables to disk",function:e=>{const a=(Number(e.Created_tmp_disk_tables)/Number(e.Created_tmp_tables)*100).toFixed(2);return a?a+"%":"0"},ps:"If too high, increase tmp_table_size"},{value:"",name:"Opened table",function:e=>e.Open_tables,ps:"If too high, increase table_open_cache"},{value:"",name:"Amount unindexed",function:e=>e.Select_full_join,ps:"If not 0, please check index of database table"},{value:"",name:"Amount unindexed in table join",function:e=>e.Select_range_check,ps:"If not 0, please check index of database table"},{value:"",name:"Number of merges after sorting",function:e=>e.Sort_merge_passes,ps:"If too high, increase sort_buffer_size"},{value:"",name:"Number of lock tables",function:e=>e.Table_locks_waited,ps:"If too high, consider increase your database performance"}],de=s({__name:"index",setup(e,{expose:a}){const{t:n}=d(),t=x({}),{table:s,columns:u}=E([{title:n("Plugin.Apache.index_12"),key:"name",width:"30%"},{title:n("Plugin.Apache.index_13"),key:"value",width:"20%"},{title:n("Public.Table.Note"),key:"ps",ellipsis:{tooltip:!0}}]),m=e=>{if("query"===e.value)return parseInt((Number(t.Questions)/Number(t.Uptime)).toString());if("transaction"===e.value)return parseInt(((parseInt(t.Com_commit)+parseInt(t.Com_rollback))/Number(t.Uptime)).toString());const a=t[e.value];return void 0===a?"--":e.isTime?j(a):e.isSize?B(a):a},{loading:y,setLoading:g}=D(),z=async()=>{try{g(!0);const{message:e}=await N();P(e)&&(Object.assign(t,e),ce.forEach((e=>{e.function&&(e.value=e.function(t))})),s.data=ce)}finally{g(!1)}};return z(),a({init:z}),(e,a)=>{const n=S,t=I,d=C,x=ae;return l(),i(c,null,[o(d,{show:f(y)},{default:_((()=>[o(t,{"label-placement":"left",bordered:"",column:2},{default:_((()=>[(l(!0),i(c,null,h(f(re),(e=>(l(),b(n,{label:e.label,key:e.value},{default:_((()=>[p(r(m(e)),1)])),_:2},1032,["label"])))),128))])),_:1})])),_:1},8,["show"]),o(x,{class:"mt-10px",loading:f(y),data:f(s).data,columns:f(u)},null,8,["loading","data","columns"])],64)}}}),fe=[{label:"1-2GB",value:"1-2GB",data:{key_buffer_size:32,query_cache_size:32,tmp_table_size:32,innodb_buffer_pool_size:64,sort_buffer_size:256,read_buffer_size:256,read_rnd_buffer_size:256,join_buffer_size:512,thread_stack:256,binlog_cache_size:64,thread_cache_size:64,table_open_cache:128,max_connections:100}},{label:"2-4GB",value:"2-4GB",data:{key_buffer_size:64,query_cache_size:64,tmp_table_size:64,innodb_buffer_pool_size:128,sort_buffer_size:512,read_buffer_size:512,read_rnd_buffer_size:512,join_buffer_size:1024,thread_stack:256,binlog_cache_size:64,thread_cache_size:96,table_open_cache:192,max_connections:200}},{label:"4-8GB",value:"4-8GB",data:{key_buffer_size:128,query_cache_size:128,tmp_table_size:128,innodb_buffer_pool_size:256,sort_buffer_size:1024,read_buffer_size:1024,read_rnd_buffer_size:768,join_buffer_size:2048,thread_stack:256,binlog_cache_size:128,thread_cache_size:128,table_open_cache:384,max_connections:300}},{label:"8-16GB",value:"8-16GB",data:{key_buffer_size:256,query_cache_size:256,tmp_table_size:256,innodb_buffer_pool_size:512,sort_buffer_size:1024,read_buffer_size:2048,read_rnd_buffer_size:1024,join_buffer_size:2048,thread_stack:384,binlog_cache_size:192,thread_cache_size:192,table_open_cache:1024,max_connections:400}},{label:"16-32GB",value:"16-32GB",data:{key_buffer_size:1024,query_cache_size:384,tmp_table_size:1024,innodb_buffer_pool_size:1024,sort_buffer_size:4096,read_buffer_size:4096,read_rnd_buffer_size:2048,join_buffer_size:4096,thread_stack:512,binlog_cache_size:256,thread_cache_size:256,table_open_cache:2048,max_connections:500}}],pe={key_buffer_size:"MB, Buffer size for indexing",query_cache_size:"MB, Query cache, set to 0 for not enabled",tmp_table_size:"MB, Temporary table cache size",innodb_buffer_pool_size:"MB, Innodb buffer size",innodb_log_buffer_size:"MB, Innodb log buffer size",sort_buffer_size:"KB * Num of connections, Buffer size per thread sort",read_buffer_size:"KB * Num of connections, Read buffer size",read_rnd_buffer_size:"KB * Num of connections, Random read buffer size",join_buffer_size:"KB * Num of connections, Join table buffer size",thread_stack:"KB * Num of connections, Stack size per thread",binlog_cache_size:"KB * Num of connections, Bin log cache size (multiples of 4096)",thread_cache_size:"Thread cache size",table_open_cache:"Table open cache (NOT exceed 2048 at most)",max_connections:"Max connections"},be={class:"w-150px!"},me={class:"w-250px! color-#666"},ye={class:"color-#666"},xe=s({__name:"index",setup(e,{expose:a}){const{t:n}=d(),t=m(),s=m(),g=x({}),z=(e,a)=>{for(const n in a.data)g[n]=a.data[n];v()},v=()=>{const e=new Set(["key_buffer_size","query_cache_size","tmp_table_size","innodb_buffer_pool_size","innodb_log_buffer_size"]),a=new Set(["sort_buffer_size","read_buffer_size","read_rnd_buffer_size","join_buffer_size","thread_stack","binlog_cache_size"]),n=Number(g.max_connections||0),{a:t,b:l}=Object.entries(g).reduce(((n,[t,s])=>{const l=Number(s);return e.has(t)?n.a+=l:a.has(t)&&(n.b+=l/1024),n}),{a:0,b:0});s.value=(t+l*n).toString()},k=async()=>{const e={...g,query_cache_type:g.query_cache_size>0?1:0,max_heap_table_size:g.tmp_table_size};await $(e),v()},w=()=>{A({title:n("Plugin.Mysql.index_22",[Q.title]),content:n("Plugin.Mysql.index_24",[Q.title]),onConfirm:async()=>{await ee({name:"mysqld",type:"restart"})}})},{loading:q,setLoading:j}=D(),B=async()=>{try{j(!0),t.value=null;const{message:e}=await T();if(P(e)){const a=e.mem;null!=a.join_buffer_size||(a.join_buffer_size=512),null!=a.thread_stack||(a.thread_stack=256),null!=a.binlog_cache_size||(a.binlog_cache_size=32);for(const e in pe)e in a&&(g[e]=a[e]);v()}}finally{j(!1)}};return B(),a({init:B}),(e,a)=>{const n=Z,d=W,m=ne,x=M,v=Y,P=V,j=C;return l(),i(c,null,[o(d,{class:"justify-center!"},{default:_((()=>[o(d,{class:"items-center"},{default:_((()=>[u("span",null,r(e.$t("Plugin.Mysql.index_20")),1),o(n,{class:"w-150px",value:f(t),"onUpdate:value":[a[0]||(a[0]=e=>y(t)?t.value=e:null),z],options:f(fe),placeholder:e.$t("Ftp.Placeholder.Index_2")},null,8,["value","options","placeholder"])])),_:1}),o(d,{class:"items-center"},{default:_((()=>[p(r(e.$t("Plugin.Mysql.index_21")),1),o(m,{text:"MB",class:"w-150px!",value:f(s),"onUpdate:value":a[1]||(a[1]=e=>y(s)?s.value=e:null),readonly:""},null,8,["value"])])),_:1})])),_:1}),o(x,{class:"my-10px!"}),o(j,{show:f(q)},{default:_((()=>[(l(!0),i(c,null,h(f(g),((e,a)=>(l(),b(d,{class:"items-center flex-nowrap! py-2px",key:a},{default:_((()=>[u("div",be,r(a),1),o(v,{class:"w-150px!",value:f(g)[a],"onUpdate:value":e=>f(g)[a]=e,min:0,"show-button":!1},null,8,["value","onUpdate:value"]),u("div",me,r(f(pe)[a]),1)])),_:2},1024)))),128)),o(d,{class:"items-center justify-center! mt-10px"},{default:_((()=>[o(P,{type:"primary",onClick:k},{default:_((()=>[p(r(e.$t("Public.Btn.Save")),1)])),_:1}),o(P,{onClick:w},{default:_((()=>[p(r(e.$t("Plugin.Mysql.index_22",[f(Q).title])),1)])),_:1}),u("span",ye,"*"+r(e.$t("Plugin.Mysql.index_23")),1)])),_:1})])),_:1},8,["show"])],64)}}}),he=s({__name:"index",setup(e,{expose:a}){const n=m("None"),{loading:t,setLoading:s}=D(),u=async()=>{await se({close:1}),d()},d=async()=>{try{s(!0);const{message:e}=await se();P(e)&&(n.value=e.result?e.result:"None")}finally{s(!1)}};return d(),a({init:d}),(e,a)=>{const s=V,d=te,b=C;return l(),i(c,null,[o(s,{class:"mb-10px",onClick:u},{default:_((()=>[p(r(e.$t("Crontab.Planned.index_25")),1)])),_:1}),o(b,{class:"h-580px",show:f(t)},{default:_((()=>[o(d,{log:f(n)},null,8,["log"])])),_:1},8,["show"])],64)}}}),ge=s({__name:"index",setup(e,{expose:a}){const n=m("None"),{loading:t,setLoading:s}=D(),i=async()=>{try{s(!0);const{message:e}=await U();P(e)&&(n.value=e.result?e.result:"None")}finally{s(!1)}};return i(),a({init:i}),(e,a)=>{const s=te,i=C;return l(),b(i,{class:"h-610px",show:f(t)},{default:_((()=>[o(s,{log:f(n)},null,8,["log"])])),_:1},8,["show"])}}}),ze={class:"ml-20px"},ve=s({__name:"index",setup(e,{expose:n}){const{t:t}=d(),s=x({binlog_status:!1,size:0}),{table:p,columns:b}=E([{key:"name",title:t("Site.TableRow.index_22")},{key:"title",title:t("Site.TableRow.index_23"),render:e=>B(e.size)},{key:"title",title:t("Plugin.Mysql.index_8"),render:e=>j(e.last_modified)},H({width:70,options:e=>[{label:t("Public.Btn.Del"),onClick:()=>{J({title:t("Plugin.Mysql.index_9"),content:t("Plugin.Mysql.index_10",[e.name]),onConfirm:async()=>{await le({path:e.path}),z()}})}}]})]),m=e=>{const a=t(e?"Public.Confirm.Enable":"Public.Status.Disable"),n=t(e?"Plugin.Mysql.index_11":"Plugin.Mysql.index_12");A({title:"".concat(a," ").concat(t("Plugin.Mysql.index_6")),content:n,onConfirm:async()=>{await G(),g()}})},{loading:y,setLoading:h}=D(),g=async()=>{const{message:e}=await G({status:1});P(e)&&(s.binlog_status=e.binlog_status,s.size=e.size)},z=async()=>{try{h(!0);const{message:e}=await F();L(e)&&(p.data=e)}finally{h(!1)}},v=()=>{g(),z()};return v(),n({init:v}),(e,n)=>{const t=X,d=W,x=M,h=a,g=ae;return l(),i(c,null,[o(d,{class:"items-center"},{default:_((()=>[u("span",null,r(e.$t("Plugin.Mysql.index_6")),1),o(t,{value:f(s).binlog_status,loading:f(y),"onUpdate:value":m},null,8,["value","loading"]),u("span",ze,r(f(B)(f(s).size)),1)])),_:1}),o(x,{class:"my-16px!"}),o(h,{class:"mb-16px"},{default:_((()=>[u("li",null,r(e.$t("Plugin.Mysql.index_7")),1)])),_:1}),o(g,{loading:f(y),data:f(p).data,columns:f(b),"max-height":400},null,8,["loading","data","columns"])],64)}}}),ke=s({__name:"index",setup(e,{expose:n}){const t=m(!1),s=async e=>{await R({status:e?1:0}),b()},{loading:d,setLoading:p}=D(),b=async()=>{try{p(!0),await R(),t.value=!0}catch(e){t.value=!1}finally{p(!1)}};return b(),n({init:b}),(e,n)=>{const p=X,b=W,m=M,x=a;return l(),i(c,null,[o(b,{class:"items-center"},{default:_((()=>[u("span",null,r(e.$t("Plugin.Mysql.index_18")),1),o(p,{value:f(t),"onUpdate:value":[n[0]||(n[0]=e=>y(t)?t.value=e:null),s],loading:f(d)},null,8,["value","loading"])])),_:1}),o(m,{class:"my-16px!"}),o(x,{class:"mb-16px"},{default:_((()=>[u("li",null,r(e.$t("Plugin.Mysql.index_19")),1)])),_:1})],64)}}}),we=s({__name:"index",setup(a){const{t:n}=d(),s=m("service"),i=[{key:"service",label:n("Security.History.Index_10"),component:ie},{key:"file",label:n("Site.Config.index_15"),data:{path:"/etc/my.cnf"},component:t},{key:"location",label:n("Plugin.Mysql.index_26"),component:oe},{key:"port",label:n("Site.TableRow.index_16"),component:_e},{key:"ssl",label:"SSL",component:ue},{key:"status",label:n("Docker.Setting.index_2"),component:de},{key:"optimization",label:n("Plugin.Mysql.index_27"),component:xe},{key:"logs",label:n("Site.Config.index_101"),component:he},{key:"slow",label:n("Plugin.Mysql.index_28"),component:ge},{key:"binary",label:n("Plugin.Mysql.index_6"),component:ve},{key:"memory",label:n("Plugin.Mysql.index_18"),component:ke}];return(a,n)=>{const t=e;return l(),b(t,{value:f(s),"onUpdate:value":n[0]||(n[0]=e=>y(s)?s.value=e:null),data:i},null,8,["value"])}}});export{we as default};
