import{X as a,O as t,P as e,F as o,j as l,u as c,r as n,d as u,f as i,w as s,t as r,i as d,c as m}from"./vue.js?v=1742891699271";import{c as p,h as _,a as b,f as k}from"./public.js?v=1742891699271";import{ai as g,b as v,ae as A,aj as h,h as y,m as w,ak as x,al as f,am as F,an as S,d as q,a9 as D}from"./page_layout.js?v=1742891699271";import{b$ as V,bY as H,co as j,ch as L,a2 as P,cn as U,_ as C}from"./naive.js?v=1742891699271";const M=a("aapanelsub-account-store",(()=>{const a=T(),{t:l}=t(),c=async()=>{try{u(!0);const{message:t}=await g(a.search);v(t)&&(a.table.data=t.list,a.table.total=t.page.count,a.account_total=t.account_total)}finally{u(!1)}},{loading:n,setLoading:u}=p(),i=async()=>{const{message:t}=await A();v(t)&&(a.packageSourceList=t.list,a.packageList=t.list.map((a=>({label:a.package_name,value:a.package_id}))),t.list.length>0&&(a.expendFormState.package_id=t.list[0].package_id,r(a.expendFormState.package_id)))},s=async()=>{const t=await h();if(v(t)){let e={};a.diskMountSourceList=t.message,a.diskMountPointList=t.message.map((a=>(a.is_default&&(e=a),{label:"".concat(a.mountpoint).concat(" ","(").concat(y(a.used),"/").concat(y(a.total),")").concat(" ").concat(l("Account.Account.account_533924-7"),":").concat(a.is_group_quota?l("Account.Account.account_533924-5"):l("Account.Account.account_533924-6")),value:a.mountpoint}))),t.message.length>0&&(a.expendFormState.mountpoint=e.mountpoint||t.message[0].mountpoint,a.currentChangeDisk=0===Object.keys(e).length?t.message[0]:e)}},r=async t=>{const e=a.packageSourceList.find((a=>a.package_id===t));if(e){const{package_name:t,disk_space_quota:o,monthly_bandwidth_limit:l,max_site_limit:c,max_database:n,php_start_children:u,php_max_children:i,remark:s}=e;a.wpForData.package_name=t,a.wpForData.disk_space_quota=0==o?{value:"",unlimited:!0}:{value:o/1024/1024,unlimited:!1},a.wpForData.monthly_bandwidth_limit=0==l?{value:"",unlimited:!0}:{value:l/1024/1024,unlimited:!1},a.wpForData.max_site_limit=0===c?{value:"",unlimited:!0}:{value:c,unlimited:!1},a.wpForData.max_database=0==n?{value:"",unlimited:!0}:{value:n,unlimited:!1},a.wpForData.php_start_children=u,a.wpForData.php_max_children=i,a.wpForData.remark=s}};const d=()=>{a.acForData.username="",a.acForData.password="",a.acForData.email="",a.acForData.expire_date="0000-00-00",a.expendFormState.package_id=void 0,m()},m=()=>{a.wpForData.package_name="",a.wpForData.disk_space_quota={value:"",unlimited:!1},a.wpForData.monthly_bandwidth_limit={value:"",unlimited:!1},a.wpForData.max_site_limit={value:"",unlimited:!1},a.wpForData.max_database={value:"",unlimited:!1},a.wpForData.php_start_children=1,a.wpForData.php_max_children=1,a.wpForData.remark=""};return{init:c,addHost:async()=>{if(a.table.total>=30)return w.error(l("Account.Account.account_533924-9",[30])),!1;d(),await i(),await s(),a.addVisible=!0,a.isEdit=!1},setLoading:u,loading:n,onLogin:async a=>{const{message:t}=await x({account_id:a});v(t)&&window.open(t.login_url+"?token="+t.token)},modifyStatus:async a=>{const{status:t,username:e}=a;b({title:"".concat(l(0===t?"Site.PHP.index_21_2":"Site.PHP.index_21_3")," ").concat(l("Account.Account.account_533924-0",[e])),content:l(0===t?"Account.Account.account_533924-1":"Account.Account.account_533924-2"),onConfirm:async()=>{await f({...a,status:0===t?1:0}),a.status=0===t?1:0}})},removeAccount:async a=>{b({title:l("Account.Account.account_673836-0",[a.username]),content:()=>e(o,null,[e("div",null,[l("Account.Account.account_673836-1")])]),onConfirm:async()=>{await S({account_id:a.account_id,is_del_resources:!0}),c()}})},form_save:async()=>{var t;await(null==(t=a.accountFormRef)?void 0:t.validate());const e=function(){const{package_id:t,mountpoint:e}=a.expendFormState,{username:o,password:l,email:c,expire_date:n,remark:u}=a.acForData,{disk_space_quota:i,monthly_bandwidth_limit:s,max_site_limit:r,max_database:d,php_start_children:m,php_max_children:p}=a.wpForData;return Object.assign({},{username:o,password:l,email:c,expire_date:n,package_id:t,mountpoint:e,disk_space_quota:i.unlimited?0:String(1024*Number(i.value)*1024),monthly_bandwidth_limit:s.unlimited?0:String(1024*Number(s.value)*1024),max_site_limit:r.unlimited?0:r.value,max_database:d.unlimited?0:d.value,php_start_children:m,php_max_children:p,remark:u})}();if(Number(e.disk_space_quota)>0&&!a.isEdit){const{is_group_quota:t,free:o}=a.currentChangeDisk;if(!t)return w.error(l("Account.Account.account_533924-3")),!1;if(o<Number(e.disk_space_quota))return w.error(l("Account.Account.account_533924-4")),!1}try{a.isEdit?(delete e.mountpoint,await f({account_id:a.current_account_id,...e}),d(),c()):(await F(e),d(),c())}catch(o){return Promise.reject(o)}},form_reset:d,package_form_reset:m,getPackageList:i,getDiskList:s,changePackage:r,copyInfo:a=>{const{url:t,user:e,pass:o}=a;_("Access address: ".concat(t,"\nUsername: ").concat(e,"\ninit Password: ").concat(o))}}}));const N=u({props:{options:Array,modelValue:Object,rules:Object,exclude:Array},setup(a,{attrs:t,slots:u,expose:s}){const r=n(null),d=l({});return s(d),i((()=>{var a,t;Object.assign(d,{validate:null==(a=r.value)?void 0:a.validate,restoreValidation:null==(t=r.value)?void 0:t.restoreValidation})})),()=>e(o,null,[e(j,c(t,{model:a.modelValue,ref:r,rules:a.rules}),{default:()=>{var l;return e(o,null,[null==(l=a.options)?void 0:l.filter((t=>{var e;return!(null==(e=a.exclude)?void 0:e.includes(t.key))})).map((o=>function(a,t,o,l){const{label:n,key:u,type:i,options:s,el:r}=a;switch(i){case"input":case"password":return e(L,c({label:n,path:u},o),{default:()=>[e(C,c({value:t[u],"onUpdate:value":a=>t[u]=a},r),null)]});case"select":return e(L,c({label:n,path:a.key},o),{default:()=>[e(U,c({options:s,value:t[u],"onUpdate:value":a=>t[u]=a},r),null)]});case"checkbox":return e(L,c({label:n,path:a.key},o),{default:()=>[e(P,c({checked:t[u],"onUpdate:checked":a=>t[u]=a},r),null)]});case"date-picker":return e(L,c({label:n,path:a.key},o),{default:()=>[e(D,c({"formatted-value":t[u],"onUpdate:formatted-value":a=>t[u]=a,type:"date","value-format":"yyyy-MM-dd"},r),null)]});case"input-number":return e(L,c({label:n,path:a.key},o),{default:()=>[e(I,c({value:t[u],"onUpdate:value":a=>t[u]=a},r),null)]});case"custom-item":return e(L,c({label:n,path:a.key},o,{disabled:o.disabled}),{default:()=>{var t;return[null==(t=a.slots)?void 0:t.default(o)]}});case"custom-slot":return e(L,c({label:n,path:a.key},o,{disabled:o.disabled}),{default:()=>{var t;return[l&&(null==(t=l[a.key])?void 0:t.call(l))]}})}}(o,a.modelValue,t,u)))])}})])}});function O(){const a=[{type:"input",label:q.global.t("Account.Account.FormHooks-122755-1"),key:"username",el:{disabled:!0}},{type:"custom-slot",label:q.global.t("Account.Account.FormHooks-122755-2"),key:"password"},{type:"input",label:q.global.t("Account.Account.FormHooks-122755-4"),key:"email"},{type:"custom-slot",label:q.global.t("Account.Account.FormHooks-122755-5"),key:"expire_date"},{type:"input",label:q.global.t("Account.Account.FormHooks-122755-14"),key:"remark"}],t=l({username:"",password:"",email:"",expire_date:"0000-00-00",remark:""}),o=l({username:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-7"),trigger:"blur"}],password:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-8"),trigger:"blur"}],email:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-10"),trigger:"blur"}]});return[u({props:{isEdit:Boolean},setup(u,{attrs:s,expose:r,slots:m}){const p=n(),_=l({});return r(_),i((()=>{var a,t;Object.assign(_,{validate:null==(a=p.value)?void 0:a.validate,restoreValidation:null==(t=p.value)?void 0:t.restoreValidation})})),u.isEdit?(a[0].el.disabled=!0,o.password[0].required=!1):(a[0].el.disabled=!1,o.password[0].required=!0),()=>{return e(N,c({options:a,modelValue:t,"onUpdate:modelValue":a=>t=a,"label-placement":"left","label-width":"130px"},s,{rules:o,ref:p}),"function"==typeof(l=m)||"[object Object]"===Object.prototype.toString.call(l)&&!d(l)?m:{default:()=>[m]});var l}}}),t]}const E=u({props:{modelValue:Object},setup(a,{attrs:t}){var o,c,n,u;const i=l({value:(null==(o=a.modelValue)?void 0:o.value)?null==(c=a.modelValue)?void 0:c.value:0,unlimited:!!(null==(n=a.modelValue)?void 0:n.unlimited)&&(null==(u=a.modelValue)?void 0:u.unlimited)});return s(i,(t=>{a.modelValue.value=t.value,a.modelValue.unlimited=t.unlimited})),()=>{var o;return e("div",{class:"inline-item"},[e("div",{class:"left-item"},[e(I,{value:i.value,"onUpdate:value":a=>i.value=a,disabled:(null==(o=a.modelValue)?void 0:o.unlimited)||t.disabled},null)]),e("div",{class:"right-item"},[e(V,{value:i.unlimited,"onUpdate:value":a=>i.unlimited=a,disabled:t.disabled},{checked:()=>q.global.t("Account.Account.FormHooks-122755-12"),unchecked:()=>q.global.t("Account.Account.FormHooks-122755-12")})])])}}});function B(){const a=[{type:"input",label:q.global.t("Account.Account.FormHooks-122755-13"),key:"package_name"},{type:"input",label:q.global.t("Account.Account.FormHooks-122755-14"),key:"remark"},{type:"custom-item",label:q.global.t("Account.Account.FormHooks-122755-15"),key:"disk_space_quota",slots:{default:a=>e(E,c({modelValue:t.disk_space_quota,"onUpdate:modelValue":a=>t.disk_space_quota=a},a),null)}},{type:"custom-item",label:q.global.t("Account.Account.FormHooks-122755-16"),key:"monthly_bandwidth_limit",slots:{default:a=>e(E,c({modelValue:t.monthly_bandwidth_limit,"onUpdate:modelValue":a=>t.monthly_bandwidth_limit=a},a),null)}},{type:"custom-item",label:q.global.t("Account.Account.FormHooks-122755-17"),key:"max_site_limit",slots:{default:a=>e(E,c({modelValue:t.max_site_limit,"onUpdate:modelValue":a=>t.max_site_limit=a},a),null)}},{type:"input-number",label:q.global.t("Account.Account.FormHooks-122755-18"),key:"php_start_children"},{type:"input-number",label:q.global.t("Account.Account.FormHooks-122755-19"),key:"php_max_children"},{type:"custom-item",label:q.global.t("Account.Account.FormHooks-122755-21"),key:"max_database",slots:{default:a=>e(E,c({modelValue:t.max_database,"onUpdate:modelValue":a=>t.max_database=a},a),null)}}],t=l({package_name:"",remark:"",disk_space_quota:{value:0,unlimited:!0},monthly_bandwidth_limit:{value:0,unlimited:!0},max_site_limit:{value:0,unlimited:!0},php_start_children:1,php_max_children:3,max_email_account:{value:1,unlimited:!1},max_database:{value:0,unlimited:!0}}),r=l({package_name:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-22"),trigger:"blur"}],disk_space_quota:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-24"),trigger:"blur",validator:(a,t)=>!!t.unlimited||!!(t.value&&t.value>0)}],monthly_bandwidth_limit:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-25"),trigger:"blur",validator:(a,t)=>!!t.unlimited||!!(t.value&&t.value>0)}],max_site_limit:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-26"),trigger:"blur",validator:(a,t)=>!!t.unlimited||!!(t.value&&t.value>0)}],php_start_children:[{required:!0,validator:(a,t)=>!!t||new Error(q.global.t("Account.Account.FormHooks-122755-27"))}],php_max_children:[{required:!0,validator:(a,t)=>t>0||new Error(q.global.t("Account.Account.FormHooks-122755-28"))}],max_email_account:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-29"),trigger:"blur",validator:(a,t)=>!!t.unlimited||!!(t.value&&t.value>0)}],max_database:[{required:!0,message:q.global.t("Account.Account.FormHooks-122755-30"),trigger:"blur",validator:(a,t)=>!!t.unlimited||!!(t.value&&t.value>0)}]}),d=n();return[u({props:{isDisable:Boolean,exclude:Array},setup(c,{expose:u}){const m=l({}),p=n(!1);return u(m),i((()=>{var a,t;Object.assign(m,{validate:null==(a=d.value)?void 0:a.validate,restoreValidation:null==(t=d.value)?void 0:t.restoreValidation})})),s(c,(a=>{"isDisable"in a&&(p.value=a.isDisable)}),{immediate:!0}),()=>e(o,null,[e(N,{exclude:c.exclude,options:a,modelValue:t,"onUpdate:modelValue":a=>t=a,"label-placement":"left","label-width":"130px",rules:r,ref:d,disabled:p.value},null)])}}),t]}const I=u({props:{value:Number},emits:["update:value"],setup(a,{emit:t,attrs:o}){const l=r(a,"value"),u=n(a.value);function i(a){isNaN(Number(a))?(u.value=0,t("update:value",1)):(u.value=Math.round(a),t("update:value",Number(Math.floor(a))))}return s(l,(a=>{u.value=a})),()=>e(H,c(o,{value:u.value,clearable:!0,"onUpdate:value":i,min:1}),null)}}),R="data:image/svg+xml,%3csvg%20class='icon'%20style='vertical-align:%20bottom;'%20viewBox='0%200%201300%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4324'%20width='16'%20height='16'%3e%3cpath%20d='M1126.4%20512c0-113.152-91.648-204.8-204.8-204.8-61.952%200-115.2%2029.184-153.6%2082.432-38.4-53.248-91.136-82.432-153.6-82.432-113.152%200-204.8%2091.648-204.8%20204.8s91.648%20204.8%20204.8%20204.8c62.464%200%20115.2-29.184%20153.6-82.432%2038.4%2053.248%2091.648%2082.432%20153.6%2082.432%20113.152%200%20204.8-91.648%20204.8-204.8m102.4-307.2v614.4c0%2084.992-68.608%20153.6-153.6%20153.6H460.8c-84.992%200-153.6-68.608-153.6-153.6V204.8c0-84.992%2068.608-153.6%20153.6-153.6h614.4c84.992%200%20153.6%2068.608%20153.6%20153.6M614.4%20409.6c-56.32%200-102.4%2046.08-102.4%20102.4s46.08%20102.4%20102.4%20102.4c55.296%200%2084.992-52.736%20100.352-102.4-15.36-49.664-45.056-102.4-100.352-102.4m409.6%20102.4c0%2056.32-46.08%20102.4-102.4%20102.4-55.296%200-84.992-52.736-100.352-102.4%2015.36-49.664%2045.056-102.4%20100.352-102.4%2056.32%200%20102.4%2046.08%20102.4%20102.4'%20fill='%2320a53a'%20p-id='4325'%3e%3c/path%3e%3c/svg%3e",T=a("account-state-store",(()=>{const a=M(),{t:o}=t(),c=n(!1),u=n(!1),i=n(null),s=n(30),r=l({data:[],total:0,loading:!1}),d=n([{title:o("Account.Account.accountState-721844-0"),key:"username",width:130,render:t=>e("span",{class:"text-primary cursor-pointer",onClick:()=>a.onLogin(t.account_id)},[t.username])},{title:o("Account.Account.accountState-721844-1"),key:"package_name",width:100},{title:o("Account.Account.accountState-721844-2"),key:"email"},{title:o("Account.Account.accountState-721844-20"),key:"login_info",width:80,render:t=>e("span",{class:"text-primary cursor-pointer",onClick:()=>a.copyInfo({url:t.login_url,user:t.username,pass:t.init_password})},[o("Public.Btn.Copy")])},{key:"quota",title:o("Account.Account.accountState-721844-3"),render:a=>e("span",{class:0===a.disk_space_status?"text-error":""},[0===a.disk_space_used&&0===a.disk_space_quota?"-":y(a.disk_space_used,!0,0),m(" /")," ",0===a.disk_space_quota?e("img",{class:"icon",title:"",src:R},null):y(a.disk_space_quota,!0,0)])},{key:"bandwidth",title:o("Account.Account.accountState-721844-7"),render:a=>e("span",{class:0===a.monthly_bandwidth_status?"text-error":""},[y(a.monthly_bandwidth_used,!0,2),m(" /")," ",0===a.monthly_bandwidth_limit?e("img",{class:"icon",title:"",src:R},null):y(a.monthly_bandwidth_limit,!0,0)])},{title:o("Account.Account.accountState-721844-8"),key:"status",width:68,render:t=>{const l=new Map([[-1,o("Account.Account.accountState-721844-9")],[0,o("Account.Account.accountState-721844-10")],[1,o("Account.Account.accountState-721844-11")],[2,o("Account.Account.accountState-721844-12")]]);return e("span",{onClick:()=>a.modifyStatus(t),class:"cursor-pointer ".concat(1===t.status||-1===t.status?"text-primary":"text-error")},[l.get(t.status)])}},{title:o("Account.Account.accountState-721844-13"),key:"expire_date",width:106,render:a=>"0000-00-00"===a.expire_date?o("Account.Account.account_index_10"):a.expire_date},{title:o("Account.Account.accountState-721844-14"),key:"remark",render:a=>a.remark?a.remark:"--"},k({title:o("Public.Table.Action"),align:"right",width:200,options:t=>[{label:o("Account.Account.accountState-721844-15"),onClick:async()=>{a.onLogin(t.account_id)}},{label:o("Account.Account.accountState-721844-16"),onClick:async()=>{await a.getPackageList(),await a.getDiskList(),b.value=Number(t.account_id),u.value=!0,x.username=t.username,x.password="",x.email=t.email,x.expire_date=t.expire_date,x.remark=t.remark,f.value.package_id=Number(t.package_id),f.value.mountpoint=t.mountpoint,a.changePackage(t.package_id),c.value=!0}},{label:o("Account.Account.accountState-721844-17"),onClick:async()=>{a.removeAccount(t)}}]})]),p=n([]),_=l({p:1,rows:10,type_id:-1,search_value:""}),b=n(null),g=n([]),v=n([]),A=n([]),h=n([]),[w,x]=O(),f=n({package_id:-1,mountpoint:""}),F=n(),[S,q]=B();return{addVisible:c,search:_,table:r,columns:d,keys:p,isEdit:u,accountFormRef:i,account_total:s,acForData:x,expendFormState:f,wpForData:q,packageList:g,packageSourceList:v,diskMountPointList:A,diskMountSourceList:h,current_account_id:b,currentChangeDisk:F,initAccountForm:()=>w,initPackageForm:()=>S}}));export{M as a,B as b,R as q,T as u};
