import{_ as t}from"./index68.js?v=1721298337096";import{_ as e}from"./index.vue_vue_type_script_setup_true_lang.js?v=1721298337096";import{u as a,_ as s}from"./useTableData.js?v=1721298337096";import{u as i,M as o,L as l,h as r,dv as n,j as p,k as m,cj as c,B as u}from"./index.js?v=1721298337096";import{d,a as f}from"./file2.js?v=1721298337096";import{u as h}from"./useLoading.js?v=1721298337096";import{b as g}from"./useTableColumns.js?v=1721298337096";import{o as j}from"./file.js?v=1721298337096";import{l as b,S as w,Z as y,P as z,V as _,q as k,W as v,_ as x}from"./vue.js?v=1721298337096";import"./Skeleton.js?v=1721298337096";import"./DataTable.js?v=1721298337096";import"./Checkbox.js?v=1721298337096";import"./Ellipsis.js?v=1721298337096";import"./Select.js?v=1721298337096";import"./Tag.js?v=1721298337096";import"./Empty.js?v=1721298337096";import"./omit.js?v=1721298337096";import"./pinia.js?v=1721298337096";import"./Progress.js?v=1721298337096";const S={class:"p-20px"},q=x("li",null,"Only support sql, zip, (tar.gz|gz|tgz)",-1),C=x("li",null," Structure of zip, tar.gz archive: test.sql must be contained in test.zip or test.tar.gz ",-1),D=x("li",null," If the file is oversized, you can also upload database archives to /www/backup/database with SFTP tools ",-1),E=b({__name:"index",props:{data:{}},setup(b){const x=b,{row:E}=x.data,L=i(),T=()=>{if(!L.backupPath)throw new Error("No backup directory");return L.backupPath+"/database"},F=()=>{const t=T(),e="pgsql"==L.type?".sql":".sql,.gz,.tar.gz,.zip";j(t,e,(()=>{A()}))},{table:I,columns:P}=a([{key:"filename",title:"File name",ellipsis:{tooltip:{width:"trigger"}}},{key:"addtime",title:"Modification time",width:150,render:t=>o(t.etime)},{key:"size",title:"Size",width:100,render:t=>l(t.size)},g({width:100,options:t=>[{label:"Import",onClick:()=>{r({title:"Import Database",content:"Database will be overwritten, continue?",onConfirm:async({hide:e})=>{await(async t=>{await n(L.type,{file:T()+"/"+t.filename,name:E.name})})(t),e()}})}},{label:"Del",onClick:()=>{r({title:"Delete file [".concat(t.filename,"]"),content:"Are you sure to put this file [".concat(t.filename,"] to recycle bin?"),onConfirm:async({hide:e})=>{await(async t=>{await d({path:T()+"/"+t.filename}),A(),L.setRefresh(!0)})(t),e()}})}}]})]),{loading:M,setLoading:R}=h(),A=async()=>{try{R(!0);const{message:t}=await f({p:1,reverse:"True",sort:"mtime",tojs:"GetFiles",showRow:100,path:T()});I.data=[],p(t)&&m(t.FILES)&&t.FILES.forEach((t=>{if(!t)return;const e=t.split(";"),a=(t=>{const e=t.split(".");return e[e.length-1]})(e[0]);"sql"!=a&&"zip"!=a&&"gz"!=a&&"tgz"!=a||I.data.push({filename:e[0],size:c(e[1]),etime:c(e[2])})}))}finally{R(!1)}};return A(),(a,i)=>{const o=u,l=s,r=e,n=t;return w(),y("div",S,[z(r,null,{toolsLeft:_((()=>[z(o,{onClick:F},{default:_((()=>[k("Upload from local")])),_:1})])),table:_((()=>[z(l,{"max-height":348,loading:v(M),data:v(I).data,columns:v(P)},null,8,["loading","data","columns"])])),_:1}),z(n,{class:"mt-16px"},{default:_((()=>[q,C,D])),_:1})])}}});export{E as default};
