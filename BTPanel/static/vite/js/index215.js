import{d as a,_ as e,ae as l,af as t,u as s,ag as n,ah as i,ai as d,aB as o}from"./public.js?v=1758789124250";import{_ as u}from"./index.vue_vue_type_script_setup_true_lang.js?v=1758789124250";import{a3 as r}from"./site.js?v=1758789124250";import{aU as p,S as _,d as m,w as c}from"./page_layout.js?v=1758789124250";import{dR as h,dT as f,dU as v,_ as y,dV as S,au as x,eg as g,da as w,d5 as b}from"./naive.js?v=1758789124250";import{k as L,P as k,r as A,e as $,c as z,w as U,o as Z,R as j,V as R,W as E,a3 as O,an as F,U as q,j as B,a4 as C,a2 as H,F as J,O as M,S as N}from"./vue.js?v=1758789124250";import"./common.js?v=1758789124250";import"./__commonjsHelpers__.js?v=1758789124250";const P={class:"p-16px"},V={key:0},W={key:1},T=L({__name:"index",props:{onRefresh:{type:Function},onOpenLog:{type:Function}},setup(L,{expose:T}){const{t:D}=k(),G=L,I=A(null),K=$({auth_type:"dns",dns_manual:0,site:0,type:"wildcard",domains:"",domains_list:[],all:!1}),Q=A([{label:D("SSL.index_17"),value:"single"},{label:D("SSL.index_18"),value:"wildcard"},{label:D("SSL.index_19"),value:"wildcard_all"}]),X=A([]),Y=A([]),aa=()=>{K.domains=""},ea=()=>{K.domains_list=[],da()},la=z(()=>K.domains_list.length>0&&K.domains_list.length<Y.value.length);U(()=>K.domains_list,a=>{a.length===Y.value.length?K.all=!0:a.length||(K.all=!1)}),U(()=>K.all,a=>{var e;a?(K.domains_list=Y.value.map(a=>a.name),null==(e=I.value)||e.validate()):K.domains_list=[]});const ta={domains:{required:!0,trigger:"input",validator:(a,e)=>{if("single"===K.type){if(!e)return new Error(D("SSL.index_20"));if(!/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/.test(e))return new Error(D("SSL.index_21"))}else if("wildcard"===K.type){if(!e)return new Error(D("SSL.index_22"));if(!/^(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/.test(e))return new Error(D("SSL.index_23"))}else if("wildcard_all"===K.type){if(!e)return new Error(D("SSL.index_24"));if(!/^\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/i.test(e))return new Error(D("SSL.index_25"))}return!0}},domains_list:{required:!0,trigger:"change",type:"array",message:D("SSL.SiteSSL.index_16")}},sa=()=>({auth_type:K.dns_manual?"dns_manual":K.auth_type,domains:JSON.stringify("http"===K.auth_type?K.domains_list:"single"===K.type?[K.domains]:K.domains.split("\n")),site_id:K.dns_manual?-1:void 0}),{loading:na,setLoading:ia}=a(),da=async()=>{try{ia(!0);const{message:a}=await r({id:K.site});c(a)&&(Y.value=a.map(a=>({name:a.name})))}finally{ia(!1)}};return Z(async()=>{await(async()=>{const{message:a}=await o();c(a)&&(X.value=a.map(a=>({label:a.name,value:a.id})),K.site=X.value[0].value)})(),da()}),T({onConfirm:async()=>{var a;if(await(null==(a=I.value)?void 0:a.validate()),K.dns_manual&&"dns"===K.auth_type){const a=JSON.stringify("single"===K.type?[K.domains]:K.domains.split("\n")),{message:e}=await l({site_id:-1,domains:a});if(m(e)&&Object.keys(e).length)return t(e.auths,-1,[K.domains],()=>{G.onRefresh()},!0),!1;const u=s({width:500,height:300,hideClose:!0,component:n});try{const{message:a}=await i(sa(),!1);if(m(a)){if(a.deploy)return void G.onRefresh();Array.isArray(a.auths)&&a.auths.length&&t(a.auths,-1,[K.domains],()=>{G.onRefresh()})}}catch(o){d(b(o,"message",""))}finally{u.hide()}return}const{message:e}=await i(sa());m(e)&&G.onOpenLog(e.path),G.onRefresh()}}),(a,l)=>{const t=v,s=p,n=f,i=h,d=y,o=S,r=x,m=w,c=g,b=_,L=u,k=e;return R(),j("div",P,[E(L,{ref_key:"formRef",ref:I,model:q(K),rules:ta,"label-width":"150px"},{default:O(()=>[E(i,{label:a.$t("Waf.Setting.config_67"),path:"verify_method"},{default:O(()=>[E(n,{value:q(K).auth_type,"onUpdate:value":l[0]||(l[0]=a=>q(K).auth_type=a)},{default:O(()=>[E(s,null,{default:O(()=>[E(t,{value:"dns"},{default:O(()=>[B(C(a.$t("SSL.index_12")),1)]),_:1}),E(t,{value:"http"},{default:O(()=>[B(C(a.$t("SSL.SiteSSL.index_17")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),"dns"===q(K).auth_type?(R(),j("div",V,[E(i,{label:" "},{default:O(()=>[E(d,{checked:q(K).dns_manual,"onUpdate:checked":l[1]||(l[1]=a=>q(K).dns_manual=a),"checked-value":1,"unchecked-value":0},{default:O(()=>[B(C(a.$t("SSL.index_2")),1)]),_:1},8,["checked"])]),_:1}),E(i,{label:a.$t("SSL.index_13"),path:"type"},{default:O(()=>[E(o,{class:"w-300px",value:q(K).type,"onUpdate:value":[l[2]||(l[2]=a=>q(K).type=a),aa],options:q(Q)},null,8,["value","options"])]),_:1},8,["label"]),"single"===q(K).type?(R(),H(i,{key:0,label:" ",path:"domains"},{default:O(()=>[E(r,{"input-props":{spellcheck:!1},class:"w-300px!",value:q(K).domains,"onUpdate:value":l[3]||(l[3]=a=>q(K).domains=a),placeholder:"aapanel.com"},null,8,["value"])]),_:1})):F("",!0),"wildcard"===q(K).type?(R(),H(i,{key:1,label:" ",path:"domains"},{default:O(()=>[E(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:q(K).domains,"onUpdate:value":l[4]||(l[4]=a=>q(K).domains=a),placeholder:a.$t("SSL.index_14")},null,8,["value","placeholder"])]),_:1})):F("",!0),"wildcard_all"===q(K).type?(R(),H(i,{key:2,label:" ",path:"domains"},{default:O(()=>[E(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:q(K).domains,"onUpdate:value":l[5]||(l[5]=a=>q(K).domains=a),placeholder:"*.aapanel.com"},null,8,["value"])]),_:1})):F("",!0)])):F("",!0),"http"===q(K).auth_type?(R(),j("div",W,[E(i,{label:a.$t("Home.index_68")},{default:O(()=>[E(o,{class:"w-300px",value:q(K).site,"onUpdate:value":[l[6]||(l[6]=a=>q(K).site=a),ea],options:q(X)},null,8,["value","options"])]),_:1},8,["label"]),E(i,{label:a.$t("Mail.Bcc.index_6"),path:"domains_list"},{default:O(()=>[E(b,{show:q(na),class:"p-12px w-300px max-h-300px min-h-100px overflow-auto border border-solid border-#ccc"},{default:O(()=>[E(d,{class:"mb-12px",checked:q(K).all,"onUpdate:checked":l[7]||(l[7]=a=>q(K).all=a),label:a.$t("Public.SelectAll"),indeterminate:q(la)},null,8,["checked","label","indeterminate"]),E(c,{value:q(K).domains_list,"onUpdate:value":l[8]||(l[8]=a=>q(K).domains_list=a)},{default:O(()=>[E(m,{class:"flex-col!",size:12},{default:O(()=>[(R(!0),j(J,null,M(q(Y),a=>(R(),H(d,{key:a.name,value:a.name,label:a.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])]),_:1},8,["label"])])):F("",!0)]),_:1},8,["model"]),E(k,{class:"mt-16px"},{default:O(()=>[N("li",null,C(a.$t("SSL.index_15")),1),l[9]||(l[9]=N("li",null,"Manually resolved certificates do not support auto-renewal",-1)),N("li",null,C(a.$t("SSL.index_16")),1)]),_:1,__:[9]})])}}});export{T as default};
