System.register(["./page_layout-legacy.js?v=1747989938512","./public-legacy.js?v=1747989938512","./tools-legacy2.js?v=1747989938512","./vue-legacy.js?v=1747989938512","./naive-legacy.js?v=1747989938512","./rules-legacy.js?v=1747989938512","./index.vue_vue_type_script_setup_true_lang-legacy5.js?v=1747989938512","./index.vue_vue_type_script_setup_true_lang-legacy8.js?v=1747989938512","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1747989938512","./index-legacy97.js?v=1747989938512","./index.vue_vue_type_script_setup_true_lang-legacy16.js?v=1747989938512","./common-legacy.js?v=1747989938512"],(function(e,t){"use strict";var a,l,i,n,d,o,r,s,u,p,c,_,y,m,v,f,g,b,x,h,w,R,W,k,j,C,$,M,D,S,U,z,P,I,B,L,O,E,F,H,T,N,Y,q,A,G,V,J,K,Q,X,Z,ee,te,ae,le,ie,ne,de,oe,re,se,ue,pe,ce,_e,ye;return{setters:[e=>{a=e.t,l=e.i,i=e.aj,n=e.l,d=e.a,o=e.cR,r=e.N,s=e.c,u=e.b3,p=e.a1,c=e.a4,_=e.p,y=e.cj,m=e.h,v=e.cB},e=>{f=e.c,g=e.f,b=e.u,x=e.h,h=e.a,w=e.d},e=>{R=e.a,W=e.s},e=>{k=e.d,j=e.O,C=e.P,$=e.Y,M=e.R,D=e.a0,S=e.V,U=e.ab,z=e.r,P=e.j,I=e.S,B=e.a1,L=e.U,O=e.a2,E=e.k,F=e.v,H=e.c,T=e.F,N=e.t,Y=e.aC,q=e.y,A=e.ae,G=e.N,V=e.aj,J=e.x,K=e.e},e=>{Q=e.bz,X=e.cp,Z=e.cj,ee=e.T,te=e.ae,ae=e.ct,le=e.cn,ie=e.cm,ne=e.cz,de=e.ck,oe=e.cl},e=>{re=e.l},e=>{se=e._},e=>{ue=e._},e=>{pe=e._},e=>{ce=e._},e=>{_e=e._},e=>{ye=e.j}],execute:function(){var me=document.createElement("style");me.textContent=".rank-table[data-v-9bacc249]{--n-merged-border-color: transparent;height:100%}.rank-table[data-v-9bacc249] .n-data-table-thead{display:none}.bt-radio[data-v-9ee89472] .n-radio-button:last-child{border-right:none;border-top-right-radius:0;border-bottom-right-radius:0}.bt-date-picker[data-v-9ee89472]{width:220px}.bt-date-picker[data-v-9ee89472] .n-input{border-top-left-radius:0;border-bottom-left-radius:0}.report-tabs[data-v-0329e270]{--n-tab-gap: 0;--n-tab-padding: 14px 24px;--n-tab-font-size: 14px;--n-pane-padding-top: 16px;--n-pane-padding-left: 16px;--n-pane-padding-right: 16px;--n-pane-padding-bottom: 16px}.report-card[data-v-0329e270]{--n-title-font-size: 14px}.report-card[data-v-0329e270] .n-card-header{min-height:50px}\n",document.head.appendChild(me);const ve=e("g",(e=>a.post("/plugin?action=a&name=btwaf&s=get_id_log",e,{requestOptions:{loading:l.global.t("Waf.Api.report_1")}}))),fe=k({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,{t:l}=j(),o=i(),{columns:r}=f([{key:"ip",title:l("Waf.Report.index_7"),ellipsis:{tooltip:!0}},{key:"address",title:l("Waf.Report.index_8"),ellipsis:{tooltip:!0}},{key:"num",title:l("Waf.Report.index_9"),width:"14%",minWidth:120},{key:"num",title:l("Waf.Report.index_10"),width:"32%",minWidth:160,render:e=>{const{total:t}=a,l=n((100*(t?e.num/t:0)).toFixed(1));return C("div",{class:"w-90%"},[C(Q,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:l,color:o.value.successColor},null)])}},g({width:120,options:e=>[{label:l("Waf.Report.index_11"),onClick:()=>{R(e)}},{label:l("Public.Btn.Details"),onClick:()=>{b({title:l("Waf.Report.index_12",[e.ip]),width:950,minHeight:672,data:{row:e},component:$((()=>d((()=>t.import("./details-legacy2.js?v=1747989938512")),void 0)))})}}]})]);return(e,t)=>{const a=x;return M(),D(a,{loading:e.loading,data:e.data,columns:S(r)},null,8,["loading","data","columns"])}}}),ge=k({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,l=i(),{t:o}=j(),{columns:r}=f([{key:"uri",title:"URI",ellipsis:{tooltip:!0}},{key:"num",title:o("Waf.Report.index_9"),width:"20%"},{key:"num",title:o("Waf.Report.index_10"),render:e=>{const{total:t}=a,i=n((100*(t?e.num/t:0)).toFixed(1));return C("div",{class:"w-90%"},[C(Q,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:i,color:l.value.successColor},null)])}},g({width:120,options:e=>[{label:o("Waf.Report.index_11"),onClick:()=>{s(e)}},{label:o("Public.Btn.Details"),onClick:()=>{u(e)}}]})]),s=e=>{h({title:o("Waf.Report.index_19"),content:()=>C(U,{tag:"div",keypath:"Waf.Report.index_33",scope:"global"},{index_1:()=>C("span",{class:"text-error"},[e.uri])}),onConfirm:async()=>{await re({url_rule:e.uri})}})},u=e=>{b({title:o("Waf.Report.index_20",[e.uri]),width:950,minHeight:600,data:{uri:e.uri,list:e.list},component:$((()=>d((()=>t.import("./details-legacy3.js?v=1747989938512")),void 0)))})};return(e,t)=>{const a=x;return M(),D(a,{loading:e.loading,data:e.data,columns:S(r)},null,8,["loading","data","columns"])}}}),be={class:"p-8px"},xe={class:"w-160px"},he={class:"min-w-160px mr-20px"},we={class:"text-desc"},Re={class:"w-450px"},We=k({__name:"index",setup(e){const{t:l}=j(),i=z(null),n=P({p:1,limit:10,site:"all",type:"1",search:"",time:null}),_={search:{trigger:["input","blur"],validator:()=>"4"===n.type||""!==n.search.trim()||new Error(l("Waf.Report.index_28"))},time:{trigger:["change"],validator:()=>"4"!==n.type||null!==n.time||new Error(l("Waf.Report.index_29"))}},y=z([{label:l("Waf.Report.index_30"),value:"all"}]),m=[{label:"IP",value:"1"},{label:"URI",value:"2"},{label:"URL",value:"3"},{label:l("Waf.Report.index_31"),value:"4"}],{table:v,columns:h,setLoading:w}=f([{key:"time_localtime",title:l("Waf.Report.index_13"),width:"18%",minWidth:150},{key:"ip",title:l("Waf.Report.index_7"),width:"14%",minWidth:120},{key:"server_name",title:l("Waf.Report.index_14"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},{key:"uri",title:"URI",ellipsis:{tooltip:!0},minWidth:160,render:e=>o(e.uri)},{key:"filter_rule",title:l("Waf.Report.index_1"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},g({width:100,options:e=>[{label:l("Public.Btn.Details"),onClick:async()=>{const{message:t}=await ve({id:e.id});r(t)&&t.length>0&&W(t[0])}},{label:"HTTP",onClick:()=>{R(e)}}]})]),R=e=>{b({title:l("Waf.Report.index_32",[e.time_localtime]),width:800,minHeight:458,data:{id:e.id},component:$((()=>d((()=>t.import("./http-legacy.js?v=1747989938512")),void 0)))})},k=async()=>{try{await(i.value?.validate()),w(!0);const{message:t}=await(e=(()=>{const{time:e}=n,t=e?c(e[0],"yyyy-MM-dd"):"",a=e?c(e[1],"yyyy-MM-dd"):"";return{..."all"===n.site?{is_all:1}:{server_name:n.site},..."4"===n.type?{start_time:t,end_time:a}:{serach:n.search},p:n.p,type:n.type}})(),a.post("/plugin?action=a&name=btwaf&s=get_search",e));s(t)&&(v.data=r(t.data)?t.data:[],v.total=u(t.page))}finally{w(!1)}var e};return(async()=>{try{const{message:e}=await a.post("/plugin?action=a&name=btwaf&s=get_server_name");r(e)&&(y.value=e.map((e=>({label:e,value:e}))))}finally{y.value.unshift({label:l("Waf.Report.index_30"),value:"all"})}})(),(e,t)=>{const a=X,l=Z,d=ce,o=p,r=ee,s=pe,u=x,c=ue,f=se;return M(),I("div",be,[C(s,{ref_key:"formRef",ref:i,model:S(n),rules:_},{default:B((()=>[C(l,{label:e.$t("Waf.Report.index_21")},{default:B((()=>[L("div",xe,[C(a,{value:S(n).site,"onUpdate:value":t[0]||(t[0]=e=>S(n).site=e),options:S(y)},null,8,["value","options"])])])),_:1},8,["label"]),C(l,{label:e.$t("Waf.Report.index_22")},{default:B((()=>[L("div",he,[C(a,{value:S(n).type,"onUpdate:value":t[1]||(t[1]=e=>S(n).type=e),options:m},null,8,["value"])]),L("div",null,[t[6]||(t[6]=L("span",{class:"mr-8px text-error"},"*",-1)),L("span",we,O(e.$t("Waf.Report.index_23")),1)])])),_:1},8,["label"]),E(C(l,{label:e.$t("Waf.Report.index_25"),path:"search"},{default:B((()=>[L("div",Re,[C(d,{value:S(n).search,"onUpdate:value":t[2]||(t[2]=e=>S(n).search=e),rows:3},null,8,["value"])])])),_:1},8,["label"]),[[F,"4"!==S(n).type]]),E(C(l,{label:e.$t("Waf.Report.index_26"),path:"time"},{default:B((()=>[C(o,{value:S(n).time,"onUpdate:value":t[3]||(t[3]=e=>S(n).time=e),type:"daterange",clearable:""},null,8,["value"])])),_:1},8,["label"]),[[F,"4"===S(n).type]]),C(l,{label:" "},{default:B((()=>[C(r,{type:"primary",onClick:k},{default:B((()=>[H(O(e.$t("Waf.Report.index_27")),1)])),_:1})])),_:1})])),_:1},8,["model"]),C(f,null,{table:B((()=>[C(u,{loading:S(v).loading,data:S(v).data,columns:S(h)},null,8,["loading","data","columns"])])),pageRight:B((()=>[C(c,{page:S(n).p,"onUpdate:page":t[4]||(t[4]=e=>S(n).p=e),"page-size":S(n).limit,"onUpdate:pageSize":t[5]||(t[5]=e=>S(n).limit=e),"display-order":["pages"],"item-count":S(v).total,onRefresh:k},null,8,["page","page-size","item-count"])])),_:1})])}}}),ke={class:"h-full p-10px"},je=k({__name:"index",props:{loading:{type:Boolean,default:!1},data:{default:()=>[]}},setup(e){const{columns:t}=f([{key:"ip",title:"",align:"center",render:e=>C(T,null,[C("a",{class:"bt-link",href:"javascript:;",onClick:()=>{R(e)}},[e.ip]),C("span",{class:"mx-6px"},[e.address]),C("span",null,[H("("),e.num,H(")")])])}]);return(e,a)=>{const l=x;return M(),I("div",ke,[C(l,{class:"rank-table",loading:e.loading,data:e.data,"flex-height":!0,bordered:!1,"single-line":!1,"single-column":!1,columns:S(t)},null,8,["loading","data","columns"])])}}}),Ce=_(je,[["__scopeId","data-v-9bacc249"]]),$e={class:"flex-center h-full p-10px"},Me=k({__name:"index",props:{data:{default:()=>[]}},setup(e){const t=N(e,"data"),{t:a}=j(),l=z(!1),i=Y({backgroundColor:"#fff",title:d(),tooltip:{trigger:"item",confine:!0,formatter(e){const t=e;return`${t.marker} ${t.name}: ${t.value} (${t.percent}%)`}},series:o()}),n=["#6ec71e","#4885FF","#fc8b40","#818af8","#31c9d7","#f35e7a","#ab7aee","#14d68b","#cde5ff"];function d(e=0){return{text:a("Waf.Report.index_18"),textStyle:{color:"#484848",fontSize:17},subtext:`${e}`,subtextStyle:{color:"#717171",fontSize:15},itemGap:20,left:"center",top:"42%"}}function o(e=[]){return[{type:"pie",data:e,radius:["50%","60%"],center:["50%","50%"],clockwise:!0,avoidLabelOverlap:!0,label:{show:!0,position:"outside",color:"#999",lineHeight:18,formatter:e=>""!==e.name?0===e.percent?"":a("Waf.Overview.index_33",[e.name,e.value,e.percent]):""},labelLine:{length:30,length2:30,lineStyle:{width:1,color:"#CDCDCD"}},itemStyle:{labelLine:{length:30,length2:30,lineStyle:{width:1,color:"#CDCDCD"}},color:e=>n[e.dataIndex]},emphasis:{scaleSize:15}}]}return q((()=>{t.value&&(l.value=!t.value.length,(()=>{let e=0;const a=[];t.value.forEach((t=>{e+=t[1],a.push({name:t[0],value:t[1]})})),i.title=d(e),i.series=o(a)})())})),(e,t)=>{const a=te;return M(),I("div",$e,[S(l)?(M(),D(a,{key:0})):(M(),D(_e,{key:1,type:"pie",height:"100%",option:S(i)},null,8,["option"]))])}}}),De={class:"flex"},Se=_(k({__name:"date",props:{value:{default:"today"},valueModifiers:{}},emits:["update:value"],setup(e){const{t:t}=j(),a=z("today"),l=z(null),i=A(e,"value"),n=[{label:t("Public.Search.Yesterday"),value:"yesterday"},{label:t("Public.Search.Today"),value:"today"}],d=e=>{l.value=null,i.value=e},o=e=>{a.value=e?"":"today",i.value=r(e)?e:"today"};return q((()=>{r(i.value)?(l.value=i.value,a.value=""):(a.value=i.value,l.value=null)})),(e,t)=>{const i=ae,r=le,s=p;return M(),I("div",De,[C(r,{value:S(a),"onUpdate:value":[t[0]||(t[0]=e=>V(a)?a.value=e:null),d],size:"small",class:"bt-radio"},{default:B((()=>[(M(),I(T,null,G(n,(e=>C(i,{key:e.value,value:e.value},{default:B((()=>[H(O(e.label),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"]),C(s,{value:S(l),"onUpdate:value":[t[1]||(t[1]=e=>V(l)?l.value=e:null),o],type:"daterange",size:"small",class:"bt-date-picker",clearable:!0},null,8,["value"])])}}}),[["__scopeId","data-v-9ee89472"]]),Ue={class:"h-320px"},ze={class:"h-320px"},Pe=_(k({__name:"index",setup(e){const{loading:t,setLoading:l}=w(),i=z("ip"),n=J({type:[],ip:[],ip_list:{},uri:[],uri_list:{}}),d=K((()=>n.value.ip.map((e=>({ip:e[0],num:e[1],address:e[2],data:n.value.ip_list[e[0]]}))))),o=K((()=>n.value.uri.map((e=>({uri:e[0],num:e[1],list:n.value.uri_list[e[0]].ip_list||[]}))))),r=K((()=>{let e=0;return n.value.type.forEach((t=>{e+=t[1]})),e})),u=e=>{"search"!==e&&b()},p=()=>{b()},_=()=>{const e=v();if("today"===f.date)window.open(`${e}/btwaf/content_report.html`);else{const{start:t,end:a}=g();window.open(`${e}/btwaf/content_report.html?stime=${t}&etime=${a}`)}},f=P({date:"today"}),g=()=>{let e="",t="";if(m(f.date))switch(f.date){case"today":e=c(new Date,"yyyy-MM-dd"),t=c(new Date,"yyyy-MM-dd");break;case"yesterday":e=c(ye(new Date,-1),"yyyy-MM-dd"),t=c(ye(new Date,-1),"yyyy-MM-dd")}else e=c(new Date(f.date[0]),"yyyy-MM-dd"),t=c(new Date(f.date[1]),"yyyy-MM-dd");return{start:e,end:t}},b=async()=>{try{l(!0);const{message:t}=await(e=(()=>{const{start:e,end:t}=g();return{..."today"!==f.date?{start_time:e,end_time:t}:{}}})(),a.post("/plugin?action=a&name=btwaf&s=get_report",e));s(t)&&(n.value=t)}finally{l(!1)}var e};return b(),(e,a)=>{const l=ie,s=ne,c=ee,m=de,v=oe,g=y;return M(),D(g,{class:"report-grid","x-gap":"16"},{default:B((()=>[C(s,{span:"6"},{default:B((()=>[C(l,{class:"report-card mb-16px",title:e.$t("Waf.Report.index_1")},{default:B((()=>[L("div",Ue,[C(Me,{data:S(n).type},null,8,["data"])])])),_:1},8,["title"]),C(l,{class:"report-card",title:e.$t("Waf.Report.index_2")},{default:B((()=>[L("div",ze,[C(Ce,{loading:S(t),data:S(d)},null,8,["loading","data"])])])),_:1},8,["title"])])),_:1}),C(s,{span:"18"},{default:B((()=>[C(l,{class:"h-full"},{default:B((()=>[C(v,{value:S(i),"onUpdate:value":[a[1]||(a[1]=e=>V(i)?i.value=e:null),u],type:"line",class:"report-tabs"},{prefix:B((()=>a[2]||(a[2]=[L("div",null,null,-1)]))),suffix:B((()=>[C(Se,{value:S(f).date,"onUpdate:value":[a[0]||(a[0]=e=>S(f).date=e),p]},null,8,["value"]),C(c,{class:"ml-16px",type:"primary",size:"small",onClick:_},{default:B((()=>[H(O(e.$t("Waf.Report.index_3")),1)])),_:1}),a[3]||(a[3]=L("div",{class:"w-16px"},null,-1))])),default:B((()=>[C(m,{name:"ip",tab:e.$t("Waf.Report.index_4")},{default:B((()=>[C(fe,{loading:S(t),total:S(r),data:S(d)},null,8,["loading","total","data"])])),_:1},8,["tab"]),C(m,{name:"uri",tab:e.$t("Waf.Report.index_5")},{default:B((()=>[C(ge,{loading:S(t),total:S(r),data:S(o)},null,8,["loading","total","data"])])),_:1},8,["tab"]),C(m,{name:"search",tab:e.$t("Waf.Report.index_6")},{default:B((()=>[C(We)])),_:1},8,["tab"])])),_:1},8,["value"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-0329e270"]]),Ie=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));e("i",Ie)}}}));
