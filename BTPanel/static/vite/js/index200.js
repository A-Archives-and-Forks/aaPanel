import{_ as e}from"./index226.js?v=1744703330658";import{d as a,_ as s,m as l,eN as t,K as n,l as i,k as o,dc as r}from"./page_layout.js?v=1744703330658";import{_ as c}from"./index95.js?v=1744703330658";import{y as u,z as d,A as m}from"./ssl.js?v=1744703330658";import{a as p}from"./public.js?v=1744703330658";import{r as f,d as v,O as _,at as h,j as x,e as y,a3 as S,R as w,S as g,U as k,P as b,a0 as L,V as j,a1 as C,ap as z,c as R,af as $,$ as A}from"./vue.js?v=1744703330658";import{bU as N,a2 as U,cR as D,cj as T,T as V,cq as F}from"./naive.js?v=1744703330658";import"./common.js?v=1744703330658";import"./__commonjsHelpers__.js?v=1744703330658";const H=f(!1),O=f({}),P=async e=>{try{H.value=!0;const{message:s}=await u({hash:e});a(s)&&(O.value=s)}finally{H.value=!1}},q={key:0,class:"text-#20a53a"},I={class:"mt-16px"},J=v({__name:"index",props:{row:{},onRefresh:{type:Function}},setup(e){const{t:i}=_(),o=e,{row:r}=h(o),u=f("all"),m=x({domains:r.value.use_for.sites,is_remove:0}),v=f([]),A=f([]),F=y((()=>"matched"===u.value?A.value:v.value)),J=({option:e})=>{const a=e.match?"ssl-lock":"ssl-unlock",l=e.match?"text-#20a53a":"text-error";return b(N,{size:5,class:"items-center flex-nowrap!"},{default:()=>[b(s,{name:a,class:l,size:18},null),b("div",{class:"truncate w-full"},[e.label])]})},K=()=>{p({title:"Deploy SSL Certificate",content:()=>b(N,{class:"flex-col!"},{default:()=>[b("div",null,[m.domains.length?"Are you sure you want to deploy this certificate?":"Are you sure you want to cancel the deployment"]),b(U,{checkedValue:1,uncheckedValue:0,checked:m.is_remove,"onUpdate:checked":e=>m.is_remove=e},{default:()=>[R("Delete remote data")]})]}),onConfirm:async()=>{try{const{message:e}=await d({hash:r.value.hash,domains:JSON.stringify(m.domains),remove:m.is_remove});a(e)&&(e.faild?l.error("".concat(i("SSL.index_31"),"（").concat(e.faildList.map((e=>e.siteName)).join(","),"）")):l.success(i("SSL.index_32")),o.onRefresh())}finally{m.is_remove=0}}})},B=e=>e.map((e=>({label:e.name,value:e.name,match:e.match})));return(async()=>{await P(r.value.hash);const e=O.value.sites.filter((e=>e.match)),a=O.value.sites.filter((e=>!e.match));v.value=B([...e,...a]),A.value=B(e)})(),(e,a)=>{const l=S("i18n-t"),i=D,o=T,d=t,p=n,f=V,v=s,_=c;return w(),g("div",null,[k("div",null,[b(l,{keypath:"SSL.index_26",tag:"span",scope:"global"},{a:L((()=>[j(r).verify_domains.length?(w(),g("span",q,C(j(r).verify_domains.join(",")),1)):z("",!0)])),_:1}),a[2]||(a[2]=k("span",null," site",-1))]),b(o,{type:"segment",animated:"",value:j(u),"onUpdate:value":a[0]||(a[0]=e=>$(u)?u.value=e:null),class:"my-10px"},{default:L((()=>[b(i,{name:"all"},{default:L((()=>[R(C(e.$t("SSL.index_28")),1)])),_:1}),b(i,{name:"matched"},{default:L((()=>[R(C(e.$t("SSL.index_27")),1)])),_:1})])),_:1},8,["value"]),b(p,{show:j(H)},{default:L((()=>[b(d,{"render-source-label":J,"render-target-label":J,value:j(m).domains,"onUpdate:value":a[1]||(a[1]=e=>j(m).domains=e),options:j(F),"source-filterable":"","virtual-scroll":""},null,8,["value","options"])])),_:1},8,["show"]),k("div",I,[b(f,{type:"primary",onClick:K},{default:L((()=>[R(C(e.$t("SSL.index_29")),1)])),_:1})]),b(_,{class:"mt-20px"},{default:L((()=>[k("li",null,[b(v,{name:"ssl-lock",class:"text-#20a53a",size:18}),a[3]||(a[3]=k("span",{class:"ml-8px"},"This SSL is applicable to the this domain",-1))]),k("li",null,[b(v,{name:"ssl-unlock",class:"text-error",size:18}),a[4]||(a[4]=k("span",{class:"ml-8px"},'After using this SSL, accessing the domain will show a "Not Secure" warning',-1))])])),_:1})])}}}),K={key:0,class:"text-#20a53a"},B={class:"icon-box"},E=o(v({__name:"index",props:{row:{},onRefresh:{type:Function}},setup(e){const a=e,{row:l}=h(a),t=x({domains:"",issuer:"",end_date:"",is_match:!0}),o=e=>{p({title:"Deploy SSL Certificate",content:0===e?"Are you sure to deploy this SSL certificate to the panel?":"Are you sure you want to restore it?",onConfirm:async()=>{await m({hash:l.value.hash,recover:e}),a.onRefresh()}})};return(async()=>{await P(l.value.hash),t.is_match=!1,t.domains=O.value.panel[0].info.subject,t.issuer=O.value.panel[0].info.issuer,t.end_date=O.value.panel[0].info.notAfter})(),(e,a)=>{const r=S("i18n-t"),u=s,d=i,m=N,p=F,f=n,v=V,_=c;return w(),g("div",null,[k("div",null,[b(r,{keypath:"SSL.index_26",tag:"span",scope:"global"},{a:L((()=>[j(l).verify_domains.length?(w(),g("span",K,C(j(l).verify_domains.join(",")),1)):z("",!0)])),_:1}),a[2]||(a[2]=k("span",null," panel",-1))]),b(f,{show:j(H),class:"my-16px"},{default:L((()=>[b(p,{type:"info","show-icon":!1},{default:L((()=>[b(m,{class:"py-2px text-12px items-center flex-nowrap!"},{default:L((()=>[a[3]||(a[3]=k("b",{class:"text-nowrap!"},"Current SSL",-1)),b(u,{name:"ssl-lock",class:"text-#20a53a",size:18}),b(d,{vertical:""}),k("div",null,[k("div",null,[R(C(e.$t("Config.Safe.index_37")),1),k("b",null,C(j(t).domains),1)]),k("div",null,[R(C(e.$t("Config.Safe.index_38")),1),k("b",null,C(j(t).issuer),1)]),k("div",null,[R(C(e.$t("Config.Safe.index_39")),1),k("b",null,C(j(t).end_date),1)])])])),_:1})])),_:1}),k("div",B,[b(u,{name:"file-back",size:40,color:"#0a8c46"})]),b(p,{type:"success","show-icon":!1},{default:L((()=>[b(m,{class:"py-2px text-12px items-center flex-nowrap! text-primary"},{default:L((()=>[a[4]||(a[4]=k("b",{class:"text-nowrap!"},"New SSL",-1)),j(t).is_match?(w(),A(u,{key:0,name:"ssl-lock",class:"text-#20a53a",size:18})):(w(),A(u,{key:1,name:"ssl-unlock",class:"text-error",size:18})),b(d,{vertical:""}),k("div",null,[k("div",null,[R(C(e.$t("Config.Safe.index_37")),1),k("b",null,C(j(l).verify_domains.join(",")),1)]),k("div",null,[R(C(e.$t("Config.Safe.index_38")),1),k("b",null,C(j(l).provider+" "+j(l).issuer),1)]),k("div",null,[R(C(e.$t("Config.Safe.index_39")),1),k("b",null,C(j(l).end_date),1)])])])),_:1})])),_:1})])),_:1},8,["show"]),k("div",null,[b(v,{type:"primary",onClick:a[0]||(a[0]=e=>o(0))},{default:L((()=>[R(C(e.$t("SSL.index_29")),1)])),_:1})]),b(d,{class:"my-16px!"}),b(m,{class:"items-center"},{default:L((()=>[a[6]||(a[6]=k("span",{class:"text-desc"},"Restore to panel self-signed certificate?",-1)),b(v,{type:"primary",ghost:"",onClick:a[1]||(a[1]=e=>o(1))},{default:L((()=>a[5]||(a[5]=[R("Restore")]))),_:1})])),_:1}),b(_,{class:"mt-20px"},{default:L((()=>[k("li",null,[b(u,{name:"ssl-lock",class:"text-#20a53a",size:18}),a[7]||(a[7]=k("span",{class:"ml-8px"},"This SSL is applicable to the this domain",-1))]),k("li",null,[b(u,{name:"ssl-unlock",class:"text-error",size:18}),a[8]||(a[8]=k("span",{class:"ml-8px"},'After using this SSL, accessing the domain will show a "Not Secure" warning',-1))])])),_:1})])}}}),[["__scopeId","data-v-82432f85"]]),G=v({__name:"index",props:{data:{}},setup(a){const{t:s}=_(),l=a,{row:t,onRefresh:n,menu:i}=l.data,o=f("site"),c=[{key:"site",label:s("Home.index_68"),component:J,data:{row:t,onRefresh:n}},{key:"panel",label:"Panel",component:E,show:r,data:{row:t,onRefresh:n}}];return o.value=i||"site",(a,s)=>{const l=e;return w(),A(l,{value:j(o),"onUpdate:value":s[0]||(s[0]=e=>$(o)?o.value=e:null),data:c},null,8,["value"])}}});export{G as default};
